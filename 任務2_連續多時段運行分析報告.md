# ä»»å‹™2ï¼šé€£çºŒå¤šæ™‚æ®µé‹è¡Œåˆ†æå ±å‘Š

## ğŸ“‹ **è©•ä¼°æ¦‚è¿°**

æœ¬å ±å‘Šåˆ†æè™›æ“¬äº¤æ˜“ç³»çµ± `virtual_simple_integrated.py` çš„ç¾æœ‰å¤šæ™‚æ®µåŠŸèƒ½æ˜¯å¦èƒ½æ”¯æ´ç³»çµ±å•Ÿå‹•å¾Œçš„é€£çºŒé‹è¡Œï¼Œä»¥åŠå¯¦ç¾è‡ªå‹•é‹è¡Œå¤šå€‹æ™‚é–“æ®µè€Œç„¡éœ€æ‰‹å‹•å¹²é çš„å¯è¡Œæ€§ã€‚

---

## ğŸ” **ç•¶å‰ç³»çµ±å¤šæ™‚æ®µæ”¯æ´åˆ†æ**

### **1. ç¾æœ‰è‡ªå‹•åŒ–æ©Ÿåˆ¶**

#### **ç³»çµ±å•Ÿå‹•è‡ªå‹•åŒ–æµç¨‹**
```python
# ç³»çµ±åˆå§‹åŒ–æ™‚çš„è‡ªå‹•å•Ÿå‹•æ©Ÿåˆ¶ (ç¬¬1542-1570è¡Œ)
def __init__(self):
    # è‡ªå‹•é€£æ¥ç•°æ­¥å³°å€¼æ›´æ–°
    if self.connect_async_peak_update():
        if self.enable_async_peak_update:
            # ğŸš€ ç•°æ­¥å³°å€¼æ›´æ–°å·²è‡ªå‹•å•Ÿç”¨
            # ğŸ§¹ åˆå§‹åŒ–ç³»çµ±ç¶­è­·ç®¡ç†å™¨
            self._setup_system_maintenance()
            # ğŸ”§ åˆå§‹åŒ–ç³»çµ±è¨ºæ–·æ©Ÿåˆ¶
            self._setup_system_diagnostics()
```

#### **ç³»çµ±ç¶­è­·ç®¡ç†å™¨ - é•·æœŸé‹è¡Œæ”¯æ´**
```python
# ç¶­è­·ä»»å‹™è¨»å†Š (ç¬¬1648-1693è¡Œ)
def _setup_system_maintenance(self):
    # 1. å…§å­˜ç·©å­˜æ¸…ç†ï¼ˆæ¯1å°æ™‚ï¼‰
    # 2. è¨‚å–®è¿½è¹¤å™¨æ¸…ç†ï¼ˆæ¯30åˆ†é˜ï¼‰
    # 3. å¹³å€‰è¿½è¹¤å™¨æ¸…ç†ï¼ˆæ¯15åˆ†é˜ï¼‰
    # 4. è³‡æ–™åº«æ¸…ç†ï¼ˆæ¯å¤©ï¼‰
    # 5. å¹³å€‰é–å®šæ¸…ç†ï¼ˆæ¯5åˆ†é˜ï¼‰
    # 6. çµ±è¨ˆä¿¡æ¯é‡ç½®ï¼ˆæ¯å¤©ï¼‰
    
    maintenance_manager.start()
    print("ğŸ§¹ ç³»çµ±ç¶­è­·ç®¡ç†å™¨å·²å•Ÿç”¨")
    print("ğŸ’¡ å°‡å®šæœŸæ¸…ç†å…§å­˜ç·©å­˜ã€éæœŸè¨‚å–®ã€èˆŠæ—¥èªŒç­‰è³‡æº")
```

### **2. å¤šæ™‚æ®µç­–ç•¥æ§åˆ¶æ©Ÿåˆ¶**

#### **åŸ·è¡Œé »ç‡æ§åˆ¶ç³»çµ±**
```python
# åŸ·è¡Œé »ç‡æª¢æŸ¥ (ç¬¬5263-5302è¡Œ)
def check_auto_start_multi_group_strategy(self):
    # ğŸ†• æª¢æŸ¥åŸ·è¡Œé »ç‡è¨­å®š
    frequency = getattr(self, 'multi_group_frequency_var', None)
    freq_setting = frequency.get() if frequency else "å¯é‡è¤‡åŸ·è¡Œ"
    
    # ğŸ†• æ ¹æ“šé »ç‡è¨­å®šæª¢æŸ¥æ˜¯å¦å…è¨±åŸ·è¡Œ
    if freq_setting == "ä¸€å¤©ä¸€æ¬¡":
        # æª¢æŸ¥ä»Šå¤©æ˜¯å¦å·²æœ‰ç­–ç•¥çµ„
        today_groups = self.multi_group_position_manager.db_manager.get_today_strategy_groups()
        if today_groups:
            print("ğŸ“… ä¸€å¤©ä¸€æ¬¡æ¨¡å¼ï¼šä»Šæ—¥å·²åŸ·è¡Œéï¼Œè·³éè‡ªå‹•å•Ÿå‹•")
            return
```

**æ”¯æ´çš„åŸ·è¡Œæ¨¡å¼**ï¼š
- **ä¸€å¤©ä¸€æ¬¡**ï¼šæª¢æŸ¥ç•¶æ—¥æ˜¯å¦å·²åŸ·è¡Œï¼Œé¿å…é‡è¤‡
- **å¯é‡è¤‡åŸ·è¡Œ**ï¼šå…è¨±å¤šæ¬¡åŸ·è¡Œ
- **æ¸¬è©¦æ¨¡å¼**ï¼šç”¨æ–¼é–‹ç™¼æ¸¬è©¦

### **3. 24å°æ™‚æŒçºŒé‹è¡Œèƒ½åŠ›**

#### **è™›æ“¬å ±åƒ¹æ©Ÿ24å°æ™‚é…ç½®**
```json
// è™›æ“¬å ±åƒ¹æ©Ÿé…ç½® (config.json)
"market_config": {
    "trading_hours": {
        "start": "00:00:00",
        "end": "23:59:59",
        "24h_mode": true
    }
}
```

#### **æŒçºŒç›£æ§å¯¦ä¾‹**
```python
# 24å°æ™‚ç›£æ§ç¯„ä¾‹ (24h_real_time_monitor.py)
def main():
    print("ğŸ¯ ç³»çµ±åŠŸèƒ½:")
    print("   âœ… 24å°æ™‚æŒçºŒå ±åƒ¹é¡¯ç¤º")
    print("   âœ… å¯¦æ™‚é›»è…¦æ™‚é–“é¡¯ç¤º")
    print("   âœ… å€é–“çªç ´è‡ªå‹•åµæ¸¬")
    
    # ä¸»ç›£æ§å¾ªç’°
    while True:
        time.sleep(0.1)  # çŸ­æš«ä¼‘çœ 
```

---

## ğŸ¯ **é€£çºŒå¤šæ™‚æ®µé‹è¡Œå¯¦ç¾æ–¹æ¡ˆ**

### **æ–¹æ¡ˆ1ï¼šæ™‚é–“æ’ç¨‹ç®¡ç†å™¨**

#### **æ™‚é–“æ’ç¨‹å™¨è¨­è¨ˆ**
```python
class MultiSessionScheduler:
    """å¤šæ™‚æ®µæ’ç¨‹ç®¡ç†å™¨"""
    
    def __init__(self):
        self.sessions = []  # æ™‚æ®µåˆ—è¡¨
        self.current_session = None
        self.scheduler_running = False
        
    def add_session(self, start_time, end_time, strategy_config):
        """æ·»åŠ ç›£æ§æ™‚æ®µ"""
        session = {
            'start_time': start_time,
            'end_time': end_time,
            'strategy_config': strategy_config,
            'status': 'PENDING'
        }
        self.sessions.append(session)
        
    def start_scheduler(self):
        """å•Ÿå‹•æ’ç¨‹å™¨"""
        self.scheduler_running = True
        self.scheduler_thread = threading.Thread(target=self._scheduler_loop)
        self.scheduler_thread.start()
        
    def _scheduler_loop(self):
        """æ’ç¨‹ä¸»å¾ªç’°"""
        while self.scheduler_running:
            current_time = datetime.now().time()
            
            # æª¢æŸ¥æ˜¯å¦éœ€è¦å•Ÿå‹•æ–°æ™‚æ®µ
            for session in self.sessions:
                if self._should_start_session(session, current_time):
                    self._start_session(session)
                elif self._should_end_session(session, current_time):
                    self._end_session(session)
                    
            time.sleep(1)  # æ¯ç§’æª¢æŸ¥ä¸€æ¬¡
```

### **æ–¹æ¡ˆ2ï¼šç‹€æ…‹æ©Ÿé©…å‹•çš„æ™‚æ®µåˆ‡æ›**

#### **æ™‚æ®µç‹€æ…‹ç®¡ç†**
```python
class SessionStateMachine:
    """æ™‚æ®µç‹€æ…‹æ©Ÿ"""
    
    STATES = {
        'WAITING': 'ç­‰å¾…é–‹å§‹',
        'ACTIVE': 'ç›£æ§ä¸­',
        'COMPLETED': 'å·²å®Œæˆ',
        'PAUSED': 'æš«åœ'
    }
    
    def __init__(self):
        self.current_state = 'WAITING'
        self.session_queue = []
        
    def transition_to(self, new_state):
        """ç‹€æ…‹è½‰æ›"""
        if self._is_valid_transition(self.current_state, new_state):
            old_state = self.current_state
            self.current_state = new_state
            self._on_state_changed(old_state, new_state)
            
    def _on_state_changed(self, old_state, new_state):
        """ç‹€æ…‹è®Šæ›´è™•ç†"""
        if new_state == 'ACTIVE':
            self._start_monitoring()
        elif new_state == 'COMPLETED':
            self._cleanup_session()
            self._prepare_next_session()
```

### **æ–¹æ¡ˆ3ï¼šäº‹ä»¶é©…å‹•çš„è‡ªå‹•åŒ–ç³»çµ±**

#### **äº‹ä»¶ç›£è½å™¨**
```python
class AutomationEventListener:
    """è‡ªå‹•åŒ–äº‹ä»¶ç›£è½å™¨"""
    
    def __init__(self):
        self.event_handlers = {
            'SESSION_START': self._handle_session_start,
            'SESSION_END': self._handle_session_end,
            'RANGE_CALCULATED': self._handle_range_calculated,
            'POSITION_CLOSED': self._handle_position_closed
        }
        
    def _handle_session_start(self, event_data):
        """è™•ç†æ™‚æ®µé–‹å§‹äº‹ä»¶"""
        session_config = event_data['session_config']
        self._apply_session_config(session_config)
        self._reset_session_state()
        
    def _handle_session_end(self, event_data):
        """è™•ç†æ™‚æ®µçµæŸäº‹ä»¶"""
        self._save_session_results()
        self._prepare_next_session()
```

---

## âš ï¸ **é¢¨éšªè©•ä¼°**

### **ğŸ”´ é«˜é¢¨éšªé …ç›®**

#### **1. è¨˜æ†¶é«”æ´©æ¼é¢¨éšª**
- **é¢¨éšª**ï¼šé•·æ™‚é–“é‹è¡Œå¯èƒ½å°è‡´è¨˜æ†¶é«”ç´¯ç©
- **å½±éŸ¿**ï¼šç³»çµ±æ€§èƒ½ä¸‹é™ï¼Œæœ€çµ‚å´©æ½°
- **ç¾æœ‰ç·©è§£**ï¼šç³»çµ±ç¶­è­·ç®¡ç†å™¨å®šæœŸæ¸…ç†
- **å»ºè­°**ï¼šå¢å¼·è¨˜æ†¶é«”ç›£æ§å’Œè‡ªå‹•é‡å•Ÿæ©Ÿåˆ¶

#### **2. è³‡æ–™åº«é€£æ¥ç©©å®šæ€§**
- **é¢¨éšª**ï¼šé•·æ™‚é–“é‹è¡Œå¯èƒ½å°è‡´è³‡æ–™åº«é€£æ¥ä¸­æ–·
- **å½±éŸ¿**ï¼šæ•¸æ“šä¸Ÿå¤±ï¼Œç³»çµ±ç‹€æ…‹ä¸ä¸€è‡´
- **å»ºè­°**ï¼šå¯¦ç¾é€£æ¥æ± å’Œè‡ªå‹•é‡é€£æ©Ÿåˆ¶

#### **3. æ™‚æ®µåˆ‡æ›æ™‚çš„ç‹€æ…‹ä¸€è‡´æ€§**
- **é¢¨éšª**ï¼šæ™‚æ®µåˆ‡æ›æ™‚å¯èƒ½å­˜åœ¨æœªå®Œæˆçš„äº¤æ˜“
- **å½±éŸ¿**ï¼šéƒ¨ä½ç®¡ç†æ··äº‚ï¼Œé¢¨éšªæ§åˆ¶å¤±æ•ˆ
- **å»ºè­°**ï¼šå¯¦ç¾å„ªé›…çš„æ™‚æ®µåˆ‡æ›æ©Ÿåˆ¶

### **ğŸŸ¡ ä¸­é¢¨éšªé …ç›®**

#### **1. ç³»çµ±è³‡æºæ¶ˆè€—**
- **é¢¨éšª**ï¼š24å°æ™‚é‹è¡Œçš„CPUå’Œè¨˜æ†¶é«”æ¶ˆè€—
- **å½±éŸ¿**ï¼šç³»çµ±éŸ¿æ‡‰é€Ÿåº¦ä¸‹é™
- **ç¾æœ‰ç·©è§£**ï¼šç¶­è­·ç®¡ç†å™¨å®šæœŸæ¸…ç†

#### **2. éŒ¯èª¤ç´¯ç©æ•ˆæ‡‰**
- **é¢¨éšª**ï¼šå°éŒ¯èª¤åœ¨é•·æ™‚é–“é‹è¡Œä¸­ç´¯ç©
- **å½±éŸ¿**ï¼šç³»çµ±ç©©å®šæ€§é€æ¼¸ä¸‹é™
- **å»ºè­°**ï¼šå¢å¼·éŒ¯èª¤ç›£æ§å’Œè‡ªå‹•ä¿®å¾©

### **ğŸŸ¢ ä½é¢¨éšªé …ç›®**

#### **1. é…ç½®ç®¡ç†è¤‡é›œæ€§**
- **è©•ä¼°**ï¼šå¤šæ™‚æ®µé…ç½®ç®¡ç†ç›¸å°ç°¡å–®
- **å½±éŸ¿**ï¼šé–‹ç™¼å’Œç¶­è­·æˆæœ¬é©ä¸­

#### **2. ç”¨æˆ¶ç•Œé¢éŸ¿æ‡‰**
- **è©•ä¼°**ï¼šå·²é¿å…UIæ›´æ–°ï¼Œä½¿ç”¨Consoleè¼¸å‡º
- **å½±éŸ¿**ï¼šå°ç³»çµ±æ€§èƒ½å½±éŸ¿æœ€å°

---

## ğŸ› ï¸ **å¯¦ç¾å»ºè­°**

### **éšæ®µ1ï¼šåŸºç¤æ¶æ§‹å»ºç«‹**
1. å¯¦ç¾å¤šæ™‚æ®µæ’ç¨‹ç®¡ç†å™¨
2. å»ºç«‹æ™‚æ®µç‹€æ…‹æ©Ÿåˆ¶
3. å¢å¼·ç³»çµ±ç¶­è­·åŠŸèƒ½

### **éšæ®µ2ï¼šè‡ªå‹•åŒ–é‚è¼¯å®Œå–„**
1. å¯¦ç¾äº‹ä»¶é©…å‹•çš„æ™‚æ®µåˆ‡æ›
2. å»ºç«‹å„ªé›…çš„ç‹€æ…‹è½‰æ›æ©Ÿåˆ¶
3. å¢åŠ éŒ¯èª¤æ¢å¾©èƒ½åŠ›

### **éšæ®µ3ï¼šç©©å®šæ€§å¢å¼·**
1. å¯¦ç¾è¨˜æ†¶é«”ç›£æ§å’Œè‡ªå‹•æ¸…ç†
2. å»ºç«‹è³‡æ–™åº«é€£æ¥æ± 
3. å¢åŠ ç³»çµ±å¥åº·æª¢æŸ¥

### **éšæ®µ4ï¼šç›£æ§å’Œè¨ºæ–·**
1. å¯¦ç¾å…¨é¢çš„ç³»çµ±ç›£æ§
2. å»ºç«‹è‡ªå‹•è¨ºæ–·æ©Ÿåˆ¶
3. å¢åŠ æ€§èƒ½å„ªåŒ–åŠŸèƒ½

---

## ğŸ“Š **ç¸½é«”è©•ä¼°**

| è©•ä¼°é …ç›® | ç¾æœ‰æ”¯æ´åº¦ | å¯¦ç¾é›£åº¦ | é¢¨éšªç­‰ç´š | å»ºè­°å„ªå…ˆç´š |
|---------|-----------|---------|---------|-----------|
| 24å°æ™‚é‹è¡Œ | â­â­â­â­ | ğŸŸ¢ ä½ | ğŸŸ¡ ä¸­ | â­â­â­â­ |
| è‡ªå‹•æ™‚æ®µåˆ‡æ› | â­â­ | ğŸŸ¡ ä¸­ | ğŸ”´ é«˜ | â­â­â­â­â­ |
| ç‹€æ…‹ç®¡ç† | â­â­â­ | ğŸŸ¡ ä¸­ | ğŸŸ¡ ä¸­ | â­â­â­â­ |
| è¨˜æ†¶é«”ç®¡ç† | â­â­â­â­ | ğŸŸ¢ ä½ | ğŸ”´ é«˜ | â­â­â­â­â­ |
| éŒ¯èª¤æ¢å¾© | â­â­ | ğŸŸ¡ ä¸­ | ğŸŸ¡ ä¸­ | â­â­â­ |

**çµè«–**ï¼šè™›æ“¬äº¤æ˜“ç³»çµ±å·²å…·å‚™è‰¯å¥½çš„24å°æ™‚é‹è¡ŒåŸºç¤ï¼ŒåŒ…æ‹¬ç³»çµ±ç¶­è­·ç®¡ç†å™¨å’ŒåŸ·è¡Œé »ç‡æ§åˆ¶ã€‚ä¸»è¦éœ€è¦å¢å¼·çš„æ˜¯è‡ªå‹•æ™‚æ®µåˆ‡æ›æ©Ÿåˆ¶å’Œç‹€æ…‹ä¸€è‡´æ€§ä¿è­‰ã€‚å»ºè­°æ¡ç”¨äº‹ä»¶é©…å‹•çš„æ¶æ§‹ï¼Œé€æ­¥å¯¦ç¾é€£çºŒå¤šæ™‚æ®µé‹è¡ŒåŠŸèƒ½ã€‚

**å¯è¡Œæ€§è©•ä¼°**ï¼šğŸŸ¢ **é«˜å¯è¡Œæ€§** - ç¾æœ‰æ¶æ§‹æ”¯æ´åº¦é«˜ï¼Œé¢¨éšªå¯æ§

---

*å ±å‘Šç”Ÿæˆæ™‚é–“ï¼š2025-07-18*  
*è©•ä¼°ç³»çµ±ï¼švirtual_simple_integrated.py*  
*é¢¨éšªç­‰ç´šï¼šğŸŸ¡ ä¸­é¢¨éšª - éœ€è¦è¬¹æ…å¯¦ç¾*
