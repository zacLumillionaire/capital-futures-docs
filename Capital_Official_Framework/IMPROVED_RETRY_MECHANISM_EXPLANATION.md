# ğŸ“‹ æ”¹é€²ç‰ˆè¿½åƒ¹æ©Ÿåˆ¶èªªæ˜

## ğŸ• **æ™‚é–“çª—å£æ©Ÿåˆ¶**

### **æ™‚é–“çª—å£ = 5åˆ†é˜ (300ç§’)**
```python
# åªåŒ¹é…5åˆ†é˜å…§å‰µå»ºçš„ç­–ç•¥çµ„
if current_time - group.submit_time <= 300:
    return group
```

**ä½œç”¨**:
- **é˜²æ­¢æ­·å²åŒ¹é…**: é¿å…æŠŠèˆŠçš„å›å ±æ­¸å±¬åˆ°æ–°çš„ç­–ç•¥çµ„
- **è‡ªå‹•éæœŸ**: è¶…é5åˆ†é˜çš„çµ„ä¸å†æ¥å—æ–°çš„å›å ±åŒ¹é…
- **é¿å…æ··æ·†**: ç¢ºä¿å›å ±åªåŒ¹é…åˆ°ç•¶å‰æ´»èºçš„ç­–ç•¥çµ„

### **åŒ¹é…æ¢ä»¶çµ„åˆ**
1. **æ–¹å‘åŒ¹é…**: LONG/SHORT
2. **å•†å“åŒ¹é…**: TM0000/MTX00
3. **åƒ¹æ ¼å®¹å·®**: Â±5é»ç¯„åœå…§
4. **æ™‚é–“çª—å£**: 5åˆ†é˜å…§
5. **çµ„ç‹€æ…‹**: æœªå®Œæˆ

---

## ğŸ”„ **æ”¹é€²ç‰ˆè¿½åƒ¹æ©Ÿåˆ¶**

### **è¿½åƒ¹è§¸ç™¼æ¢ä»¶**
```python
def needs_retry(self) -> bool:
    remaining_lots = self.total_lots - self.filled_lots
    return (remaining_lots > 0 and                    # é‚„æœ‰æœªæˆäº¤å£æ•¸
            self.retry_count < self.max_retries and   # æœªé”æœ€å¤§é‡è©¦æ¬¡æ•¸(5æ¬¡)
            self.submitted_lots <= self.total_lots)   # é˜²æ­¢è¶…é‡ä¸‹å–®
```

### **ç²¾ç¢ºè¿½åƒ¹æ§åˆ¶**
```python
# è¨ˆç®—éœ€è¦è¿½åƒ¹çš„å£æ•¸
remaining_lots = group.total_lots - group.filled_lots
retry_lots = min(qty, remaining_lots)  # ä¸è¶…éå‰©é¤˜éœ€æ±‚

if retry_lots > 0:
    group.is_retrying = True  # æ¨™è¨˜ç‚ºè¿½åƒ¹ä¸­
    group.pending_retry_lots = retry_lots
```

---

## ğŸš¨ **å¤šä¸‹å–®é¢¨éšªæ§åˆ¶**

### **å•é¡Œå ´æ™¯åˆ†æ**
```
ç­–ç•¥çµ„: 3å£ç›®æ¨™
ç¬¬1æ¬¡: 3å£FOK @22344 â†’ å…¨éƒ¨å–æ¶ˆ(C) â†’ è§¸ç™¼è¿½åƒ¹
ç¬¬2æ¬¡: 3å£FOK @22345 â†’ 1å£æˆäº¤(D), 2å£å–æ¶ˆ(C) â†’ å†æ¬¡è§¸ç™¼è¿½åƒ¹?
ç¬¬3æ¬¡: æ‡‰è©²åªä¸‹2å£ï¼Œä¸æ˜¯3å£
```

### **é¢¨éšªæ§åˆ¶æ©Ÿåˆ¶**

#### **1. ç‹€æ…‹é–å®šæ©Ÿåˆ¶**
```python
if group.needs_retry() and not group.is_retrying:
    group.is_retrying = True  # é˜²æ­¢é‡è¤‡è§¸ç™¼
```

#### **2. ç²¾ç¢ºå£æ•¸è¨ˆç®—**
```python
remaining_lots = group.total_lots - group.filled_lots
retry_lots = min(qty, remaining_lots)  # åªè¿½åƒ¹å¯¦éš›éœ€è¦çš„å£æ•¸
```

#### **3. é€å‡ºå£æ•¸é™åˆ¶**
```python
self.submitted_lots <= self.total_lots  # é˜²æ­¢è¶…é‡ä¸‹å–®
```

#### **4. ç‹€æ…‹é‡ç½®æ©Ÿåˆ¶**
```python
# æ–°ä¸‹å–®é€å‡ºæ™‚é‡ç½®è¿½åƒ¹ç‹€æ…‹
if group.is_retrying:
    group.is_retrying = False
    group.pending_retry_lots = 0
```

---

## ğŸ“Š **è¿½åƒ¹æµç¨‹ç¤ºä¾‹**

### **æ­£å¸¸è¿½åƒ¹æµç¨‹**
```
1. ç­–ç•¥çµ„è¨»å†Š: 3å£ @22344
2. åˆå§‹ä¸‹å–®: 3å£FOK @22344
3. æ”¶åˆ°å–æ¶ˆ: 3å£å–æ¶ˆ â†’ è§¸ç™¼è¿½åƒ¹(ç¬¬1æ¬¡)
4. è¿½åƒ¹ä¸‹å–®: 3å£FOK @22345
5. æ”¶åˆ°æˆäº¤: 1å£æˆäº¤, 2å£å–æ¶ˆ â†’ è§¸ç™¼è¿½åƒ¹(ç¬¬2æ¬¡)
6. è¿½åƒ¹ä¸‹å–®: 2å£FOK @22346 (åªä¸‹å‰©é¤˜å£æ•¸)
7. æ”¶åˆ°æˆäº¤: 2å£æˆäº¤ â†’ çµ„å®Œæˆ
```

### **é˜²æ­¢å¤šä¸‹å–®çš„æ§åˆ¶é»**
```
âœ… ç¬¬6æ­¥: åªä¸‹2å£ï¼Œä¸æ˜¯3å£ (remaining_lotsæ§åˆ¶)
âœ… ç‹€æ…‹é–å®š: è¿½åƒ¹æœŸé–“ä¸é‡è¤‡è§¸ç™¼
âœ… å£æ•¸é™åˆ¶: submitted_lots <= total_lots
âœ… æ™‚é–“æ§åˆ¶: è‡³å°‘é–“éš”1ç§’
```

---

## âš™ï¸ **é…ç½®åƒæ•¸**

### **æ™‚é–“æ§åˆ¶**
- **æ™‚é–“çª—å£**: 5åˆ†é˜ (300ç§’)
- **é‡è©¦é–“éš”**: 1ç§’
- **æ¸…ç†é€±æœŸ**: 1å°æ™‚

### **è¿½åƒ¹æ§åˆ¶**
- **æœ€å¤§é‡è©¦**: 5æ¬¡
- **åƒ¹æ ¼å®¹å·®**: Â±5é»
- **è¿½åƒ¹æ­¥é•·**: +1é» (å¤šé ­), -1é» (ç©ºé ­)

### **é¢¨éšªæ§åˆ¶**
- **è¶…é‡ä¿è­·**: submitted_lots <= total_lots
- **ç‹€æ…‹é–å®š**: is_retrying æ¨™è¨˜
- **ç²¾ç¢ºè¨ˆç®—**: min(cancelled_qty, remaining_lots)

---

## ğŸ¯ **é æœŸæ•ˆæœ**

### **è§£æ±ºçš„å•é¡Œ**
1. **âœ… åºè™Ÿä¸åŒ¹é…**: æ”¹ç”¨çµ±è¨ˆåŒ¹é…
2. **âœ… æˆäº¤ç„¡æ³•è­˜åˆ¥**: åŸºæ–¼åƒ¹æ ¼+æ–¹å‘+æ™‚é–“çª—å£
3. **âœ… è¿½åƒ¹æ©Ÿåˆ¶å¤±æ•ˆ**: åŸºæ–¼å–æ¶ˆçµ±è¨ˆè§¸ç™¼
4. **âœ… å¤šä¸‹å–®é¢¨éšª**: ç²¾ç¢ºå£æ•¸æ§åˆ¶

### **è¿½åƒ¹é‚è¼¯**
- **è§¸ç™¼æ¢ä»¶**: æ”¶åˆ°C(å–æ¶ˆ)å›å ±
- **è¿½åƒ¹æ¬¡æ•¸**: æœ€å¤š5æ¬¡
- **è¿½åƒ¹å£æ•¸**: ç²¾ç¢ºè¨ˆç®—å‰©é¤˜éœ€æ±‚
- **é˜²é‡è¤‡**: ç‹€æ…‹é–å®šæ©Ÿåˆ¶

### **å®‰å…¨ä¿éšœ**
- **ä¸æœƒè¶…é‡**: submitted_lots <= total_lots
- **ä¸æœƒé‡è¤‡**: is_retrying ç‹€æ…‹æ§åˆ¶
- **ä¸æœƒæ··æ·†**: æ™‚é–“çª—å£é™åˆ¶
- **ä¸æœƒå¡æ­»**: æœ€å¤§é‡è©¦æ¬¡æ•¸é™åˆ¶

---

## ğŸ“ **ä½¿ç”¨å»ºè­°**

1. **ç›£æ§æ—¥èªŒ**: é—œæ³¨ `[SIMPLIFIED_TRACKER]` æ¨™ç±¤
2. **æª¢æŸ¥çµ±è¨ˆ**: å®šæœŸæŸ¥çœ‹ `get_statistics()` çµæœ
3. **ç‹€æ…‹ç¢ºèª**: ä½¿ç”¨ `get_group_status()` æª¢æŸ¥çµ„ç‹€æ…‹
4. **åƒæ•¸èª¿æ•´**: å¯æ ¹æ“šå¯¦éš›æƒ…æ³èª¿æ•´æ™‚é–“çª—å£å’Œé‡è©¦æ¬¡æ•¸

é€™å€‹æ”¹é€²ç‰ˆæœ¬æ‡‰è©²èƒ½æœ‰æ•ˆé˜²æ­¢å¤šä¸‹å–®å•é¡Œï¼ŒåŒæ™‚ä¿æŒè¿½åƒ¹æ©Ÿåˆ¶çš„æœ‰æ•ˆæ€§ï¼
