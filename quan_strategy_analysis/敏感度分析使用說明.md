# 策略敏感度分析器使用說明

## 📋 概述

策略敏感度分析器是一個基於 SALib 函式庫的工具，用於分析 Profit-Funded Risk 多口交易策略中各參數對最大回撤（MDD）的影響程度。

## 🎯 主要功能

1. **參數敏感度分析**：使用 Sobol 方法分析 7 個關鍵參數對 MDD 的影響
2. **多方向分析**：分別對多頭、空頭、雙向交易進行獨立分析
3. **自動化回測**：整合原有回測引擎，支援大量參數組合的自動化測試
4. **詳細報告**：生成包含敏感度指數排名的完整分析報告

## 📊 分析參數

| 參數名稱 | 描述 | 範圍 |
|---------|------|------|
| lot1_trigger | 第1口觸發點 | 10-30 點 |
| lot1_pullback | 第1口回檔百分比 | 5%-30% |
| lot2_trigger | 第2口觸發點 | 25-60 點 |
| lot2_pullback | 第2口回檔百分比 | 5%-30% |
| lot3_trigger | 第3口觸發點 | 40-80 點 |
| lot3_pullback | 第3口回檔百分比 | 10%-40% |
| protection_multiplier | 保護性停損倍數 | 1.0-3.0 倍 |

## 🚀 使用方法

### 1. 環境準備

確保已安裝必要的依賴套件：

```bash
pip install SALib numpy pandas
```

### 2. 演示版本（推薦新手）

先運行演示版本來了解基本功能：

```bash
python demo_sensitivity_analyzer.py
```

演示版本使用模擬數據，運行速度快，適合理解分析流程。

### 3. 完整版本

運行完整的敏感度分析：

```bash
python strategy_sensitivity_analyzer.py
```

**注意**：完整版本會使用真實的回測引擎，運行時間較長。

### 4. 自定義參數

可以修改腳本中的以下參數：

```python
# 在 __main__ 區塊中
TARGET_TIME_SLOT = ('08:45', '08:47')  # 分析時間區段
N = 64  # 樣本數（建議從小值開始）
start_date = "2024-11-04"  # 回測開始日期
end_date = "2025-06-28"    # 回測結束日期
```

## 📈 結果解讀

### 敏感度指數說明

1. **ST (總敏感度指數)**
   - 範圍：0-1
   - 含義：參數對輸出的總影響，包括直接影響和交互作用
   - **ST 值越高，參數越重要**

2. **S1 (一階敏感度指數)**
   - 範圍：0-1
   - 含義：參數的直接影響，不包括與其他參數的交互作用
   - S1 高表示該參數單獨對結果有重要影響

### 實際應用建議

1. **優先優化 ST 值最高的參數**
2. **如果 ST >> S1，表示該參數與其他參數有強交互作用**
3. **如果 S1 ≈ ST，表示該參數主要是獨立影響**

## ⚠️ 注意事項

### 運行要求

1. **數據庫**：確保 `stock_data.sqlite` 存在且包含足夠的歷史數據
2. **計算資源**：完整分析可能需要數小時，建議在性能較好的機器上運行
3. **樣本數**：建議從小樣本（N=64）開始測試，確認無誤後再增加

### 樣本數建議

| 目的 | 建議樣本數 | 預估時間 |
|------|-----------|----------|
| 快速測試 | N=32 | 10-30分鐘 |
| 初步分析 | N=64 | 30-60分鐘 |
| 詳細分析 | N=128 | 1-3小時 |
| 精確分析 | N=256 | 3-8小時 |

### 常見問題

1. **記憶體不足**：減少樣本數或分批執行
2. **運行時間過長**：先用演示版本驗證邏輯，再運行完整版本
3. **結果不穩定**：增加樣本數以提高分析精度

## 📁 文件說明

- `strategy_sensitivity_analyzer.py`：完整版敏感度分析器
- `demo_sensitivity_analyzer.py`：演示版本（使用模擬數據）
- `test_sensitivity_analyzer.py`：測試腳本
- `敏感度分析使用說明.md`：本說明文件

## 🔧 技術細節

### 分析方法

使用 Sobol 敏感度分析方法，這是一種基於方差的全局敏感度分析技術：

1. **樣本生成**：使用 Sobol 序列生成準隨機樣本
2. **模型評估**：對每個樣本執行回測，計算 MDD
3. **敏感度計算**：基於輸出方差分解計算敏感度指數

### 輸出格式

分析結果包含：
- 每個交易方向的詳細敏感度排名
- 參數重要性摘要
- 統計信息（有效樣本數、MDD 範圍等）

## 📞 支援

如有問題或建議，請聯繫量化分析團隊。

---

**版本**：1.0  
**更新日期**：2025-07-14  
**作者**：量化分析團隊
