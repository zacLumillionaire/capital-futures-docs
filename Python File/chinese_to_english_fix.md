# 🔧 中文商品代碼轉英文修復指南

## 🎯 **問題解決**

你遇到的問題是中文編碼導致的：

```
【非同步委託】Code: 400, Message: DB查詢失敗: ?p?x??無法轉換商品ID
```

**原因**：「小台近」在API系統中變成亂碼「?p?x??」，無法識別。

## ✅ **已實現的修復**

我已經修改程式，自動將中文商品代碼轉換為英文：

### 中文轉英文對照表
```python
chinese_to_english = {
    "小台近": "MXFR1",    # 小台指近月合約
    "大台近": "TXFR1",    # 大台指近月合約
    "電子近": "TXER1",    # 電子期貨近月合約
    "金融近": "TXFR1"     # 金融期貨近月合約
}
```

### 自動轉換邏輯
```python
if product_code == "小台近":
    full_product_code = "MXFR1"
    self.add_message("【商品代碼】中文轉英文: 小台近 → MXFR1")
```

## 🧪 **測試步驟**

### 步驟1: 重新測試「小台近」
1. **期貨下單頁籤**
2. **「或直接輸入」欄位** → 輸入 `小台近`
3. **點擊「使用此代碼」**
4. **觀察轉換訊息**

#### 預期看到的轉換訊息：
```
【商品代碼】中文轉英文: 小台近 → MXFR1
【下單準備】帳號:F0200006363839, 商品:MXFR1
```

### 步驟2: 設定參數並下單
1. **帳號**: `6363839`
2. **價格**: `22000`
3. **數量**: `1`
4. **啟動回報監控**
5. **送出下單**

### 步驟3: 觀察結果
#### 預期成功結果：
```
【商品代碼】中文轉英文: 小台近 → MXFR1
【Token】使用登入ID作為Token參數: E123354882
【API調用】SendFutureOrderCLR(Token: E123354882, 非同步: True)
【API返回】訊息: 14253
【API回應】SK_SUCCESS (代碼: 0)
【成功】期貨下單成功！
【委託回報】委託編號:14253,帳號:F0200006363839,商品:MXFR1,狀態:已委託
```

#### 不應該再看到：
```
❌ Code: 400, Message: ?p?x??無法轉換商品ID
```

## 🎯 **支援的中文代碼**

### 現在可以直接使用的中文代碼
- ✅ **小台近** → 自動轉換為 `MXFR1`
- ✅ **大台近** → 自動轉換為 `TXFR1`
- ✅ **電子近** → 自動轉換為 `TXER1`
- ✅ **金融近** → 自動轉換為 `TXFR1`

### 使用方式
1. **直接輸入中文** - 在「或直接輸入」欄位
2. **點擊「使用此代碼」** - 系統自動轉換
3. **觀察轉換結果** - 查看轉換訊息
4. **正常下單** - 使用轉換後的英文代碼

## 🔧 **技術實現**

### 智能代碼處理
```python
# 1. 檢查是否為中文代碼
if product_code in ["小台近", "大台近", "電子近", "金融近"]:
    # 轉換為英文代碼
    full_product_code = chinese_to_english[product_code]
    
# 2. 檢查是否為英文完整代碼
elif product_code.endswith("R1"):
    # 直接使用
    full_product_code = product_code
    
# 3. 傳統格式組合月份
else:
    full_product_code = f"{product_code}{month}"
```

### 轉換訊息顯示
- **中文轉英文**: `【商品代碼】中文轉英文: 小台近 → MXFR1`
- **直接使用**: `【商品代碼】使用完整代碼: MXFR1`
- **組合月份**: `【商品代碼】組合代碼: MTX + 202501 = MTX202501`

## 🎉 **優勢特色**

### 1. **用戶友好**
- ✅ **支援中文輸入** - 可以直接輸入「小台近」
- ✅ **自動轉換** - 無需記憶英文代碼
- ✅ **透明顯示** - 清楚顯示轉換過程

### 2. **技術可靠**
- ✅ **避免編碼問題** - 統一使用英文代碼下單
- ✅ **相容性好** - 支援中英文混合使用
- ✅ **錯誤處理** - 完整的轉換邏輯

### 3. **擴展性強**
- ✅ **易於添加** - 可以輕鬆添加更多中文代碼
- ✅ **維護簡單** - 集中管理轉換對照表

## 🔍 **故障排除**

### 如果轉換沒有生效
1. **檢查輸入** - 確認輸入的是「小台近」(完全一致)
2. **重新啟動** - 重新啟動程式載入新的轉換邏輯
3. **檢查訊息** - 觀察是否顯示轉換訊息

### 如果還是出現亂碼
1. **檢查程式版本** - 確認使用最新修改的版本
2. **檢查轉換邏輯** - 確認轉換功能正常運作
3. **直接使用英文** - 可以直接輸入 `MXFR1`

### 如果下單還是失敗
1. **檢查轉換結果** - 確認轉換為 `MXFR1`
2. **檢查其他參數** - 帳號、價格、數量是否正確
3. **測試英文代碼** - 直接使用 `MXFR1` 測試

## 🚀 **立即測試**

### 現在可以測試修復效果：

1. **重新啟動程式**
   ```bash
   cd "Python File"
   python OrderTester.py
   ```

2. **登入並啟動回報監控**

3. **測試中文轉英文**
   - 期貨下單頁籤
   - 輸入「小台近」
   - 點擊「使用此代碼」
   - 觀察轉換訊息

4. **完成下單測試**
   - 設定其他參數
   - 送出下單
   - 檢查回報結果

## 📊 **測試檢查清單**

### 轉換測試
- [ ] 輸入「小台近」
- [ ] 點擊「使用此代碼」
- [ ] 看到「中文轉英文: 小台近 → MXFR1」
- [ ] 商品選擇更新為包含 MXFR1 的選項

### 下單測試
- [ ] 設定帳號: 6363839
- [ ] 設定價格: 22000
- [ ] 設定數量: 1
- [ ] 啟動回報監控
- [ ] 送出下單

### 成功指標
- [ ] 看到中文轉英文訊息
- [ ] 下單準備訊息顯示 MXFR1
- [ ] 委託編號正常產生
- [ ] 委託回報顯示 MXFR1
- [ ] 沒有400錯誤或亂碼

**🎯 目標：成功使用「小台近」進行下單，系統自動轉換為 MXFR1！**

## 💡 **重要提醒**

1. **中文輸入完全支援** - 可以繼續使用「小台近」
2. **自動轉換透明** - 清楚顯示轉換過程
3. **英文代碼下單** - 實際使用 MXFR1 避免編碼問題
4. **相容性最佳** - 支援中英文混合使用

**🎉 現在可以放心使用「小台近」進行下單了！系統會自動處理編碼轉換問題！**

---
*中文商品代碼轉英文修復指南*
*時間: 2025-06-29*
*狀態: 解決中文編碼問題，支援自動轉換*
