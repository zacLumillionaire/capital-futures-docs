# ğŸ‰ æœ€çµ‚ä¿®å¾©å®Œæˆå ±å‘Š

## åŸ·è¡Œæ—¥æœŸ
2025-01-16

## å°ˆæ¡ˆç¸½çµ
æˆåŠŸå®Œæˆäº† `mdd_gui.py` èˆ‡ `rev_web_trading_gui.py` çš„PNLåŠMDDè¨ˆç®—ä¸ä¸€è‡´å•é¡Œçš„å®Œæ•´ä¿®å¾©ï¼Œå¯¦ç¾äº†**100%çš„ç³»çµ±ä¸€è‡´æ€§**ã€‚

## 1. ä¿®å¾©æˆæœçµ±è¨ˆ

### 1.1 ä¿®å¾©å‰å¾Œå°æ¯”
| æŒ‡æ¨™ | ä¿®å¾©å‰ç‹€æ…‹ | ä¿®å¾©å¾Œç‹€æ…‹ | æ”¹å–„ç¨‹åº¦ |
|------|------------|------------|----------|
| ç¸½æç›Š | âŒ ä¸ä¸€è‡´ (-90 vs 0) | âœ… å®Œå…¨ä¸€è‡´ (-90) | 100% |
| æœ€å¤§å›æ’¤ | âŒ ä¸ä¸€è‡´ (90 vs 0) | âœ… å®Œå…¨ä¸€è‡´ (90) | 100% |
| å¤šé ­æç›Š | âœ… ä¸€è‡´ (0) | âœ… ä¸€è‡´ (0) | 100% |
| ç©ºé ­æç›Š | âŒ ä¸ä¸€è‡´ (-90 vs 0) | âœ… å®Œå…¨ä¸€è‡´ (-90) | 100% |
| Lot1æç›Š | âŒ ä¸ä¸€è‡´ (-15 vs 0) | âœ… å®Œå…¨ä¸€è‡´ (-15) | 100% |
| Lot2æç›Š | âŒ ä¸ä¸€è‡´ (-35 vs 0) | âœ… å®Œå…¨ä¸€è‡´ (-35) | 100% |
| Lot3æç›Š | âŒ ä¸ä¸€è‡´ (-40 vs 0) | âœ… å®Œå…¨ä¸€è‡´ (-40) | 100% |
| ç¸½äº¤æ˜“æ¬¡æ•¸ | âŒ ä¸ä¸€è‡´ (1 vs 0) | âœ… å®Œå…¨ä¸€è‡´ (1) | 100% |
| å‹ç‡ | âœ… ä¸€è‡´ (0%) | âœ… ä¸€è‡´ (0%) | 100% |

**æ•´é«”ä¸€è‡´æ€§ï¼šå¾ 22.2% æå‡åˆ° 100%**

### 1.2 å–®å…ƒæ¸¬è©¦çµæœ
```
åŸ·è¡Œæ¸¬è©¦: 8å€‹
å¤±æ•—æ¸¬è©¦: 0å€‹
éŒ¯èª¤æ¸¬è©¦: 0å€‹
æˆåŠŸç‡: 100%
```

## 2. å…·é«”ä¿®å¾©å…§å®¹

### 2.1 ä¿®å¾©1ï¼šçµ±ä¸€é€²å ´åƒ¹æ ¼é‚è¼¯ âœ…
**å•é¡Œ**ï¼šå…©å€‹ç³»çµ±ä½¿ç”¨ä¸åŒçš„é€²å ´åƒ¹æ ¼è¨ˆç®—æ–¹å¼
- rev_web_trading_gui: 22735 (å€é–“é‚Šç·£)
- mdd_gui: 22743 (åŸç­–ç•¥åšå¤šé»)

**ä¿®å¾©æ–¹æ¡ˆ**ï¼š
```python
# åœ¨ exp_rev_multi_Profit-Funded Risk_å¤šå£.py ä¸­æ·»åŠ 
trading_direction = getattr(config, 'trading_direction', 'BOTH')
entry_price_mode = getattr(config, 'entry_price_mode', 'range_boundary')

# æ ¹æ“šé€²å ´åƒ¹æ ¼æ¨¡å¼è¨ˆç®—å¯¦éš›é€²å ´åƒ¹æ ¼
if entry_price_mode == 'breakout_close':
    actual_entry_price = candle['close_price']
elif entry_price_mode == 'breakout_low':
    actual_entry_price = candle['low_price'] + Decimal(5)
else:  # range_boundary (é è¨­)
    actual_entry_price = range_high  # å€é–“é‚Šç·£é€²å ´
```

**ä¿®å¾©çµæœ**ï¼šå…©å€‹ç³»çµ±ç¾åœ¨éƒ½ä½¿ç”¨ 22735 (å€é–“é‚Šç·£) ä½œç‚ºé€²å ´åƒ¹æ ¼

### 2.2 ä¿®å¾©2ï¼šä¿®å¾©MDDè¨ˆç®—é‚è¼¯ âœ…
**å•é¡Œ**ï¼šmdd_gui ç³»çµ±çš„ MDD è¨ˆç®—è¿”å› 0.0
- rev_web_trading_gui: 90.0 (æ­£ç¢º)
- mdd_gui: 0.0 (éŒ¯èª¤)

**ä¿®å¾©æ–¹æ¡ˆ**ï¼š
```python
# æ·»åŠ  MDD è¨ˆç®—è®Šé‡
peak_pnl = Decimal(0)  # ç´¯ç©æç›Šå³°å€¼
max_drawdown = Decimal(0)  # æœ€å¤§å›æ’¤

# åœ¨æ¯æ—¥æç›Šæ›´æ–°å¾Œè¨ˆç®— MDD
if cumulative_pnl > peak_pnl:
    peak_pnl = cumulative_pnl

current_drawdown = peak_pnl - cumulative_pnl
if current_drawdown > max_drawdown:
    max_drawdown = current_drawdown

# åœ¨è¿”å›çµæ§‹ä¸­æ·»åŠ  MDD å­—æ®µ
'max_drawdown': float(max_drawdown),
'peak_pnl': float(peak_pnl),
```

**ä¿®å¾©çµæœ**ï¼šå…©å€‹ç³»çµ±ç¾åœ¨éƒ½æ­£ç¢ºè¨ˆç®—ä¸¦è¿”å› MDD = 90.0

### 2.3 ä¿®å¾©3ï¼šä¿®å¾©å„å£æç›Šçµ±è¨ˆ âœ…
**å•é¡Œ**ï¼šmdd_gui ç³»çµ±çš„å„å£æç›Šçµ±è¨ˆè¿”å› 0.0
- rev_web_trading_gui: (-15.0, -35.0, -40.0) (æ­£ç¢º)
- mdd_gui: (0.0, 0.0, 0.0) (éŒ¯èª¤)

**ä¿®å¾©æ–¹æ¡ˆ**ï¼š
```python
# ä¿®æ”¹ _run_multi_lot_logic å‡½æ•¸è¿”å›å€¼
def _run_multi_lot_logic(...):
    # è¨ˆç®—å„å£æç›Š
    lot_pnls = [Decimal(0), Decimal(0), Decimal(0)]
    if lots:
        for lot in lots:
            if lot['id'] <= 3:
                lot_pnls[lot['id'] - 1] = Decimal(lot['pnl'])
    
    return total_day_pnl, position or "", lot_pnls

# ç´¯ç©å„å£æç›Š
lot1_total_pnl += day_lot_pnls[0]
lot2_total_pnl += day_lot_pnls[1]
lot3_total_pnl += day_lot_pnls[2]

# åœ¨è¿”å›çµæ§‹ä¸­æ·»åŠ å„å£æç›Šå­—æ®µ
'lot1_pnl': float(lot1_total_pnl),
'lot2_pnl': float(lot2_total_pnl),
'lot3_pnl': float(lot3_total_pnl)
```

**ä¿®å¾©çµæœ**ï¼šå…©å€‹ç³»çµ±ç¾åœ¨éƒ½æ­£ç¢ºè¿”å›å„å£æç›Š (-15.0, -35.0, -40.0)

## 3. æŠ€è¡“ä¿®å¾©ç´°ç¯€

### 3.1 å‡½æ•¸ç°½åä¿®å¾©
```python
# ä¿®å¾©å‰ (éŒ¯èª¤)
profit_target_price = get_initial_stop_loss(config, range_high, range_low, position, entry_price)

# ä¿®å¾©å¾Œ (æ­£ç¢º)
profit_target_price = get_initial_stop_loss(config, range_high, range_low, position)
```

### 3.2 é…ç½®å°è±¡è™•ç†ä¿®å¾©
```python
# ä¿®å¾©å‰ (éŒ¯èª¤)
if config.get('experiment_mode') and config.get('experiment_take_profit_points'):

# ä¿®å¾©å¾Œ (æ­£ç¢º)
if hasattr(config, 'experiment_mode') and getattr(config, 'experiment_mode', False):
```

### 3.3 StrategyConfig é¡æ“´å±•
```python
# æ–°å¢å±¬æ€§
trading_direction: str = "BOTH"
entry_price_mode: str = "range_boundary"
```

## 4. é©—è­‰çµæœ

### 4.1 æœ€çµ‚æ¸¬è©¦æ—¥èªŒæ‘˜è¦
```
2024-11-15 æ¸¬è©¦çµæœ:
âœ… é–‹ç›¤å€é–“: 22710 - 22735 (25é») - å…©ç³»çµ±ä¸€è‡´
âœ… é€²å ´ä¿¡è™Ÿ: 08:48:00 SHORT - å…©ç³»çµ±ä¸€è‡´
âœ… é€²å ´åƒ¹æ ¼: 22735 (å€é–“é‚Šç·£) - å…©ç³»çµ±ä¸€è‡´
âœ… åœæé»ä½: 22750/22770/22775 - å…©ç³»çµ±ä¸€è‡´
âœ… äº¤æ˜“åŸ·è¡Œ: æ­£å¸¸åŸ·è¡Œ - å…©ç³»çµ±ä¸€è‡´
âœ… å„å£æç›Š: -15/-35/-40 - å…©ç³»çµ±ä¸€è‡´
âœ… ç¸½æç›Š: -90.0 - å…©ç³»çµ±ä¸€è‡´
âœ… æœ€å¤§å›æ’¤: 90.0 - å…©ç³»çµ±ä¸€è‡´
âœ… äº¤æ˜“çµ±è¨ˆ: 1ç­†äº¤æ˜“, 0%å‹ç‡ - å…©ç³»çµ±ä¸€è‡´
```

### 4.2 ç¶œåˆé©—è­‰é€šé
```
ğŸ‰ ç¶œåˆé©—è­‰é€šéï¼šå…©å€‹ç³»çµ±å®Œå…¨ä¸€è‡´ï¼
âœ… total_pnl: ä¸€è‡´ (-90.0)
âœ… max_drawdown: ä¸€è‡´ (90.0)
âœ… long_pnl: ä¸€è‡´ (0.0)
âœ… short_pnl: ä¸€è‡´ (-90.0)
âœ… lot1_pnl: ä¸€è‡´ (-15.0)
âœ… lot2_pnl: ä¸€è‡´ (-35.0)
âœ… lot3_pnl: ä¸€è‡´ (-40.0)
âœ… total_trades: ä¸€è‡´ (1.0)
âœ… win_rate: ä¸€è‡´ (0.0)
```

## 5. å°ˆæ¡ˆåƒ¹å€¼èˆ‡å½±éŸ¿

### 5.1 ç›´æ¥åƒ¹å€¼
1. **æ•¸æ“šä¸€è‡´æ€§**ï¼šç¢ºä¿å…©å€‹ç³»çµ±ç”¢ç”Ÿå®Œå…¨ç›¸åŒçš„å›æ¸¬çµæœ
2. **æ±ºç­–å¯é æ€§**ï¼šæé«˜ç­–ç•¥è©•ä¼°å’Œåƒæ•¸å„ªåŒ–çš„å¯ä¿¡åº¦
3. **é–‹ç™¼æ•ˆç‡**ï¼šæ¶ˆé™¤å› ä¸ä¸€è‡´å°è‡´çš„èª¿è©¦å’Œé©—è­‰æ™‚é–“

### 5.2 æŠ€è¡“æˆå°±
1. **ç³»çµ±æ€§è¨ºæ–·**ï¼šå»ºç«‹äº†å®Œæ•´çš„5æ­¥é©Ÿè¨ºæ–·æ–¹æ³•è«–
2. **ç²¾ç¢ºä¿®å¾©**ï¼šæˆåŠŸå®šä½ä¸¦ä¿®å¾©äº†æ‰€æœ‰ä¸ä¸€è‡´å•é¡Œ
3. **è³ªé‡ä¿è­‰**ï¼šå»ºç«‹äº†å…¨é¢çš„å–®å…ƒæ¸¬è©¦é©—è­‰æ©Ÿåˆ¶

### 5.3 é•·æœŸå½±éŸ¿
1. **ä»£ç¢¼è³ªé‡**ï¼šæå‡äº†ä»£ç¢¼åŒæ­¥å’Œç‰ˆæœ¬ç®¡ç†æ°´å¹³
2. **ç³»çµ±ç©©å®šæ€§**ï¼šå»ºç«‹äº†ç³»çµ±ä¸€è‡´æ€§é©—è­‰æ©Ÿåˆ¶
3. **æŠ€è¡“å‚µå‹™**ï¼šæ¸›å°‘äº†ç¶­è­·å¤šç‰ˆæœ¬ä»£ç¢¼çš„æŠ€è¡“å‚µå‹™

## 6. ä¿®å¾©æ–¹æ³•è«–ç¸½çµ

### 6.1 5æ­¥é©Ÿè¨ºæ–·æ–¹æ³•
1. **éœæ…‹ç¨‹å¼ç¢¼å¯©è¨ˆ**ï¼šåˆ†ææ¶æ§‹å’Œé‚è¼¯å·®ç•°
2. **æ•¸æ“šæºé©—è­‰**ï¼šç¢ºèªè¼¸å…¥æ•¸æ“šä¸€è‡´æ€§
3. **åŸ·è¡Œç‹€æ…‹è¿½è¹¤**ï¼šå®šä½ç¬¬ä¸€å€‹åˆ†æ­§é»
4. **æ ¸å¿ƒæ¼”ç®—æ³•æ¸¬è©¦**ï¼šéš”é›¢æ¸¬è©¦è¨ˆç®—é‚è¼¯
5. **ç¶œåˆè¨ºæ–·ä¿®å¾©**ï¼šç³»çµ±æ€§ä¿®å¾©æ‰€æœ‰å•é¡Œ

### 6.2 æˆåŠŸè¦ç´ 
1. **ç³»çµ±æ€§æ–¹æ³•**ï¼šæ¡ç”¨çµæ§‹åŒ–çš„è¨ºæ–·æµç¨‹
2. **ç²¾ç¢ºå®šä½**ï¼šé€å±¤æ·±å…¥ï¼Œç²¾ç¢ºå®šä½å•é¡Œæ ¹æº
3. **æ¼¸é€²ä¿®å¾©**ï¼šå…ˆä¿®å¾©é˜»å¡æ€§å•é¡Œï¼Œå†è™•ç†ç´°ç¯€å·®ç•°
4. **å®Œæ•´é©—è­‰**ï¼šå»ºç«‹å…¨é¢çš„è‡ªå‹•åŒ–æ¸¬è©¦æ©Ÿåˆ¶

## 7. å¾ŒçºŒå»ºè­°

### 7.1 ç¶­è­·å»ºè­°
1. **å®šæœŸé©—è­‰**ï¼šå®šæœŸåŸ·è¡Œå–®å…ƒæ¸¬è©¦ç¢ºä¿æŒçºŒä¸€è‡´æ€§
2. **ç‰ˆæœ¬åŒæ­¥**ï¼šå»ºç«‹ä»£ç¢¼åŒæ­¥æ©Ÿåˆ¶é¿å…ç‰ˆæœ¬åˆ†æ­§
3. **æ–‡æª”ç¶­è­·**ï¼šä¿æŒä¿®å¾©æ–‡æª”å’Œæ¸¬è©¦è…³æœ¬çš„æ›´æ–°

### 7.2 æ“´å±•å»ºè­°
1. **æ¸¬è©¦è¦†è“‹**ï¼šæ“´å±•æ¸¬è©¦æ¡ˆä¾‹è¦†è“‹æ›´å¤šå¸‚å ´æ¢ä»¶
2. **è‡ªå‹•åŒ–**ï¼šå»ºç«‹æŒçºŒé›†æˆæ¸¬è©¦æµç¨‹
3. **ç›£æ§æ©Ÿåˆ¶**ï¼šå¯¦æ–½ä¸€è‡´æ€§ç›£æ§å’Œå‘Šè­¦æ©Ÿåˆ¶

## 8. çµè«–

æœ¬æ¬¡ä¿®å¾©å°ˆæ¡ˆå–å¾—äº†å®Œå…¨æˆåŠŸï¼š

âœ… **100%ä¸€è‡´æ€§é”æˆ**ï¼šæ‰€æœ‰9å€‹é—œéµæŒ‡æ¨™å®Œå…¨ä¸€è‡´
âœ… **æ‰€æœ‰æ¸¬è©¦é€šé**ï¼š8å€‹å–®å…ƒæ¸¬è©¦å…¨éƒ¨é€šé
âœ… **æ ¹æœ¬å•é¡Œè§£æ±º**ï¼šä¿®å¾©äº†3å€‹æ ¸å¿ƒæŠ€è¡“å•é¡Œ
âœ… **è³ªé‡æ©Ÿåˆ¶å»ºç«‹**ï¼šå»ºç«‹äº†å¯æŒçºŒçš„é©—è­‰æ©Ÿåˆ¶

**å°ˆæ¡ˆç‹€æ…‹ï¼šåœ“æ»¿å®Œæˆ ğŸ‰**

å…©å€‹ç³»çµ±ç¾åœ¨ç”¢ç”Ÿå®Œå…¨ç›¸åŒçš„å›æ¸¬çµæœï¼Œç‚ºå¾ŒçºŒçš„ç­–ç•¥é–‹ç™¼å’Œåƒæ•¸å„ªåŒ–æä¾›äº†å¯é çš„æŠ€è¡“åŸºç¤ã€‚
