# å£ç´šåˆ¥è¿½åƒ¹æ©Ÿåˆ¶æŠ€è¡“æ¶æ§‹èˆ‡å¯¦ç¾æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡ä»¶è©³ç´°åˆ†æ simple_integrated.py ç­–ç•¥ä¸‹å–®æ©Ÿä¸­çš„å£ç´šåˆ¥è¿½åƒ¹æ©Ÿåˆ¶é‡å¤§æ›´æ–°ï¼Œå°æ¯”é–‹ç™¼ç­†è¨˜èˆ‡å¯¦éš›ä»£ç¢¼ï¼Œæä¾›å®Œæ•´çš„æŠ€è¡“æ¶æ§‹å’Œå¯¦ç¾æŒ‡å—ã€‚

## ğŸš€ æ ¸å¿ƒæ¶æ§‹é‡æ§‹

### å•é¡ŒèƒŒæ™¯

åŸå§‹ç³»çµ±å­˜åœ¨çµ„ç´šåˆ¥è¨ˆæ•¸å™¨å…±äº«å•é¡Œï¼š
```
ç¬¬1å£å–æ¶ˆ â†’ è§¸ç™¼ç¬¬1æ¬¡è¿½åƒ¹ â†’ group.retry_count = 1 âœ…
ç¬¬2å£å–æ¶ˆ â†’ è·³éï¼ˆå·²åœ¨è¿½åƒ¹ä¸­ï¼‰âš ï¸
ç¬¬3å£å–æ¶ˆ â†’ è§¸ç™¼"ç¬¬2æ¬¡"è¿½åƒ¹ âŒ éŒ¯èª¤ï¼æ‡‰è©²æ˜¯ç¬¬1æ¬¡
```

### è§£æ±ºæ–¹æ¡ˆ

å¾¹åº•é‡æ§‹ç‚ºå£ç´šåˆ¥è¿½åƒ¹æ©Ÿåˆ¶ï¼Œæ¯å£ç¨ç«‹è¨ˆæ•¸å’Œé–å®šã€‚

## ğŸ”§ StrategyGroup é¡å¢å¼·

### å£ç´šåˆ¥å­—æ®µè¨­è¨ˆ

**ä½ç½®**: `simplified_order_tracker.py` ç¬¬283-305è¡Œ

<augment_code_snippet path="Capital_Official_Framework/simplified_order_tracker.py" mode="EXCERPT">
````python
@dataclass
class StrategyGroup:
    """ç­–ç•¥çµ„è¿½è¹¤å™¨ - ğŸ”§ ä¿®å¾©ï¼šæ”¯æ´å£ç´šåˆ¥è¿½åƒ¹æ©Ÿåˆ¶"""
    group_id: int
    total_lots: int          # é æœŸä¸‹å–®å£æ•¸
    direction: str           # LONG/SHORT
    target_price: float      # ç›®æ¨™åƒ¹æ ¼
    product: str             # å•†å“ä»£ç¢¼

    # çµ±è¨ˆæ•¸æ“š
    submitted_lots: int = 0   # å·²é€å‡ºå£æ•¸
    filled_lots: int = 0      # å·²æˆäº¤å£æ•¸
    cancelled_lots: int = 0   # å·²å–æ¶ˆå£æ•¸

    # ğŸ”§ ä¿®å¾©ï¼šå£ç´šåˆ¥è¿½åƒ¹æ§åˆ¶
    retry_count: int = 0      # çµ„ç´šåˆ¥è¿½åƒ¹æ¬¡æ•¸ï¼ˆçµ±è¨ˆç”¨ï¼‰
    max_retries: int = 5      # æ¯å£æœ€å¤§è¿½åƒ¹æ¬¡æ•¸
    individual_retry_counts: dict = field(default_factory=dict)  # æ¯å£çš„è¿½åƒ¹æ¬¡æ•¸ {lot_index: retry_count}
    price_tolerance: float = 10.0  # åƒ¹æ ¼å®¹å·®(é») - èª¿æ•´ç‚º10é»ä»¥é©æ‡‰æ»‘åƒ¹

    # ğŸ”§ æ–°å¢ï¼šè¿½åƒ¹è¡Œç‚ºæ§åˆ¶é–‹é—œ
    enable_cancel_retry: bool = True    # æ˜¯å¦å•Ÿç”¨å–æ¶ˆè¿½åƒ¹ï¼ˆFOKå¤±æ•—ï¼‰
    enable_partial_retry: bool = False  # æ˜¯å¦å•Ÿç”¨éƒ¨åˆ†æˆäº¤è¿½åƒ¹ï¼ˆå£æ•¸ä¸ç¬¦ï¼‰
````
</augment_code_snippet>

### å£ç´šåˆ¥æ–¹æ³•å¯¦ç¾

**æ ¸å¿ƒæ–¹æ³•**:
1. `needs_retry_for_lot(lot_index)` - æª¢æŸ¥ç‰¹å®šå£æ˜¯å¦éœ€è¦è¿½åƒ¹
2. `increment_retry_for_lot(lot_index)` - å¢åŠ ç‰¹å®šå£çš„è¿½åƒ¹æ¬¡æ•¸
3. `complete_retry_for_lot(lot_index)` - å®Œæˆç‰¹å®šå£çš„è¿½åƒ¹

## ğŸ¯ ExitGroup é¡æ–°å¢

### å¹³å€‰çµ„è¿½è¹¤å™¨è¨­è¨ˆ

**ä½ç½®**: `simplified_order_tracker.py` ç¬¬72-95è¡Œ

<augment_code_snippet path="Capital_Official_Framework/simplified_order_tracker.py" mode="EXCERPT">
````python
@dataclass
class ExitGroup:
    """å¹³å€‰çµ„è¿½è¹¤å™¨ - ğŸ”§ ä¿®å¾©ï¼šæ”¯æ´å£ç´šåˆ¥å¹³å€‰è¿½åƒ¹æ©Ÿåˆ¶"""
    position_id: int
    total_lots: int          # éœ€è¦å¹³å€‰çš„ç¸½å£æ•¸
    direction: str           # åŸå§‹éƒ¨ä½æ–¹å‘ (LONG/SHORT)
    exit_direction: str      # å¹³å€‰æ–¹å‘ (SHORT/LONG)
    target_price: float      # ç›®æ¨™å¹³å€‰åƒ¹æ ¼
    product: str             # å•†å“ä»£ç¢¼

    # çµ±è¨ˆæ•¸æ“š
    submitted_lots: int = 0   # å·²é€å‡ºå¹³å€‰å£æ•¸
    filled_lots: int = 0      # å·²å¹³å€‰å£æ•¸
    cancelled_lots: int = 0   # å·²å–æ¶ˆå£æ•¸

    # ğŸ”§ ä¿®å¾©ï¼šå£ç´šåˆ¥å¹³å€‰è¿½åƒ¹æ§åˆ¶
    retry_count: int = 0      # çµ„ç´šåˆ¥è¿½åƒ¹æ¬¡æ•¸ï¼ˆçµ±è¨ˆç”¨ï¼‰
    max_retries: int = 5      # æ¯å£æœ€å¤§è¿½åƒ¹æ¬¡æ•¸
    individual_retry_counts: dict = field(default_factory=dict)  # æ¯å£çš„è¿½åƒ¹æ¬¡æ•¸ {lot_index: retry_count}
    price_tolerance: float = 10.0  # åƒ¹æ ¼å®¹å·®(é»)

    # ğŸ”§ æ–°å¢ï¼šå¹³å€‰è¿½åƒ¹è¡Œç‚ºæ§åˆ¶é–‹é—œ
    enable_cancel_retry: bool = True    # æ˜¯å¦å•Ÿç”¨å–æ¶ˆè¿½åƒ¹ï¼ˆFOKå¤±æ•—ï¼‰
    enable_partial_retry: bool = False  # æ˜¯å¦å•Ÿç”¨éƒ¨åˆ†æˆäº¤è¿½åƒ¹ï¼ˆå£æ•¸ä¸ç¬¦ï¼‰
````
</augment_code_snippet>

## ğŸ”’ å…¨å±€ç®¡ç†å™¨å¢å¼·

### GlobalRetryManager å£ç´šåˆ¥é–å®š

**æ”¯æ´æ–¹æ³•**:
- `mark_retry_with_lot(group_key, lot_index)` - æ¨™è¨˜å£ç´šåˆ¥è¿½åƒ¹ç‹€æ…‹
- `clear_retry_for_lot(group_key, lot_index)` - æ¸…é™¤å£ç´šåˆ¥è¿½åƒ¹ç‹€æ…‹

### GlobalExitManager å£ç´šåˆ¥é–å®š

**ä½ç½®**: `simplified_order_tracker.py` ç¬¬214-262è¡Œ

<augment_code_snippet path="Capital_Official_Framework/simplified_order_tracker.py" mode="EXCERPT">
````python
def mark_exit_with_lot(self, position_id: str, lot_index: int, trigger_source: str = "unknown", exit_type: str = "stop_loss") -> bool:
    """
    æ¨™è¨˜å£ç´šåˆ¥å¹³å€‰ç‹€æ…‹ - ğŸ”§ ä¿®å¾©ï¼šæ”¯æ´å£ç´šåˆ¥é–å®š

    Args:
        position_id: éƒ¨ä½ID
        lot_index: å£ç´¢å¼•
        trigger_source: è§¸ç™¼ä¾†æº
        exit_type: å¹³å€‰é¡å‹
    """
    lot_key = f"{position_id}_lot_{lot_index}"
    if self.can_exit_lot(position_id, lot_index):
        self.exit_locks[lot_key] = {
            'timestamp': time.time(),
            'trigger_source': trigger_source,
            'exit_type': exit_type
        }
        return True
    return False

def can_exit_lot(self, position_id: str, lot_index: int) -> bool:
    """æª¢æŸ¥ç‰¹å®šå£æ˜¯å¦å¯ä»¥å¹³å€‰"""
    lot_key = f"{position_id}_lot_{lot_index}"
    current_time = time.time()
    exit_info = self.exit_locks.get(lot_key)

    if not exit_info:
        return True

    time_diff = current_time - exit_info['timestamp']
    if time_diff >= self.exit_timeout:
        # è¶…æ™‚ï¼Œæ¸…é™¤é–å®š
        self.exit_locks.pop(lot_key, None)
        return True

    return False
````
</augment_code_snippet>

## ğŸ¯ å»ºå€‰è¿½åƒ¹æ©Ÿåˆ¶æµç¨‹

### ä¿®å¾©å¾Œçš„å»ºå€‰è¿½åƒ¹æµç¨‹

```
1. ç­–ç•¥çµ„è¨»å†Š
   â†“
2. å»ºå€‰FOKä¸‹å–®ï¼ˆå¤šå£ï¼‰
   â†“
3. ç¬¬1å£FOKå¤±æ•— â†’ å–æ¶ˆå›å ±
   â†“
4. è¨ˆç®—ç•¶å‰å£ç´¢å¼•: current_lot_index = group.cancelled_lots + 1
   â†“
5. æª¢æŸ¥è©²å£æ˜¯å¦éœ€è¦è¿½åƒ¹: group.needs_retry_for_lot(current_lot_index)
   â†“
6. å…¨å±€é–å®šæª¢æŸ¥: global_retry_manager.mark_retry_with_lot(group_key, current_lot_index)
   â†“
7. å¢åŠ è©²å£è¿½åƒ¹æ¬¡æ•¸: group.increment_retry_for_lot(current_lot_index)
   â†“
8. è¨ˆç®—è¿½åƒ¹åƒ¹æ ¼:
      - LONG: ASK1 + retry_count (å‘ä¸Šè¿½åƒ¹)
      - SHORT: BID1 - retry_count (å‘ä¸‹è¿½åƒ¹)
   â†“
9. åŸ·è¡Œè¿½åƒ¹ä¸‹å–®
   â†“
10. é‡è¤‡æ­¥é©Ÿ3-9ç›´åˆ°æˆäº¤æˆ–é”åˆ°æœ€å¤§é‡è©¦æ¬¡æ•¸(5æ¬¡)
```

### å–æ¶ˆå›å ±è™•ç†é‚è¼¯

**ä½ç½®**: `simplified_order_tracker.py` ç¬¬932-948è¡Œ

<augment_code_snippet path="Capital_Official_Framework/simplified_order_tracker.py" mode="EXCERPT">
````python
# ğŸ”§ ä¿®å¾©ï¼šä½¿ç”¨å£ç´šåˆ¥çš„è¿½åƒ¹æª¢æŸ¥
if group.needs_retry_for_lot(current_lot_index):
    # ğŸ”§ ä¿®å¾©ï¼šä½¿ç”¨å£ç´šåˆ¥çš„å…¨å±€è¿½åƒ¹ç®¡ç†å™¨
    group_key = f"group_{group.group_id}_{group.product}"

    if self.global_retry_manager.mark_retry_with_lot(group_key, current_lot_index):
        retry_lots = 1  # æ¯æ¬¡åªè¿½åƒ¹1å£
        if retry_lots > 0:
            # ğŸ”§ ä¿®å¾©ï¼šä½¿ç”¨å£ç´šåˆ¥çš„è¿½åƒ¹è¨ˆæ•¸
            individual_retry_count = group.increment_retry_for_lot(current_lot_index)
            group.is_retrying = True

            retry_type = "éƒ¨åˆ†æˆäº¤è¿½åƒ¹" if is_partial_fill else "å–æ¶ˆè¿½åƒ¹"
            if self.console_enabled:
                print(f"[SIMPLIFIED_TRACKER] ğŸ”„ ç­–ç•¥çµ„{group.group_id}ç¬¬{current_lot_index}å£è§¸ç™¼{retry_type}: "
                      f"ç¬¬{individual_retry_count}æ¬¡, {retry_lots}å£ (å£ç´šåˆ¥é–å®š)")
````
</augment_code_snippet>

## ğŸ¯ åœæå¹³å€‰è¿½åƒ¹æ©Ÿåˆ¶

### åœæå¹³å€‰è¿½åƒ¹æµç¨‹

```
1. åœææ¢ä»¶è§¸ç™¼
   â†“
2. èª¿ç”¨ stop_loss_executor.execute_stop_loss()
   â†“
3. è¨»å†Šåœæå¹³å€‰çµ„åˆ°å£ç´šåˆ¥è¿½è¹¤ç³»çµ± âœ… (æ–°å¢)
   â†“
4. åŸ·è¡Œ FOK å¹³å€‰ä¸‹å–®
   â†“
5. è¨»å†Šå¹³å€‰è¨‚å–®åˆ°ç°¡åŒ–è¿½è¹¤å™¨ âœ…
   â†“
6. å¦‚æœ FOK å¤±æ•— â†’ è§¸ç™¼å£ç´šåˆ¥å¹³å€‰è¿½åƒ¹ âœ…
   â†“
7. ä½¿ç”¨å¹³å€‰è¿½åƒ¹é‚è¼¯:
      - LONGå¹³å€‰: BID1 - retry_count (å‘ä¸‹è¿½åƒ¹)
      - SHORTå¹³å€‰: ASK1 + retry_count (å‘ä¸Šè¿½åƒ¹)
   â†“
8. æ¯å£æœ€å¤š5æ¬¡è¿½åƒ¹æ©Ÿæœƒ âœ…
   â†“
9. å£ç´šåˆ¥ç¨ç«‹é–å®šé˜²æ­¢é‡è¤‡ âœ…
```

### åœæåŸ·è¡Œå™¨å¢å¼·

**ä½ç½®**: `stop_loss_executor.py` ç¬¬254-267è¡Œ

```python
# ğŸ”§ ä¿®å¾©ï¼šè¨»å†Šåœæå¹³å€‰çµ„åˆ°å£ç´šåˆ¥è¿½è¹¤ç³»çµ±
if self.simplified_tracker:
    exit_direction_for_group = "SELL" if trigger_info.direction == "LONG" else "BUY"
    self.simplified_tracker.register_exit_group(
        position_id=position_id,
        total_lots=1,  # åœæé€šå¸¸æ˜¯1å£
        direction=trigger_info.direction,
        exit_direction=exit_direction_for_group,
        target_price=trigger_info.current_price,
        product="TM0000"
    )
```

### å¹³å€‰å–æ¶ˆå›å ±è™•ç†

**ä½ç½®**: `simplified_order_tracker.py` ç¬¬1586-1597è¡Œ

<augment_code_snippet path="Capital_Official_Framework/simplified_order_tracker.py" mode="EXCERPT">
````python
# ğŸ”§ ä¿®å¾©ï¼šä½¿ç”¨å£ç´šåˆ¥çš„å¹³å€‰è¿½åƒ¹æª¢æŸ¥
if exit_group.needs_retry_for_lot(current_lot_index):
    # ğŸ”§ ä¿®å¾©ï¼šä½¿ç”¨å£ç´šåˆ¥çš„å…¨å±€å¹³å€‰ç®¡ç†å™¨
    if self.global_exit_manager.mark_exit_with_lot(str(position_id), current_lot_index, "exit_cancel_retry", "cancel_retry"):
        # ğŸ”§ ä¿®å¾©ï¼šä½¿ç”¨å£ç´šåˆ¥çš„å¹³å€‰è¿½åƒ¹è¨ˆæ•¸
        individual_retry_count = exit_group.increment_retry_for_lot(current_lot_index)
        exit_group.is_retrying = True

        if self.console_enabled:
            print(f"[SIMPLIFIED_TRACKER] ğŸ”„ å¹³å€‰çµ„{position_id}ç¬¬{current_lot_index}å£è§¸ç™¼è¿½åƒ¹: "
                  f"ç¬¬{individual_retry_count}æ¬¡, {cancel_qty}å£ (å£ç´šåˆ¥é–å®š)")
````
</augment_code_snippet>

## ğŸ“Š å¤šçµ„ç­–ç•¥æ”¯æ´

### çµ„é–“å®Œå…¨ç¨ç«‹

**çµ„ç´šåˆ¥ç¨ç«‹è¨ˆæ•¸**:
```python
# ç¬¬1çµ„ç­–ç•¥ (çµ„ID: 9)
group_9.individual_retry_counts = {1: 1, 2: 1, 3: 1}  # æ¯å£ç¬¬1æ¬¡è¿½åƒ¹

# ç¬¬2çµ„ç­–ç•¥ (çµ„ID: 10)  
group_10.individual_retry_counts = {1: 1, 2: 1, 3: 1} # æ¯å£ç¬¬1æ¬¡è¿½åƒ¹
```

### å…¨å±€é–å®šç¨ç«‹

**é–å®šéµå€¼è¨­è¨ˆ**:
```python
# ç¬¬1çµ„çš„é–å®šéµå€¼
"group_9_TM0000_lot_1"  # ç¬¬1çµ„ç¬¬1å£
"group_9_TM0000_lot_2"  # ç¬¬1çµ„ç¬¬2å£
"group_9_TM0000_lot_3"  # ç¬¬1çµ„ç¬¬3å£

# ç¬¬2çµ„çš„é–å®šéµå€¼
"group_10_TM0000_lot_1" # ç¬¬2çµ„ç¬¬1å£
"group_10_TM0000_lot_2" # ç¬¬2çµ„ç¬¬2å£
"group_10_TM0000_lot_3" # ç¬¬2çµ„ç¬¬3å£
```

## ğŸ”§ è¨»å†Šæ©Ÿåˆ¶å¯¦ç¾

### ç­–ç•¥çµ„è¨»å†Š

**ä½ç½®**: `simplified_order_tracker.py` ç¬¬583-608è¡Œ

<augment_code_snippet path="Capital_Official_Framework/simplified_order_tracker.py" mode="EXCERPT">
````python
# å‰µå»ºç­–ç•¥çµ„
strategy_group = StrategyGroup(
    group_id=group_id,
    total_lots=total_lots,
    direction=direction,
    target_price=target_price,
    product=product,
    # ğŸ”§ æ–°å¢ï¼šä½¿ç”¨å…¨å±€é è¨­è¿½åƒ¹è¨­å®š
    enable_cancel_retry=self.default_enable_cancel_retry,
    enable_partial_retry=self.default_enable_partial_retry
)

self.strategy_groups[group_id] = strategy_group
self.total_groups += 1

if self.console_enabled:
    print(f"[SIMPLIFIED_TRACKER] ğŸ“ è¨»å†Šç­–ç•¥çµ„: {group_id} "
          f"{direction} {product} {total_lots}å£ @{target_price:.0f}")
````
</augment_code_snippet>

### å¹³å€‰çµ„è¨»å†Š

**ä½ç½®**: `simplified_order_tracker.py` ç¬¬632-653è¡Œ

<augment_code_snippet path="Capital_Official_Framework/simplified_order_tracker.py" mode="EXCERPT">
````python
# å‰µå»ºå¹³å€‰çµ„
exit_group = ExitGroup(
    position_id=position_id,
    total_lots=total_lots,
    direction=direction,
    exit_direction=exit_direction,
    target_price=target_price,
    product=product,
    # ğŸ”§ æ–°å¢ï¼šä½¿ç”¨å…¨å±€é è¨­è¿½åƒ¹è¨­å®š
    enable_cancel_retry=self.default_enable_cancel_retry,
    enable_partial_retry=self.default_enable_partial_retry
)

self.exit_groups[position_id] = exit_group

if self.console_enabled:
    print(f"[SIMPLIFIED_TRACKER] ğŸ“ è¨»å†Šå¹³å€‰çµ„: éƒ¨ä½{position_id} "
          f"{direction}â†’{exit_direction} {product} {total_lots}å£ @{target_price:.0f}")
````
</augment_code_snippet>

## ğŸ“ˆ ä¿®å¾©æ•ˆæœå°æ¯”

### ä¿®å¾©å‰çš„éŒ¯èª¤æµç¨‹
```
âŒ å»ºå€‰è¿½åƒ¹:
ç¬¬1å£å–æ¶ˆ â†’ ç¬¬1æ¬¡è¿½åƒ¹ â†’ retry_count = 1
ç¬¬2å£å–æ¶ˆ â†’ è·³éï¼ˆå·²åœ¨è¿½åƒ¹ä¸­ï¼‰
ç¬¬3å£å–æ¶ˆ â†’ ç¬¬2æ¬¡è¿½åƒ¹ âŒ éŒ¯èª¤ï¼

âŒ å¹³å€‰è¿½åƒ¹:
æ‰€æœ‰å¹³å€‰éƒ½è¢«å…¨å±€ç®¡ç†å™¨é˜»æ­¢ âŒ
ç§»å‹•åœåˆ©ç„¡æ³•è¿½åƒ¹ âŒ
```

### ä¿®å¾©å¾Œçš„æ­£ç¢ºæµç¨‹
```
âœ… å»ºå€‰è¿½åƒ¹:
ç¬¬1å£å–æ¶ˆ â†’ ç¬¬1å£ç¬¬1æ¬¡è¿½åƒ¹ â†’ individual_retry_counts[1] = 1 âœ…
ç¬¬2å£å–æ¶ˆ â†’ ç¬¬2å£ç¬¬1æ¬¡è¿½åƒ¹ â†’ individual_retry_counts[2] = 1 âœ…
ç¬¬3å£å–æ¶ˆ â†’ ç¬¬3å£ç¬¬1æ¬¡è¿½åƒ¹ â†’ individual_retry_counts[3] = 1 âœ…

âœ… å¹³å€‰è¿½åƒ¹:
éƒ¨ä½127ç¬¬1å£å¹³å€‰å–æ¶ˆ â†’ è§¸ç™¼ç¬¬1å£ç¬¬1æ¬¡å¹³å€‰è¿½åƒ¹ âœ…
éƒ¨ä½128ç¬¬1å£å¹³å€‰å–æ¶ˆ â†’ è§¸ç™¼ç¬¬1å£ç¬¬1æ¬¡å¹³å€‰è¿½åƒ¹ âœ…
éƒ¨ä½129ç¬¬1å£å¹³å€‰å–æ¶ˆ â†’ è§¸ç™¼ç¬¬1å£ç¬¬1æ¬¡å¹³å€‰è¿½åƒ¹ âœ…

âœ… ç§»å‹•åœåˆ©è¿½åƒ¹:
ç§»å‹•åœåˆ©FOKå¤±æ•— â†’ è§¸ç™¼å£ç´šåˆ¥å¹³å€‰è¿½åƒ¹ âœ…
ä½¿ç”¨BID1-1/ASK1+1è¿½åƒ¹é‚è¼¯ âœ…
```

## ğŸ¯ æŠ€è¡“å„ªå‹¢ç¸½çµ

### 1. å®Œå…¨ç¨ç«‹æ€§
- âœ… æ¯å£æœ‰ç¨ç«‹çš„è¿½åƒ¹è¨ˆæ•¸å™¨
- âœ… æ¯å£æœ‰ç¨ç«‹çš„è¿½åƒ¹ç‹€æ…‹  
- âœ… æ¯å£æœ‰ç¨ç«‹çš„å…¨å±€é–å®š
- âœ… æ¯çµ„å®Œå…¨ç¨ç«‹é‹ä½œ

### 2. ç²¾ç¢ºæ€§
- âœ… æº–ç¢ºè¿½è¹¤æ¯å£çš„è¿½åƒ¹é€²åº¦
- âœ… æ­£ç¢ºé¡¯ç¤ºè¿½åƒ¹æ¬¡æ•¸
- âœ… é¿å…éŒ¯èª¤çš„è¨ˆæ•¸ç´¯ç©

### 3. ä¸€è‡´æ€§
- âœ… å»ºå€‰ã€åœæã€ç§»å‹•åœåˆ©ä½¿ç”¨ç›¸åŒçš„å£ç´šåˆ¥é‚è¼¯
- âœ… ç›¸åŒçš„è¿½åƒ¹åƒ¹æ ¼è¨ˆç®—æ–¹å¼
- âœ… ç›¸åŒçš„å…¨å±€é–å®šæ©Ÿåˆ¶

### 4. å¯æ“´å±•æ€§
- âœ… æ”¯æ´ä»»æ„å£æ•¸çš„ç­–ç•¥çµ„
- âœ… æ”¯æ´ä»»æ„æ•¸é‡çš„çµ„
- âœ… æ”¯æ´ä¸åŒå£çš„ä¸åŒè¿½åƒ¹ç­–ç•¥

## ğŸ› ï¸ ç¶­è­·æ“ä½œæŒ‡å—

### ç›£æ§è¿½åƒ¹ç‹€æ…‹

```python
# å»ºå€‰è¿½åƒ¹ç‹€æ…‹
group = tracker.strategy_groups.get(group_id)
print(f"å„å£è¿½åƒ¹æ¬¡æ•¸: {group.individual_retry_counts}")
print(f"æ­£åœ¨è¿½åƒ¹çš„å£: {group.active_retry_lots}")

# å¹³å€‰è¿½åƒ¹ç‹€æ…‹
exit_group = tracker.exit_groups.get(position_id)
print(f"å„å£è¿½åƒ¹æ¬¡æ•¸: {exit_group.individual_retry_counts}")
print(f"æ­£åœ¨è¿½åƒ¹çš„å£: {exit_group.active_retry_lots}")
```

### é…ç½®åƒæ•¸èª¿æ•´

```python
# èª¿æ•´æœ€å¤§è¿½åƒ¹æ¬¡æ•¸
strategy_group.max_retries = 3  # æ¯å£æœ€å¤š3æ¬¡è¿½åƒ¹

# èª¿æ•´åƒ¹æ ¼å®¹å·®
strategy_group.price_tolerance = 5.0  # 5é»å®¹å·®

# æ§åˆ¶è¿½åƒ¹è¡Œç‚º
strategy_group.enable_cancel_retry = True   # å•Ÿç”¨å–æ¶ˆè¿½åƒ¹
strategy_group.enable_partial_retry = False # ç¦ç”¨éƒ¨åˆ†æˆäº¤è¿½åƒ¹
```

### æ•…éšœæ’é™¤

**å•é¡Œ**: è¿½åƒ¹è¨ˆæ•¸éŒ¯èª¤
**æª¢æŸ¥é …ç›®**:
1. ç¢ºèªä½¿ç”¨ `individual_retry_counts` è€Œé `retry_count`
2. æª¢æŸ¥ `current_lot_index` è¨ˆç®—é‚è¼¯
3. é©—è­‰å£ç´šåˆ¥é–å®šæ©Ÿåˆ¶

**å•é¡Œ**: å¹³å€‰è¿½åƒ¹å¤±æ•ˆ
**æª¢æŸ¥é …ç›®**:
1. ç¢ºèª ExitGroup å·²æ­£ç¢ºè¨»å†Š
2. æª¢æŸ¥ `mark_exit_with_lot` èª¿ç”¨
3. é©—è­‰å¹³å€‰å–æ¶ˆå›å ±è™•ç†é‚è¼¯

## ğŸ“ ç¶­è­·è¨˜éŒ„

### é‡å¤§ä¿®æ”¹æ–‡ä»¶
1. **simplified_order_tracker.py**: æ–°å¢ ExitGroup é¡ã€å¢å¼· GlobalExitManagerã€é‡æ§‹å–æ¶ˆå›å ±è™•ç†
2. **stop_loss_executor.py**: æ·»åŠ åœæå¹³å€‰çµ„è¨»å†Šã€ç§»å‹•åœåˆ©å¹³å€‰çµ„è¨»å†Š

### é æœŸæ•ˆæœ
- âœ… æ¯å£ç¨ç«‹è¿½åƒ¹ï¼Œè¨ˆæ•¸æº–ç¢º
- âœ… å»ºå€‰ã€åœæã€ç§»å‹•åœåˆ©çµ±ä¸€ä½¿ç”¨å£ç´šåˆ¥é‚è¼¯
- âœ… å¤šçµ„ç­–ç•¥å®Œå…¨ç¨ç«‹é‹ä½œ
- âœ… è¿½åƒ¹æˆåŠŸç‡é¡¯è‘—æå‡
