# ä»»å‹™1ï¼šè‡ªå®šç¾©æ™‚é–“ç¯„åœå¯¦ç¾åˆ†æå ±å‘Š

## ğŸ“‹ **è©•ä¼°æ¦‚è¿°**

æœ¬å ±å‘Šåˆ†æè™›æ“¬äº¤æ˜“ç³»çµ± `virtual_simple_integrated.py` å¦‚ä½•å¾ç•¶å‰çš„ã€Œç”¨æˆ¶è¼¸å…¥æ™‚é–“+å›ºå®šæ™‚é•·ã€æ¨¡å¼ï¼Œä¿®æ”¹ç‚ºæ”¯æ´ç²¾ç¢ºçš„é–‹å§‹å’ŒçµæŸæ™‚é–“è¼¸å…¥æ ¼å¼ã€‚

**ç›®æ¨™æ ¼å¼**ï¼šç”¨æˆ¶è¼¸å…¥ã€Œ08:58 - 09:02ã€â†’ ç³»çµ±ç›£æ§å¾ 08:58:01 åˆ° 09:02:00

---

## ğŸ” **ç•¶å‰ç³»çµ±åˆ†æ**

### **1. ç¾æœ‰æ™‚é–“è™•ç†æ©Ÿåˆ¶**

#### **æ™‚é–“è¼¸å…¥è™•ç† (`apply_range_time()` æ–¹æ³•)**
```python
# ç•¶å‰å¯¦ç¾ (ç¬¬4007-4057è¡Œ)
def apply_range_time(self):
    time_input = self.entry_range_time.get().strip()
    
    # è§£ææ™‚é–“æ ¼å¼ HH:MM:SS æˆ– HH:MM
    if ':' in time_input:
        time_parts = time_input.split(':')
        if len(time_parts) == 2:
            hour, minute = map(int, time_parts)
            second = 0  # é è¨­ç§’æ•¸ç‚º0
        elif len(time_parts) == 3:
            hour, minute, second = map(int, time_parts)
    
    # è¨­å®šå€é–“é–‹å§‹æ™‚é–“
    self.range_start_hour = hour
    self.range_start_minute = minute
    
    # è¨ˆç®—çµæŸæ™‚é–“ï¼ˆ+20ç§’ï¼‰- å›ºå®šæ™‚é•·
    end_second = second + 20
    end_minute = minute
    end_hour = hour
    if end_second >= 60:
        end_second -= 60
        end_minute += 1
        if end_minute >= 60:
            end_minute -= 60
            end_hour += 1
```

#### **æ™‚é–“æª¢æŸ¥é‚è¼¯ (`is_in_range_time_safe()` æ–¹æ³•)**
```python
# ç•¶å‰å¯¦ç¾ (ç¬¬3310-3320è¡Œ)
def is_in_range_time_safe(self, time_str):
    """å®‰å…¨çš„æ™‚é–“æª¢æŸ¥ - ç²¾ç¢º20ç§’å€é–“"""
    try:
        hour, minute, second = map(int, time_str.split(':'))
        current_total_seconds = hour * 3600 + minute * 60 + second
        start_total_seconds = self.range_start_hour * 3600 + self.range_start_minute * 60
        end_total_seconds = start_total_seconds + 20  # å›ºå®š20ç§’
        
        return start_total_seconds <= current_total_seconds < end_total_seconds
    except:
        return False
```

### **2. ç³»çµ±ç‹€æ…‹è®Šæ•¸**

**é—œéµè®Šæ•¸**ï¼š
- `self.range_start_hour` - å€é–“é–‹å§‹å°æ™‚
- `self.range_start_minute` - å€é–“é–‹å§‹åˆ†é˜  
- `self.range_calculated` - å€é–“è¨ˆç®—å®Œæˆæ¨™è¨˜
- `self.in_range_period` - æ˜¯å¦åœ¨å€é–“æ™‚é–“å…§
- `self.range_prices` - å€é–“å…§æ”¶é›†çš„åƒ¹æ ¼æ•¸æ“š

---

## ğŸ¯ **å¯¦ç¾æ–¹æ¡ˆåˆ†æ**

### **æ–¹æ¡ˆ1ï¼šç¯„åœæ ¼å¼è§£ææ“´å±•**

#### **è¼¸å…¥æ ¼å¼æ”¯æ´**
```python
# æ–°å¢æ”¯æ´æ ¼å¼
"08:58 - 09:02"     # åˆ†é˜ç²¾åº¦
"08:58:30 - 09:02:15"  # ç§’ç²¾åº¦
"08:58-09:02"       # ç„¡ç©ºæ ¼ç‰ˆæœ¬
```

#### **è§£æé‚è¼¯å¯¦ç¾**
```python
def parse_time_range(self, time_input):
    """è§£ææ™‚é–“ç¯„åœè¼¸å…¥"""
    # ç§»é™¤ç©ºæ ¼ä¸¦åˆ†å‰²
    time_input = time_input.replace(' ', '')
    
    if '-' in time_input:
        # ç¯„åœæ ¼å¼ï¼šstart-end
        start_str, end_str = time_input.split('-', 1)
        start_time = self._parse_single_time(start_str)
        end_time = self._parse_single_time(end_str)
        return start_time, end_time
    else:
        # å–®ä¸€æ™‚é–“æ ¼å¼ï¼ˆä¿æŒå‘å¾Œå…¼å®¹ï¼‰
        start_time = self._parse_single_time(time_input)
        # é è¨­+20ç§’
        end_time = self._add_seconds(start_time, 20)
        return start_time, end_time

def _parse_single_time(self, time_str):
    """è§£æå–®ä¸€æ™‚é–“å­—ä¸²"""
    parts = time_str.split(':')
    if len(parts) == 2:
        return (int(parts[0]), int(parts[1]), 0)
    elif len(parts) == 3:
        return (int(parts[0]), int(parts[1]), int(parts[2]))
    else:
        raise ValueError("æ™‚é–“æ ¼å¼éŒ¯èª¤")
```

### **æ–¹æ¡ˆ2ï¼šæ™‚é–“æª¢æŸ¥é‚è¼¯ä¿®æ”¹**

#### **æ–°çš„æª¢æŸ¥æ–¹æ³•**
```python
def is_in_range_time_safe(self, time_str):
    """æ”¯æ´è‡ªå®šç¾©çµæŸæ™‚é–“çš„å€é–“æª¢æŸ¥"""
    try:
        hour, minute, second = map(int, time_str.split(':'))
        current_total_seconds = hour * 3600 + minute * 60 + second
        
        # ä½¿ç”¨è‡ªå®šç¾©çš„é–‹å§‹å’ŒçµæŸæ™‚é–“
        start_total_seconds = (self.range_start_hour * 3600 + 
                              self.range_start_minute * 60 + 
                              self.range_start_second)
        end_total_seconds = (self.range_end_hour * 3600 + 
                            self.range_end_minute * 60 + 
                            self.range_end_second)
        
        return start_total_seconds <= current_total_seconds < end_total_seconds
    except:
        return False
```

#### **æ–°å¢ç‹€æ…‹è®Šæ•¸**
```python
# åœ¨ __init__ æ–¹æ³•ä¸­æ–°å¢
self.range_start_second = 0
self.range_end_hour = 8
self.range_end_minute = 46
self.range_end_second = 20
```

---

## âš ï¸ **é¢¨éšªè©•ä¼°**

### **ğŸ”´ é«˜é¢¨éšªé …ç›®**

#### **1. æ™‚é–“é‚Šç•Œæª¢æ¸¬ç²¾ç¢ºæ€§**
- **é¢¨éšª**ï¼šåˆ†é˜è½‰æ›æ™‚çš„é‚Šç•Œæ¢ä»¶è™•ç†
- **å½±éŸ¿**ï¼šå¯èƒ½å°è‡´å€é–“æ•¸æ“šæ”¶é›†ä¸å®Œæ•´æˆ–é‡è¤‡
- **æ¡ˆä¾‹**ï¼šå¾ 09:01:59 åˆ° 09:02:00 çš„è½‰æ›æª¢æ¸¬

#### **2. å‘å¾Œå…¼å®¹æ€§**
- **é¢¨éšª**ï¼šç¾æœ‰å–®ä¸€æ™‚é–“è¼¸å…¥æ ¼å¼å¯èƒ½å¤±æ•ˆ
- **å½±éŸ¿**ï¼šç ´å£ç¾æœ‰ç”¨æˆ¶æ“ä½œç¿’æ…£
- **è§£æ±º**ï¼šå¿…é ˆä¿æŒå° "HH:MM" æ ¼å¼çš„æ”¯æ´

#### **3. è·¨æ—¥æ™‚é–“è™•ç†**
- **é¢¨éšª**ï¼šçµæŸæ™‚é–“å¯èƒ½è·¨è¶Šåˆ°éš”æ—¥
- **å½±éŸ¿**ï¼šæ™‚é–“è¨ˆç®—é‚è¼¯éŒ¯èª¤
- **æ¡ˆä¾‹**ï¼š23:58 - 00:02 çš„è·¨æ—¥å€é–“

### **ğŸŸ¡ ä¸­é¢¨éšªé …ç›®**

#### **1. UIé¡¯ç¤ºæ›´æ–°**
- **é¢¨éšª**ï¼šæ™‚é–“é¡¯ç¤ºæ ¼å¼éœ€è¦èª¿æ•´
- **å½±éŸ¿**ï¼šç”¨æˆ¶ç•Œé¢æ··äº‚
- **ä½ç½®**ï¼š`range_time_var.set()` ç›¸é—œä»£ç¢¼

#### **2. éŒ¯èª¤è™•ç†æ©Ÿåˆ¶**
- **é¢¨éšª**ï¼šæ–°çš„è§£æé‚è¼¯å¯èƒ½ç”¢ç”Ÿæ–°çš„ç•°å¸¸é¡å‹
- **å½±éŸ¿**ï¼šç³»çµ±ç©©å®šæ€§ä¸‹é™
- **éœ€æ±‚**ï¼šå®Œå–„çš„ç•°å¸¸æ•ç²å’Œç”¨æˆ¶æç¤º

### **ğŸŸ¢ ä½é¢¨éšªé …ç›®**

#### **1. æ€§èƒ½å½±éŸ¿**
- **è©•ä¼°**ï¼šæ™‚é–“è§£æé‚è¼¯è¤‡é›œåº¦å¢åŠ æœ‰é™
- **å½±éŸ¿**ï¼šå°ç³»çµ±æ€§èƒ½å½±éŸ¿å¾®ä¹å…¶å¾®

#### **2. è¨˜æ†¶é«”ä½¿ç”¨**
- **è©•ä¼°**ï¼šæ–°å¢å°‘é‡ç‹€æ…‹è®Šæ•¸
- **å½±éŸ¿**ï¼šè¨˜æ†¶é«”ä½¿ç”¨å¢åŠ å¯å¿½ç•¥

---

## ğŸ› ï¸ **å¯¦ç¾å»ºè­°**

### **éšæ®µ1ï¼šæ ¸å¿ƒé‚è¼¯ä¿®æ”¹**
1. ä¿®æ”¹ `apply_range_time()` æ–¹æ³•æ”¯æ´ç¯„åœè§£æ
2. æ–°å¢æ™‚é–“è§£æè¼”åŠ©æ–¹æ³•
3. æ›´æ–° `is_in_range_time_safe()` é‚è¼¯

### **éšæ®µ2ï¼šå®‰å…¨æ€§å¢å¼·**
1. åŠ å¼·è¼¸å…¥é©—è­‰å’ŒéŒ¯èª¤è™•ç†
2. å¯¦ç¾è·¨æ—¥æ™‚é–“è™•ç†é‚è¼¯
3. æ·»åŠ é‚Šç•Œæ¢ä»¶æ¸¬è©¦

### **éšæ®µ3ï¼šç”¨æˆ¶é«”é©—å„ªåŒ–**
1. æ›´æ–°UIé¡¯ç¤ºæ ¼å¼
2. æä¾›è¼¸å…¥æ ¼å¼æç¤º
3. ä¿æŒå‘å¾Œå…¼å®¹æ€§

---

## ğŸ“Š **ç¸½é«”è©•ä¼°**

| è©•ä¼°é …ç›® | é¢¨éšªç­‰ç´š | å¯¦ç¾é›£åº¦ | å»ºè­°å„ªå…ˆç´š |
|---------|---------|---------|-----------|
| æ™‚é–“è§£æé‚è¼¯ | ğŸŸ¡ ä¸­ | ğŸŸ¢ ä½ | â­â­â­ |
| é‚Šç•Œæª¢æ¸¬ç²¾ç¢ºæ€§ | ğŸ”´ é«˜ | ğŸŸ¡ ä¸­ | â­â­â­â­â­ |
| å‘å¾Œå…¼å®¹æ€§ | ğŸ”´ é«˜ | ğŸŸ¢ ä½ | â­â­â­â­â­ |
| UIæ›´æ–° | ğŸŸ¡ ä¸­ | ğŸŸ¢ ä½ | â­â­â­ |
| è·¨æ—¥è™•ç† | ğŸŸ¡ ä¸­ | ğŸŸ¡ ä¸­ | â­â­ |

**çµè«–**ï¼šæ­¤åŠŸèƒ½å¯¦ç¾å¯è¡Œæ€§é«˜ï¼Œä½†éœ€è¦ç‰¹åˆ¥æ³¨æ„æ™‚é–“é‚Šç•Œæª¢æ¸¬çš„ç²¾ç¢ºæ€§å’Œå‘å¾Œå…¼å®¹æ€§ã€‚å»ºè­°æ¡ç”¨æ¼¸é€²å¼å¯¦ç¾æ–¹å¼ï¼Œå…ˆç¢ºä¿æ ¸å¿ƒåŠŸèƒ½ç©©å®šï¼Œå†é€æ­¥å¢åŠ é«˜ç´šç‰¹æ€§ã€‚

---

*å ±å‘Šç”Ÿæˆæ™‚é–“ï¼š2025-07-18*  
*è©•ä¼°ç³»çµ±ï¼švirtual_simple_integrated.py*  
*é¢¨éšªç­‰ç´šï¼šğŸŸ¢ ä½é¢¨éšª - å¯å®‰å…¨å¯¦ç¾*
