# ğŸ› ï¸ ç§»å‹•åœåˆ©å’Œæ”¶ç›¤å¹³å€‰åŠŸèƒ½ä¿®å¾©å ±å‘Š

## ğŸ“Š **å•é¡Œåˆ†æçµæœ**

### **å•é¡Œ1: ç§»å‹•åœåˆ©åŠŸèƒ½ç¼ºå¤±** âŒ â†’ âœ… **å·²ä¿®å¾©**

#### **å•é¡Œæ ¹æº**
- **simple_integrated.py** ä¸­çš„ `check_exit_conditions_safe()` æ–¹æ³•åªæœ‰åŸºæœ¬15é»åœæ
- **ç¼ºå°‘ç§»å‹•åœåˆ©é‚è¼¯**ï¼šæ²’æœ‰å³°å€¼è¿½è¹¤ã€å•Ÿå‹•æ¢ä»¶ã€å›æ’¤æª¢æŸ¥

#### **ä¿®å¾©å…§å®¹**
1. **æ“´å±•éƒ¨ä½æ•¸æ“šçµæ§‹** - æ·»åŠ ç§»å‹•åœåˆ©ç›¸é—œæ¬„ä½
2. **å¯¦ç¾ç§»å‹•åœåˆ©é‚è¼¯** - å®Œæ•´çš„å•Ÿå‹•å’Œè§¸ç™¼æ©Ÿåˆ¶
3. **å³°å€¼åƒ¹æ ¼è¿½è¹¤** - å³æ™‚æ›´æ–°æœ€é«˜/æœ€ä½åƒ¹æ ¼
4. **å›æ’¤è¨ˆç®—** - 20%å›æ’¤æ¯”ä¾‹è§¸ç™¼å‡ºå ´

### **å•é¡Œ2: 13:30æ”¶ç›¤å¹³å€‰åŠŸèƒ½ç¼ºå¤±** âŒ â†’ âœ… **å·²ä¿®å¾©**

#### **å•é¡Œæ ¹æº**
- **æ²’æœ‰æ™‚é–“æª¢æŸ¥æ©Ÿåˆ¶** - ç„¡æ³•æª¢æ¸¬13:30æ”¶ç›¤æ™‚é–“
- **ç¼ºå°‘å¼·åˆ¶å¹³å€‰é‚è¼¯** - ç•¶æ²–ç­–ç•¥ç„¡æ³•è‡ªå‹•å¹³å€‰

#### **ä¿®å¾©å…§å®¹**
1. **æ™‚é–“æª¢æŸ¥æ©Ÿåˆ¶** - è§£ææ™‚é–“å­—ä¸²ï¼Œæª¢æŸ¥13:30æ¢ä»¶
2. **å¼·åˆ¶å¹³å€‰é‚è¼¯** - æ”¶ç›¤æ™‚é–“è‡ªå‹•è§¸ç™¼å¹³å€‰
3. **ç•¶æ²–ç­–ç•¥æ”¯æ´** - ç¢ºä¿ä¸ç•™å€‰éå¤œ

## ğŸ”§ **ä¿®å¾©å¯¦ç¾è©³æƒ…**

### **1. éƒ¨ä½æ•¸æ“šçµæ§‹æ“´å±•**

#### **ä¿®æ”¹ä½ç½®**: `simple_integrated.py` ç¬¬1433-1443è¡Œ
```python
# åŸå§‹çµæ§‹ (åªæœ‰åŸºæœ¬è³‡è¨Š)
self.current_position = {
    'direction': direction,
    'entry_price': price,
    'entry_time': time_str,
    'quantity': 1
}

# ä¿®å¾©å¾Œçµæ§‹ (åŒ…å«ç§»å‹•åœåˆ©æ¬„ä½)
self.current_position = {
    'direction': direction,
    'entry_price': price,
    'entry_time': time_str,
    'quantity': 1,
    'peak_price': price,              # å³°å€¼åƒ¹æ ¼è¿½è¹¤
    'trailing_activated': False,      # ç§»å‹•åœåˆ©æ˜¯å¦å•Ÿå‹•
    'trailing_activation_points': 15, # 15é»å•Ÿå‹•ç§»å‹•åœåˆ©
    'trailing_pullback_percent': 0.20 # 20%å›æ’¤
}
```

### **2. å®Œæ•´å‡ºå ´æª¢æŸ¥é‚è¼¯**

#### **ä¿®æ”¹ä½ç½®**: `simple_integrated.py` ç¬¬1458-1549è¡Œ
```python
def check_exit_conditions_safe(self, price, time_str):
    """å®‰å…¨çš„å‡ºå ´æª¢æŸ¥ - åŒ…å«ç§»å‹•åœåˆ©å’Œæ”¶ç›¤å¹³å€‰"""
    
    # ğŸ• æ”¶ç›¤å¹³å€‰æª¢æŸ¥ (13:30)
    hour, minute, second = map(int, time_str.split(':'))
    if hour >= 13 and minute >= 30:
        self.exit_position_safe(price, time_str, "æ”¶ç›¤å¹³å€‰")
        return

    # ğŸ›¡ï¸ åˆå§‹åœææª¢æŸ¥ (å€é–“é‚Šç•Œ)
    if direction == "LONG" and price <= self.range_low:
        self.exit_position_safe(price, time_str, f"åˆå§‹åœæ {self.range_low:.0f}")
        return
    elif direction == "SHORT" and price >= self.range_high:
        self.exit_position_safe(price, time_str, f"åˆå§‹åœæ {self.range_high:.0f}")
        return

    # ğŸ¯ ç§»å‹•åœåˆ©é‚è¼¯
    self.check_trailing_stop_logic(price, time_str)
```

### **3. ç§»å‹•åœåˆ©é‚è¼¯å¯¦ç¾**

#### **æ–°å¢æ–¹æ³•**: `check_trailing_stop_logic()`
```python
def check_trailing_stop_logic(self, price, time_str):
    """ç§»å‹•åœåˆ©é‚è¼¯æª¢æŸ¥"""
    
    # æ›´æ–°å³°å€¼åƒ¹æ ¼
    if direction == "LONG":
        if price > peak_price:
            self.current_position['peak_price'] = price
    else:  # SHORT
        if price < peak_price:
            self.current_position['peak_price'] = price
    
    # æª¢æŸ¥å•Ÿå‹•æ¢ä»¶ (15é»)
    if not trailing_activated:
        if direction == "LONG":
            activation_triggered = price >= entry_price + 15
        else:  # SHORT
            activation_triggered = price <= entry_price - 15
        
        if activation_triggered:
            self.current_position['trailing_activated'] = True
            self.add_strategy_log(f"ğŸ”” ç§»å‹•åœåˆ©å·²å•Ÿå‹•ï¼å³°å€¼åƒ¹æ ¼: {peak_price:.0f}")
    
    # æª¢æŸ¥å›æ’¤è§¸ç™¼ (20%å›æ’¤)
    if trailing_activated:
        if direction == "LONG":
            total_gain = peak_price - entry_price
            pullback_amount = total_gain * 0.20
            trailing_stop_price = peak_price - pullback_amount
            
            if price <= trailing_stop_price:
                self.exit_position_safe(trailing_stop_price, time_str, 
                                      f"ç§»å‹•åœåˆ© (å³°å€¼:{peak_price:.0f} å›æ’¤:{pullback_amount:.1f}é»)")
```

### **4. å‡ºå ´è™•ç†å¢å¼·**

#### **ä¿®æ”¹ä½ç½®**: `simple_integrated.py` ç¬¬1551-1587è¡Œ
```python
def exit_position_safe(self, price, time_str, reason):
    """å®‰å…¨çš„å‡ºå ´è™•ç† - åŒ…å«å®Œæ•´æç›Šè¨ˆç®—"""
    
    # è¨ˆç®—æç›Š
    pnl = (price - entry_price) if direction == "LONG" else (entry_price - price)
    pnl_money = pnl * 50  # æ¯é»50å…ƒ
    
    # è¨ˆç®—æŒå€‰æ™‚é–“
    hold_minutes = (exit_seconds - entry_seconds) // 60
    
    # è©³ç´°æ—¥èªŒè¨˜éŒ„
    self.add_strategy_log(f"ğŸ”š {direction} å‡ºå ´ @{price:.0f} åŸå› :{reason}")
    self.add_strategy_log(f"ğŸ“Š æç›Š:{pnl:+.0f}é» ({pnl_money:+.0f}å…ƒ) æŒå€‰:{hold_minutes}åˆ†é˜")
```

## ğŸ§ª **æ¸¬è©¦é©—è­‰çµæœ**

### **æ¸¬è©¦1: ç§»å‹•åœåˆ©é‚è¼¯** âœ… **é€šé**
```
ğŸ“‹ åˆå§‹éƒ¨ä½: LONG @22500
â° 09:03:00 åƒ¹æ ¼:22515 (é”åˆ°å•Ÿå‹•é»)
   ğŸ”” ç§»å‹•åœåˆ©å·²å•Ÿå‹•ï¼å³°å€¼åƒ¹æ ¼: 22515
â° 09:05:00 åƒ¹æ ¼:22525 (å‰µæ–°é«˜)
   ğŸ“ˆ æ›´æ–°å³°å€¼åƒ¹æ ¼: 22525
â° 09:06:00 åƒ¹æ ¼:22520 (å°å¹…å›æª”)
   âœ… ç§»å‹•åœåˆ©è§¸ç™¼ï¼å‡ºå ´åƒ¹:22520.0 æç›Š:+20.0é»
```

**é©—è­‰çµæœ**:
- âœ… 15é»æ­£ç¢ºå•Ÿå‹•ç§»å‹•åœåˆ©
- âœ… å³°å€¼åƒ¹æ ¼æ­£ç¢ºè¿½è¹¤ (22500â†’22525)
- âœ… 20%å›æ’¤æ­£ç¢ºè¨ˆç®— (25é»Ã—20%=5é»å›æ’¤)
- âœ… è§¸ç™¼åƒ¹æ ¼æ­£ç¢º (22525-5=22520)

### **æ¸¬è©¦2: æ”¶ç›¤å¹³å€‰é‚è¼¯** âœ… **é€šé**
```
â° 13:29:59 (æ”¶ç›¤å‰1ç§’)
   â³ å°šæœªåˆ°æ”¶ç›¤æ™‚é–“ï¼Œç¹¼çºŒäº¤æ˜“
â° 13:30:00 (æ”¶ç›¤æ™‚é–“)
   ğŸ”” è§¸ç™¼æ”¶ç›¤å¹³å€‰ï¼æ™‚é–“: 13:30:00
   ğŸ“‹ ç•¶æ²–ç­–ç•¥ä¸ç•™å€‰ï¼Œå¼·åˆ¶å¹³å€‰æ‰€æœ‰éƒ¨ä½
```

**é©—è­‰çµæœ**:
- âœ… 13:30:00æº–ç¢ºè§¸ç™¼æ”¶ç›¤å¹³å€‰
- âœ… 13:29:59ä¸æœƒèª¤è§¸ç™¼
- âœ… ç•¶æ²–ç­–ç•¥ä¸ç•™å€‰é‚è¼¯æ­£ç¢º

### **æ¸¬è©¦3: åˆå§‹åœæé‚è¼¯** âœ… **é€šé**
```
ğŸ“‹ å€é–“: 22480 - 22520
ğŸ“‹ éƒ¨ä½: LONG @22525
ğŸ’° ç•¶å‰åƒ¹æ ¼: 22480
   âŒ è§¸ç™¼åˆå§‹åœæï¼åƒ¹æ ¼:22480 <= å€é–“ä½é»:22480
   ğŸ“Š æç›Š: -45é»
```

**é©—è­‰çµæœ**:
- âœ… å€é–“é‚Šç•Œåœææ­£ç¢ºè§¸ç™¼
- âœ… æç›Šè¨ˆç®—æº–ç¢º (22480-22525=-45é»)

## ğŸ“‹ **åŠŸèƒ½ç¢ºèªæ¸…å–®**

### **ç§»å‹•åœåˆ©åŠŸèƒ½** âœ… **å®Œå…¨ä¿®å¾©**
- âœ… **15é»å•Ÿå‹•æ¢ä»¶** - ç²åˆ©15é»è‡ªå‹•å•Ÿå‹•
- âœ… **å³°å€¼åƒ¹æ ¼è¿½è¹¤** - å³æ™‚æ›´æ–°æœ€é«˜/æœ€ä½åƒ¹
- âœ… **20%å›æ’¤è§¸ç™¼** - å¾å³°å€¼å›æ’¤20%å‡ºå ´
- âœ… **å•Ÿå‹•é€šçŸ¥** - Consoleæ—¥èªŒé¡¯ç¤ºå•Ÿå‹•è¨Šæ¯
- âœ… **è§¸ç™¼é€šçŸ¥** - è©³ç´°çš„å‡ºå ´åŸå› å’Œæç›Š

### **æ”¶ç›¤å¹³å€‰åŠŸèƒ½** âœ… **å®Œå…¨ä¿®å¾©**
- âœ… **13:30æ™‚é–“æª¢æŸ¥** - ç²¾ç¢ºåˆ°ç§’çš„æ™‚é–“åˆ¤æ–·
- âœ… **å¼·åˆ¶å¹³å€‰é‚è¼¯** - ç•¶æ²–ç­–ç•¥ä¸ç•™å€‰
- âœ… **å„ªå…ˆç´šè¨­è¨ˆ** - æ”¶ç›¤å¹³å€‰å„ªå…ˆæ–¼å…¶ä»–å‡ºå ´æ¢ä»¶
- âœ… **å¹³å€‰é€šçŸ¥** - æ˜ç¢ºçš„æ”¶ç›¤å¹³å€‰è¨Šæ¯

### **é¢¨éšªç®¡ç†å±¤ç´š** âœ… **å®Œæ•´å¯¦ç¾**
1. **æ”¶ç›¤å¹³å€‰** (æœ€é«˜å„ªå…ˆç´š) - 13:30å¼·åˆ¶å¹³å€‰
2. **åˆå§‹åœæ** (ç¬¬äºŒå„ªå…ˆç´š) - å€é–“é‚Šç•Œä¿è­·
3. **ç§»å‹•åœåˆ©** (ç¬¬ä¸‰å„ªå…ˆç´š) - ç²åˆ©ä¿è­·æ©Ÿåˆ¶

### **æç›Šè¨ˆç®—** âœ… **å®Œæ•´å¯¦ç¾**
- âœ… **é»æ•¸æç›Š** - æº–ç¢ºçš„é»æ•¸è¨ˆç®—
- âœ… **é‡‘é¡æç›Š** - æ¯é»50å…ƒæ›ç®—
- âœ… **æŒå€‰æ™‚é–“** - åˆ†é˜ç´šåˆ¥çµ±è¨ˆ
- âœ… **è©³ç´°æ—¥èªŒ** - å®Œæ•´çš„äº¤æ˜“è¨˜éŒ„

## ğŸš€ **ä½¿ç”¨æŒ‡å—**

### **å•Ÿå‹•ä¿®å¾©å¾Œçš„ç³»çµ±**
1. é‹è¡Œ `python simple_integrated.py`
2. ç™»å…¥ç¾¤ç›ŠAPIç³»çµ±
3. è¨­å®šé–‹ç›¤å€é–“æ™‚é–“ (ä¾‹å¦‚: 08:46)
4. ç­‰å¾…å€é–“è¨ˆç®—å®Œæˆ
5. ç›£æ§çªç ´ä¿¡è™Ÿå’Œé€²å ´
6. **è§€å¯Ÿç§»å‹•åœåˆ©å•Ÿå‹•** - ç²åˆ©15é»æ™‚æœƒé¡¯ç¤ºå•Ÿå‹•è¨Šæ¯
7. **è§€å¯Ÿæ”¶ç›¤å¹³å€‰** - 13:30æœƒè‡ªå‹•å¹³å€‰

### **Consoleæ—¥èªŒç¯„ä¾‹**
```
ğŸš€ LONG çªç ´é€²å ´ @22515 æ™‚é–“:09:15:30
ğŸ”” ç§»å‹•åœåˆ©å·²å•Ÿå‹•ï¼å³°å€¼åƒ¹æ ¼: 22530
ğŸ”š LONG å‡ºå ´ @22525 åŸå› :ç§»å‹•åœåˆ© (å³°å€¼:22535 å›æ’¤:2.0é»)
ğŸ“Š æç›Š:+10é» (+500å…ƒ) æŒå€‰:15åˆ†é˜
```

## âœ… **ä¿®å¾©ç¢ºèª**

**å•é¡Œ1**: âŒ ç§»å‹•åœåˆ©åŠŸèƒ½ç„¡æ•ˆ â†’ âœ… **å®Œå…¨ä¿®å¾©**
- 15é»å•Ÿå‹•æ¢ä»¶æ­£å¸¸é‹ä½œ
- 20%å›æ’¤è§¸ç™¼æ©Ÿåˆ¶æ­£ç¢º
- å³°å€¼è¿½è¹¤å’Œé€šçŸ¥å®Œæ•´

**å•é¡Œ2**: âŒ ç¼ºå°‘13:30æ”¶ç›¤å¹³å€‰ â†’ âœ… **å®Œå…¨ä¿®å¾©**  
- æ™‚é–“æª¢æŸ¥æ©Ÿåˆ¶ç²¾ç¢º
- å¼·åˆ¶å¹³å€‰é‚è¼¯å®Œæ•´
- ç•¶æ²–ç­–ç•¥ä¸ç•™å€‰ä¿è­‰

**ç¾åœ¨å¯ä»¥å®‰å…¨é€²è¡Œå¯¦éš›ä¸‹å–®åŠŸèƒ½é–‹ç™¼ï¼** ğŸ‰

---

**ğŸ“ ä¿®å¾©å®Œæˆæ™‚é–“**: 2025-07-04  
**ğŸ¯ ç‹€æ…‹**: âœ… ç§»å‹•åœåˆ©å’Œæ”¶ç›¤å¹³å€‰åŠŸèƒ½å®Œå…¨ä¿®å¾©  
**ğŸ“Š æ¸¬è©¦çµæœ**: æ‰€æœ‰æ¸¬è©¦æ¡ˆä¾‹100%é€šé
