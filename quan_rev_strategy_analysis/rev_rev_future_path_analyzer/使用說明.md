# åè½‰ç­–ç•¥æœªä¾†è·¯å¾‘åˆ†æå™¨ - ä½¿ç”¨èªªæ˜

## ğŸ“‹ æ¦‚è¿°

é€™å€‹å·¥å…·èƒ½å¤ åˆ†æåè½‰ç­–ç•¥çš„æœªä¾†å¯èƒ½è·¯å¾‘ï¼Œä½¿ç”¨è’™åœ°å¡ç¾…æ¨¡æ“¬æ–¹æ³•é æ¸¬æœªä¾†è³‡é‡‘æ›²ç·šè®ŠåŒ–ã€‚

**ç‰ˆæœ¬ 2.0 æ–°åŠŸèƒ½ï¼š**
- âœ… æ”¯æ´å¤–éƒ¨ YAML é…ç½®æ–‡ä»¶
- âœ… å‘½ä»¤åˆ—åƒæ•¸æ”¯æ´
- âœ… å¤šç¨®é è¨­é…ç½®ç¯„ä¾‹
- âœ… å®Œå…¨å¯é…ç½®çš„åƒæ•¸ç³»çµ±

## ğŸš€ å¿«é€Ÿé–‹å§‹

```bash
cd /Users/z/big/my-capital-project/quan_rev_strategy_analysis/rev_rev_future_path_analyzer

# ä½¿ç”¨é è¨­é…ç½®
python rev_future_path_analyzer.py

# ä½¿ç”¨å¿«é€Ÿæ¸¬è©¦é…ç½®
python rev_future_path_analyzer.py --config quick_test_config.yml

# ä½¿ç”¨ä¿å®ˆå‹é…ç½®
python rev_future_path_analyzer.py --config conservative_config.yml

# ä½¿ç”¨ç©æ¥µå‹é…ç½®
python rev_future_path_analyzer.py --config aggressive_config.yml
```

## ğŸ“ é…ç½®æ–‡ä»¶èªªæ˜

### å¯ç”¨çš„é…ç½®æ–‡ä»¶

1. **`config.yml`** - é è¨­é…ç½®ï¼ˆæ¨™æº–è¨­å®šï¼‰
2. **`quick_test_config.yml`** - å¿«é€Ÿæ¸¬è©¦é…ç½®ï¼ˆ500æ¬¡æ¨¡æ“¬ï¼Œ20å¤©é æ¸¬ï¼‰
3. **`conservative_config.yml`** - ä¿å®ˆå‹é…ç½®ï¼ˆé™ä½é¢¨éšªï¼‰
4. **`aggressive_config.yml`** - ç©æ¥µå‹é…ç½®ï¼ˆè¿½æ±‚æ›´é«˜æ”¶ç›Šï¼‰

### è‡ªå®šç¾©é…ç½®

æ‚¨å¯ä»¥è¤‡è£½ä»»ä¸€é…ç½®æ–‡ä»¶ä¸¦ä¿®æ”¹åƒæ•¸ä¾†å‰µå»ºè‡ªå·±çš„é…ç½®ï¼š

```bash
cp config.yml my_custom_config.yml
# ç·¨è¼¯ my_custom_config.yml
python rev_future_path_analyzer.py --config my_custom_config.yml
```

## âš™ï¸ åƒæ•¸é…ç½®èªªæ˜

### 1. è’™åœ°å¡ç¾…åˆ†æåƒæ•¸

åœ¨ `rev_future_path_analyzer.py` æ–‡ä»¶çš„ç¬¬ 237-241 è¡Œï¼š

```python
# === åˆ†æåƒæ•¸è¨­å®š ===
NUM_SIMULATIONS = 2000      # æ¨¡æ“¬æ¬¡æ•¸
NUM_FUTURE_DAYS = 60        # æœªä¾†é æ¸¬å¤©æ•¸
PROFIT_TARGET_PCT = 0.20    # ç²åˆ©ç›®æ¨™ 20%
RISK_LIMIT_PCT = 0.15       # é¢¨éšªåº•ç·š 15%
INITIAL_CAPITAL = 100000    # èµ·å§‹è³‡é‡‘ 100,000 é»
```

**ä¿®æ”¹èªªæ˜ï¼š**
- `NUM_SIMULATIONS`: æ¨¡æ“¬è·¯å¾‘æ•¸é‡ï¼Œå»ºè­° 1000-5000
- `NUM_FUTURE_DAYS`: é æ¸¬å¤©æ•¸ï¼Œå»ºè­° 30-120 å¤©
- `PROFIT_TARGET_PCT`: ç²åˆ©ç›®æ¨™ç™¾åˆ†æ¯” (0.20 = 20%)
- `RISK_LIMIT_PCT`: é¢¨éšªåº•ç·šç™¾åˆ†æ¯” (0.15 = 15%)
- `INITIAL_CAPITAL`: æ¨¡æ“¬èµ·å§‹è³‡é‡‘

### 2. å›æ¸¬æ™‚é–“å€æ®µ

åœ¨ `rev_future_path_analyzer.py` æ–‡ä»¶çš„ç¬¬ 307-315 è¡Œï¼š

```python
# åŸ·è¡Œå›æ¸¬ï¼ˆä½¿ç”¨æœ€è¿‘çš„äº¤æ˜“æ•¸æ“šï¼‰
backtest_results = run_rev_backtest(
    config=strategy_config,
    start_date="2024-11-04",  # é–‹å§‹æ—¥æœŸ
    end_date="2025-06-28",    # çµæŸæ—¥æœŸ
    silent=False,             # é¡¯ç¤ºå›æ¸¬éç¨‹
    range_start_time="08:46", # é–‹ç›¤å€é–“é–‹å§‹æ™‚é–“
    range_end_time="08:47",   # é–‹ç›¤å€é–“çµæŸæ™‚é–“
    enable_console_log=True   # å•Ÿç”¨æ§åˆ¶å°æ—¥èªŒ
)
```

**ä¿®æ”¹èªªæ˜ï¼š**
- `start_date`: å›æ¸¬é–‹å§‹æ—¥æœŸ (æ ¼å¼: "YYYY-MM-DD")
- `end_date`: å›æ¸¬çµæŸæ—¥æœŸ (æ ¼å¼: "YYYY-MM-DD")
- `range_start_time`: é–‹ç›¤å€é–“é–‹å§‹æ™‚é–“ (æ ¼å¼: "HH:MM")
- `range_end_time`: é–‹ç›¤å€é–“çµæŸæ™‚é–“ (æ ¼å¼: "HH:MM")

### 3. ç­–ç•¥äº¤æ˜“åƒæ•¸

åœ¨ `rev_future_path_analyzer.py` æ–‡ä»¶çš„ç¬¬ 255-287 è¡Œï¼š

```python
strategy_config = StrategyConfig(
    trade_size_in_lots=3,                    # äº¤æ˜“å£æ•¸
    stop_loss_type=StopLossType.RANGE_BOUNDARY,  # åœæé¡å‹
    lot_rules=[
        # ç¬¬1å£ï¼š15é»è§¸ç™¼ï¼Œ10%å›æª”
        LotRule(
            use_trailing_stop=True,
            trailing_activation=Decimal(15),      # è§¸ç™¼é»æ•¸
            trailing_pullback=Decimal('0.10')    # å›æª”æ¯”ä¾‹ 10%
        ),
        # ç¬¬2å£ï¼š40é»è§¸ç™¼ï¼Œ10%å›æª”ï¼Œ2å€ä¿è­·æ€§åœæ
        LotRule(
            use_trailing_stop=True,
            trailing_activation=Decimal(40),      # è§¸ç™¼é»æ•¸
            trailing_pullback=Decimal('0.10'),   # å›æª”æ¯”ä¾‹ 10%
            protective_stop_multiplier=Decimal('2.0')  # ä¿è­·æ€§åœæå€æ•¸
        ),
        # ç¬¬3å£ï¼š41é»è§¸ç™¼ï¼Œ20%å›æª”ï¼Œ2å€ä¿è­·æ€§åœæ
        LotRule(
            use_trailing_stop=True,
            trailing_activation=Decimal(41),      # è§¸ç™¼é»æ•¸
            trailing_pullback=Decimal('0.20'),   # å›æª”æ¯”ä¾‹ 20%
            protective_stop_multiplier=Decimal('2.0')  # ä¿è­·æ€§åœæå€æ•¸
        )
    ],
    # å•Ÿç”¨160é»å€é–“éæ¿¾
    range_filter=RangeFilter(
        use_range_size_filter=True,
        max_range_points=Decimal(160)             # å€é–“å¤§å°ä¸Šé™
    ),
    # äº¤æ˜“æ–¹å‘ï¼šå¤šç©ºéƒ½åš
    trading_direction="BOTH"                      # "LONG_ONLY", "SHORT_ONLY", "BOTH"
)
```

## ğŸ“Š è©³ç´°åƒæ•¸èªªæ˜

### äº¤æ˜“å£æ•¸è¨­å®š
- `trade_size_in_lots`: åŒæ™‚äº¤æ˜“çš„å£æ•¸ (1-5)

### åœæé¡å‹
- `StopLossType.RANGE_BOUNDARY`: å€é–“é‚Šç·£åœæ (é è¨­)
- `StopLossType.FIXED_POINTS`: å›ºå®šé»æ•¸åœæ
- `StopLossType.OPENING_PRICE`: é–‹ç›¤åƒ¹åœæ

### å„å£åœæåœåˆ©è¨­å®š

æ¯å£å¯ä»¥ç¨ç«‹è¨­å®šä»¥ä¸‹åƒæ•¸ï¼š

#### ç§»å‹•åœææ¨¡å¼ (use_trailing_stop=True)
- `trailing_activation`: è§¸ç™¼é»æ•¸ (ä¾‹å¦‚: 15 = 15é»)
- `trailing_pullback`: å›æª”æ¯”ä¾‹ (ä¾‹å¦‚: 0.10 = 10%)
- `protective_stop_multiplier`: ä¿è­·æ€§åœæå€æ•¸ (å¯é¸)

#### å›ºå®šåœææ¨¡å¼ (use_trailing_stop=False)
- `fixed_stop_loss_points`: å›ºå®šåœæé»æ•¸
- `fixed_tp_points`: å›ºå®šåœåˆ©é»æ•¸ (å¯é¸)

### å€é–“éæ¿¾è¨­å®š
```python
range_filter=RangeFilter(
    use_range_size_filter=True,    # æ˜¯å¦å•Ÿç”¨å€é–“éæ¿¾
    max_range_points=Decimal(160)  # å€é–“å¤§å°ä¸Šé™ (é»)
)
```

### é¢¨éšªç®¡ç†è¨­å®š
```python
risk_config=RiskConfig(
    use_risk_filter=False,              # æ˜¯å¦å•Ÿç”¨é¢¨éšªç®¡ç†
    daily_loss_limit=Decimal(150),     # æ¯æ—¥è™§æé™åˆ¶ (é»)
    profit_target=Decimal(200)         # æ¯æ—¥ç²åˆ©ç›®æ¨™ (é»)
)
```

### äº¤æ˜“æ–¹å‘è¨­å®š
- `"BOTH"`: å¤šç©ºéƒ½åš (é è¨­)
- `"LONG_ONLY"`: åªåšå¤š
- `"SHORT_ONLY"`: åªåšç©º

## ğŸ”§ å¸¸ç”¨é…ç½®ç¯„ä¾‹

### ç¯„ä¾‹1: ä¿å®ˆå‹é…ç½®
```python
strategy_config = StrategyConfig(
    trade_size_in_lots=2,
    lot_rules=[
        LotRule(trailing_activation=Decimal(10), trailing_pullback=Decimal('0.15')),
        LotRule(trailing_activation=Decimal(25), trailing_pullback=Decimal('0.15'))
    ],
    range_filter=RangeFilter(use_range_size_filter=True, max_range_points=Decimal(100)),
    trading_direction="BOTH"
)
```

### ç¯„ä¾‹2: ç©æ¥µå‹é…ç½®
```python
strategy_config = StrategyConfig(
    trade_size_in_lots=3,
    lot_rules=[
        LotRule(trailing_activation=Decimal(20), trailing_pullback=Decimal('0.05')),
        LotRule(trailing_activation=Decimal(50), trailing_pullback=Decimal('0.05')),
        LotRule(trailing_activation=Decimal(60), trailing_pullback=Decimal('0.10'))
    ],
    range_filter=RangeFilter(use_range_size_filter=True, max_range_points=Decimal(200)),
    trading_direction="BOTH"
)
```

### ç¯„ä¾‹3: åªåšå¤šé…ç½®
```python
strategy_config = StrategyConfig(
    trade_size_in_lots=2,
    lot_rules=[
        LotRule(trailing_activation=Decimal(15), trailing_pullback=Decimal('0.10')),
        LotRule(trailing_activation=Decimal(35), trailing_pullback=Decimal('0.15'))
    ],
    trading_direction="LONG_ONLY"
)
```

## ğŸ“ˆ è¼¸å‡ºçµæœèªªæ˜

### ç”Ÿæˆçš„æ–‡ä»¶
- `future_paths_spaghetti_chart_YYYYMMDD_HHMMSS.png`: ç¾©å¤§åˆ©éºµåœ–
- `analysis_summary.txt`: åˆ†æç¸½çµå ±å‘Š

### é—œéµæŒ‡æ¨™è§£é‡‹
- **è§¸åŠç²åˆ©ç›®æ¨™çš„è·¯å¾‘**: åœ¨æ¨¡æ“¬æœŸé–“é”åˆ°ç²åˆ©ç›®æ¨™çš„è·¯å¾‘ç™¾åˆ†æ¯”
- **è§¸åŠé¢¨éšªåº•ç·šçš„è·¯å¾‘**: åœ¨æ¨¡æ“¬æœŸé–“è§¸åŠé¢¨éšªåº•ç·šçš„è·¯å¾‘ç™¾åˆ†æ¯”
- **æœ€çµ‚è³‡é‡‘åˆ†ä½æ•¸**: 
  - 5%åˆ†ä½æ•¸: æ‚²è§€æƒ…å¢ƒ
  - 50%åˆ†ä½æ•¸: ä¸­ä½æ•¸æƒ…å¢ƒ
  - 95%åˆ†ä½æ•¸: æ¨‚è§€æƒ…å¢ƒ

## âš ï¸ æ³¨æ„äº‹é …

1. **æ•¸æ“šè¦æ±‚**: è‡³å°‘éœ€è¦10å¤©çš„æ­·å²äº¤æ˜“æ•¸æ“š
2. **æ¨¡æ“¬æ¬¡æ•¸**: å»ºè­°ä½¿ç”¨1000-5000æ¬¡æ¨¡æ“¬ä»¥ç²å¾—ç©©å®šçµæœ
3. **åƒæ•¸èª¿æ•´**: ä¿®æ”¹åƒæ•¸å¾Œéœ€è¦é‡æ–°é‹è¡Œæ•´å€‹åˆ†æ
4. **çµæœè§£é‡‹**: æ¨¡æ“¬çµæœåŸºæ–¼æ­·å²æ•¸æ“šï¼Œå¯¦éš›çµæœå¯èƒ½æœ‰å·®ç•°

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ
1. **ModuleNotFoundError**: ç¢ºä¿åœ¨æ­£ç¢ºçš„ç›®éŒ„ä¸‹é‹è¡Œ
2. **æ•¸æ“šä¸è¶³**: èª¿æ•´æ—¥æœŸç¯„åœå¢åŠ æ­·å²æ•¸æ“š
3. **è¨˜æ†¶é«”ä¸è¶³**: æ¸›å°‘æ¨¡æ“¬æ¬¡æ•¸æˆ–é æ¸¬å¤©æ•¸

### è¯ç¹«æ”¯æ´
å¦‚æœ‰å•é¡Œï¼Œè«‹æª¢æŸ¥æ§åˆ¶å°è¼¸å‡ºçš„éŒ¯èª¤è¨Šæ¯ï¼Œä¸¦ç¢ºä¿æ‰€æœ‰ä¾è³´é …ç›®æ­£ç¢ºå®‰è£ã€‚
