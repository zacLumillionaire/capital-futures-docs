# ğŸ“Š æ™‚é–“å€é–“MDDå„ªåŒ–åˆ†æä½¿ç”¨æŒ‡å—

## ğŸ¯ æ¦‚è¿°
æœ¬æŒ‡å—èªªæ˜å¦‚ä½•ä½¿ç”¨å·²ä¿®å¾©MDDè¨ˆç®—çš„æ™‚é–“å€é–“åˆ†æç³»çµ±ï¼Œé€²è¡ŒçœŸå¯¦çš„é¢¨éšªå„ªåŒ–å¯¦é©—ã€‚

## âœ… ç³»çµ±ç‹€æ…‹
- **MDDè¨ˆç®—å·²ä¿®å¾©** âœ… - ç¾åœ¨èƒ½æ­£ç¢ºè¨ˆç®—å’Œé¡¯ç¤ºçœŸå¯¦çš„æœ€å¤§å›æ’¤
- **SQLiteé«˜æ€§èƒ½** âœ… - 928å€‹å¯¦é©—ç´„2-3åˆ†é˜å®Œæˆ
- **å®Œæ•´çµæœä¿å­˜** âœ… - æ‰€æœ‰æ•¸æ“šè‡ªå‹•ä¿å­˜åˆ°CSVæ–‡ä»¶

## ğŸš€ å¿«é€Ÿé–‹å§‹ï¼ˆæ¨è–¦æ–¹å¼ï¼‰

### æ­¥é©Ÿ1: ä¿®æ”¹é…ç½®
ç·¨è¼¯ `/Users/z/big/my-capital-project/strategy_optimization/time_interval_config.py` ä¸­çš„ `focused_mdd` é…ç½®ï¼š

```python
'focused_mdd': {
    'name': 'å°ˆæ³¨MDDæœ€å°åŒ–',
    'description': 'å°ˆé–€ç”¨æ–¼å°‹æ‰¾æœ€ä½MDDçš„æ™‚é–“å€é–“é…ç½®',
    'time_intervals': [
        ("10:30", "10:32"),  # ä¿®æ”¹æ‚¨æƒ³æ¸¬è©¦çš„æ™‚é–“å€é–“
        ("11:30", "11:32"),
        ("13:30", "13:32"),
        ("14:30", "14:32")
    ],
    'date_range': {
        'start_date': '2024-11-04',  # ä¿®æ”¹æ¸¬è©¦æ—¥æœŸç¯„åœ
        'end_date': '2024-12-31'
    },
    'stop_loss_ranges': {
        'lot1': [15, 20, 25, 30],    # ä¿®æ”¹åœæç¯„åœ
        'lot2': [15, 20, 25, 30],
        'lot3': [15, 20, 25, 30]
    },
    'take_profit_settings': [
        {
            'mode': 'trailing_stop',
            'trailing_config': {
                'lot1': {'trigger': 15, 'pullback': 10},  # æ‚¨çš„æˆåŠŸé…ç½®
                'lot2': {'trigger': 40, 'pullback': 10},
                'lot3': {'trigger': 41, 'pullback': 20}
            }
        }
    ],
    'stop_loss_mode': 'range_boundary'  # ä½¿ç”¨å€é–“é‚Šç·£åœæ
}
```

### æ­¥é©Ÿ2: åŸ·è¡Œåˆ†æ
```bash
cd /Users/z/big/my-capital-project/strategy_optimization
python run_focused_mdd_analysis.py
```

### æ­¥é©Ÿ3: æŸ¥çœ‹çµæœ
çµæœæœƒè‡ªå‹•ä¿å­˜åˆ°ï¼š
- `data/processed/mdd_optimization_results_[timestamp].csv`

## ğŸ“Š çµæœåˆ†æ

### çµæœæ–‡ä»¶æ ¼å¼
CSVæ–‡ä»¶åŒ…å«ä»¥ä¸‹æ¬„ä½ï¼š
- `experiment_id`: å¯¦é©—ç·¨è™Ÿ
- `time_interval`: æ™‚é–“å€é–“ (ä¾‹å¦‚: 10:30-10:32)
- `lot1_stop_loss`, `lot2_stop_loss`, `lot3_stop_loss`: å„å£åœæé»æ•¸
- `total_pnl`: ç¸½æç›Š
- `mdd`: æœ€å¤§å›æ’¤ (ç¾åœ¨æ˜¯çœŸå¯¦æ•¸æ“šï¼)
- `win_rate`: å‹ç‡
- `total_trades`: ç¸½äº¤æ˜“æ¬¡æ•¸

### å°‹æ‰¾æœ€ä½³é…ç½®
```python
import pandas as pd

# è®€å–çµæœ
df = pd.read_csv('data/processed/mdd_optimization_results_[timestamp].csv')

# æ‰¾åˆ°MDDæœ€å°çš„é…ç½®
best_mdd = df.loc[df['mdd'].idxmax()]  # MDDæ˜¯è² æ•¸ï¼Œæœ€å¤§å€¼è¡¨ç¤ºæœ€å°å›æ’¤
print(f"æœ€ä½³MDDé…ç½®: {best_mdd['time_interval']}")
print(f"MDD: {best_mdd['mdd']}")
print(f"ç¸½æç›Š: {best_mdd['total_pnl']}")

# æŒ‰æ™‚é–“å€é–“åˆ†çµ„ï¼Œæ‰¾æ¯å€‹å€é–“çš„æœ€ä½³é…ç½®
best_by_interval = df.groupby('time_interval').apply(
    lambda x: x.loc[x['mdd'].idxmax()]
)
```

## âš™ï¸ é«˜ç´šé…ç½®é¸é …

### å…¶ä»–å¯ç”¨é…ç½®
é™¤äº† `focused_mdd`ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä¿®æ”¹å…¶ä»–é…ç½®ï¼š

1. **quick_test** - å¿«é€Ÿæ¸¬è©¦ï¼ˆå°‘é‡å¯¦é©—ï¼‰
2. **standard_analysis** - æ¨™æº–åˆ†æ
3. **comprehensive_analysis** - ç¶œåˆåˆ†æ

### è‡ªå®šç¾©åœåˆ©æ¨¡å¼
```python
'take_profit_settings': [
    {
        'mode': 'trailing_stop',  # ç§»å‹•åœåˆ©
        'trailing_config': {
            'lot1': {'trigger': 15, 'pullback': 10},
            'lot2': {'trigger': 40, 'pullback': 10},
            'lot3': {'trigger': 41, 'pullback': 20}
        }
    },
    {
        'mode': 'range_boundary'  # å€é–“é‚Šç·£åœåˆ©
    }
]
```

## ğŸ“‹ åƒæ•¸èªªæ˜

### æ™‚é–“å€é–“æ ¼å¼
- æ ¼å¼: `("HH:MM", "HH:MM")`
- ä¾‹å¦‚: `("10:30", "10:32")` è¡¨ç¤º10:30åˆ°10:32çš„2åˆ†é˜å€é–“
- **é‡è¦**: é€™æ˜¯ä¿¡è™Ÿæª¢æ¸¬æ™‚é–“ï¼Œé–‹ç›¤å€é–“ä»ä½¿ç”¨08:46-08:47

### åœæåƒæ•¸
- `lot1`, `lot2`, `lot3`: å„å£åœæé»æ•¸ç¯„åœ
- **æ–°åŠŸèƒ½**: ç¾åœ¨æ”¯æŒç›¸ç­‰åœæå€¼ (ä¾‹å¦‚: å…¨éƒ¨è¨­ç‚º15é»)
- ç´„æŸ: lot1 <= lot2 <= lot3 (å…è¨±ç›¸ç­‰)

### åœåˆ©æ¨¡å¼
- `trailing_stop`: ç§»å‹•åœåˆ©ï¼ˆæ¨è–¦ä½¿ç”¨æ‚¨çš„æˆåŠŸé…ç½®ï¼‰
- `range_boundary`: å€é–“é‚Šç·£åœåˆ©

### åœææ¨¡å¼
- `range_boundary`: å€é–“é‚Šç·£åœæï¼ˆæ¨è–¦ï¼‰
- `fixed_points`: å›ºå®šé»æ•¸åœæ

## âš ï¸ é‡è¦æ³¨æ„äº‹é …

### MDDè¨ˆç®—ä¿®å¾©
- âœ… **å·²ä¿®å¾©**: ä¹‹å‰æ‰€æœ‰MDD=0çš„å•é¡Œå·²è§£æ±º
- âœ… **çœŸå¯¦æ•¸æ“š**: ç¾åœ¨é¡¯ç¤ºçœŸå¯¦çš„æœ€å¤§å›æ’¤æ•¸æ“š
- âœ… **å¯é åˆ†æ**: èƒ½å¤ é€²è¡ŒçœŸæ­£çš„é¢¨éšªå„ªåŒ–

### æ€§èƒ½å„ªåŒ–
- **SQLite**: ä½¿ç”¨æœ¬åœ°æ•¸æ“šåº«ï¼Œé€Ÿåº¦æå‡10-20å€
- **ä¸¦è¡Œè™•ç†**: 4å€‹é€²ç¨‹ä¸¦è¡Œï¼Œ928å¯¦é©—ç´„2-3åˆ†é˜
- **å³æ™‚çµæœ**: çµæœå³æ™‚ä¿å­˜ï¼Œå¯éš¨æ™‚æŸ¥çœ‹

### å¯¦é©—è¦æ¨¡
- `focused_mdd`: ç´„928å€‹å¯¦é©—ï¼ˆæ¨è–¦ï¼‰
- `quick_test`: ç´„100å€‹å¯¦é©—ï¼ˆå¿«é€Ÿé©—è­‰ï¼‰
- `comprehensive_analysis`: ç´„2000+å¯¦é©—ï¼ˆæ·±åº¦åˆ†æï¼‰

## ğŸ¯ æœ€ä½³å¯¦è¸

### æ¨è–¦å·¥ä½œæµç¨‹
1. **ä¿®æ”¹é…ç½®**: ç·¨è¼¯ `time_interval_config.py` ä¸­çš„ `focused_mdd`
2. **åŸ·è¡Œåˆ†æ**: `python run_focused_mdd_analysis.py`
3. **æŸ¥çœ‹çµæœ**: åˆ†æCSVæ–‡ä»¶ä¸­çš„MDDå’ŒP&Læ•¸æ“š
4. **èª¿æ•´åƒæ•¸**: æ ¹æ“šçµæœå„ªåŒ–é…ç½®
5. **é‡è¤‡å¯¦é©—**: æŒçºŒå„ªåŒ–ç›´åˆ°æ‰¾åˆ°æœ€ä½³é…ç½®

### é…ç½®å»ºè­°
- ä½¿ç”¨æ‚¨å·²é©—è­‰çš„ç§»å‹•åœåˆ©é…ç½® (15/10%, 40/10%, 41/20%)
- æ¸¬è©¦ä¸åŒæ™‚é–“å€é–“æ‰¾åˆ°æœ€ä½MDD
- è€ƒæ…®é¢¨éšªæ”¶ç›Šæ¯”ï¼Œä¸åªçœ‹MDDæœ€å°å€¼
