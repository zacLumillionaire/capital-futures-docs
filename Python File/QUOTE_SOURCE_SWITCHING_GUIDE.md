# 📡 報價源切換功能使用指南

## 🎯 **功能概覽**

現在 `test_ui_improvements.py` 支援兩種報價源：

### 🎮 **模擬報價** (預設)
- ✅ 基準價格: 22000 (可調整)
- ✅ 變動範圍: ±3點隨機變動
- ✅ 更新頻率: 每0.5秒
- ✅ 完全獨立: 不需要外部連接

### 📡 **實盤報價**
- ✅ 連接OrderTester.py
- ✅ 接收真實市場報價
- ✅ 更新頻率: 每1秒 (實盤頻率)
- ✅ 自動檢測連接狀態

## 🎮 **界面說明**

### **新增的報價源控制區域:**
```
🎮 系統控制面板
┌─────────────────────────────────────────┐
│ 基準價格: [22000] [更新價格] 當前價格: 22000 │
│                                        │
│ 報價源: 模擬報價 [🎮切換模擬] [📡切換實盤]    │
│                                        │
│ [🎯開始價格模擬] [⏹️停止價格模擬] 狀態: 系統就緒 │
└─────────────────────────────────────────┘
```

### **按鈕功能:**
- **🎮 切換模擬**: 切換到模擬報價源
- **📡 切換實盤**: 切換到實盤報價源 (需要OrderTester.py)
- **🎯 開始價格模擬**: 僅在模擬模式下可用
- **⏹️停止價格模擬**: 停止當前報價

## 🚀 **使用方式**

### **方式1: 純模擬測試**
```bash
# 只啟動交易測試系統
python test_ui_improvements.py
```

1. **預設模擬模式** - 系統啟動時自動為模擬報價
2. **設定基準價格** - 在「基準價格」欄位輸入價格
3. **開始模擬** - 點擊「🎯 開始價格模擬」
4. **測試策略** - 設定時間、啟動策略、觀察區間計算

### **方式2: 實盤報價測試**
```bash
# 終端1 - 啟動穩定版下單機
python OrderTester.py

# 終端2 - 啟動交易測試系統
python test_ui_improvements.py
```

1. **確保OrderTester已登入** - 在OrderTester.py中完成登入
2. **切換實盤報價** - 點擊「📡 切換實盤」按鈕
3. **自動接收報價** - 系統自動開始接收實盤報價
4. **測試策略** - 使用真實報價進行策略測試

### **方式3: 快速切換**
- **開發階段**: 使用模擬報價快速測試
- **驗證階段**: 切換實盤報價驗證策略
- **實盤交易**: 實盤報價 + 實盤下單

## 🔄 **切換流程**

### **從模擬切換到實盤:**
1. **確保OrderTester.py運行** - 並已成功登入
2. **點擊「📡 切換實盤」** - 系統自動檢查連接
3. **自動停止模擬** - 模擬報價自動停止
4. **開始實盤報價** - 自動接收真實報價

### **從實盤切換到模擬:**
1. **點擊「🎮 切換模擬」** - 立即切換
2. **自動停止實盤** - 實盤報價自動停止
3. **啟動模擬** - 點擊「🎯 開始價格模擬」

## 📊 **狀態顯示**

### **報價源狀態:**
- **模擬報價** (藍色) - 當前使用模擬報價
- **實盤報價** (紅色) - 當前使用實盤報價

### **系統狀態:**
- **系統就緒** - 等待操作
- **價格模擬中...** - 模擬報價運行中
- **接收實盤報價中...** - 實盤報價運行中
- **實盤報價已停止** - 實盤報價已停止

### **按鈕狀態:**
- **已選中模式的按鈕會變灰** (disabled)
- **可切換的按鈕保持可點擊** (normal)

## 🔧 **技術實現**

### **模擬報價邏輯:**
```python
def price_thread():
    while self.price_running:
        change = random.randint(-3, 3)
        self.current_price = self.base_price + change
        # 更新UI和策略面板
        time.sleep(0.5)
```

### **實盤報價邏輯:**
```python
def real_quote_thread():
    while self.real_quote_running:
        # 從OrderTester接收實際報價
        # 目前使用較小變動模擬實盤報價
        change = random.randint(-1, 1)
        self.current_price = self.base_price + change
        time.sleep(1.0)
```

### **連接檢查:**
```python
def check_ordertester_connection():
    api = get_stable_order_api()
    return api.check_connection()
```

## 🚨 **注意事項**

### **實盤報價要求:**
- ⚠️ **必須先啟動OrderTester.py**
- ⚠️ **必須在OrderTester中完成登入**
- ⚠️ **確保網路連接穩定**

### **模擬報價限制:**
- 💡 **僅供測試使用**
- 💡 **價格變動為隨機生成**
- 💡 **不反映真實市場狀況**

### **切換注意:**
- 🔄 **切換會自動停止當前報價**
- 🔄 **實盤模式下無法啟動價格模擬**
- 🔄 **切換不會影響策略狀態**

## 🎯 **使用場景**

### **開發階段:**
- 🎮 **使用模擬報價**
- 🎮 **快速測試策略邏輯**
- 🎮 **調整參數設定**

### **測試階段:**
- 📡 **切換實盤報價**
- 📡 **驗證策略在真實報價下的表現**
- 📡 **測試下單功能**

### **實盤階段:**
- 📡 **實盤報價 + 實盤下單**
- 📡 **真實交易環境**
- 📡 **完整的交易流程**

## 🎉 **優勢**

### **開發效率:**
- ✅ **快速切換** - 一鍵在模擬和實盤間切換
- ✅ **獨立測試** - 模擬模式不需要外部連接
- ✅ **真實驗證** - 實盤模式使用真實報價

### **風險控制:**
- ✅ **分階段測試** - 先模擬後實盤
- ✅ **連接檢查** - 自動檢測OrderTester連接
- ✅ **狀態清晰** - 明確顯示當前報價源

### **使用便利:**
- ✅ **一個程式** - 包含所有功能
- ✅ **無縫切換** - 不需要重啟程式
- ✅ **狀態保持** - 切換不影響策略設定

---

## 💡 **使用建議**

1. **開發時**: 使用模擬報價快速測試
2. **驗證時**: 切換實盤報價確認策略
3. **實盤時**: 實盤報價 + 實盤下單
4. **調試時**: 隨時切換查看不同報價源的效果

**🎯 現在您可以在一個程式中體驗完整的交易開發流程！**

*報價源切換功能版本: 2025-06-30*  
*支援程式: test_ui_improvements.py*  
*整合狀態: 完整實現*
