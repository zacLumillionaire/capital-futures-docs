# è³‡æ–™åº«ç´¢å¼•ç‹€æ…‹å ±å‘Š

## ğŸ‰ æª¢æŸ¥çµæœ

**ç‹€æ…‹**: âœ… **å®Œå…¨æ­£å¸¸**  
**æª¢æŸ¥æ™‚é–“**: 2025-01-14 21:50  
**çµè«–**: **ç„¡éœ€é¡å¤–å»ºç«‹ç´¢å¼•**  

---

## ğŸ“Š ç´¢å¼•å®Œæ•´æ€§æª¢æŸ¥

### âœ… æ‰€æœ‰é—œéµç´¢å¼•éƒ½å·²è‡ªå‹•å‰µå»º

æ–°è³‡æ–™åº«åœ¨åˆå§‹åŒ–æ™‚å·²ç¶“è‡ªå‹•å‰µå»ºäº† **11 å€‹ç´¢å¼•**ï¼ŒåŒ…æ‹¬æ‰€æœ‰é—œéµçš„æ€§èƒ½å„ªåŒ–ç´¢å¼•ï¼š

#### ğŸš€ æ ¸å¿ƒæ€§èƒ½ç´¢å¼• (5å€‹)

1. **`idx_strategy_groups_date_status`**
   - ç”¨é€”: ç­–ç•¥çµ„æ—¥æœŸå’Œç‹€æ…‹æŸ¥è©¢
   - SQL: `CREATE INDEX idx_strategy_groups_date_status ON strategy_groups(date, status)`

2. **`idx_position_records_group_status`**
   - ç”¨é€”: éƒ¨ä½è¨˜éŒ„æŒ‰çµ„åˆ¥å’Œç‹€æ…‹æŸ¥è©¢
   - SQL: `CREATE INDEX idx_position_records_group_status ON position_records(group_id, status)`

3. **`idx_position_records_order_id`**
   - ç”¨é€”: æŒ‰è¨‚å–®IDæŸ¥è©¢éƒ¨ä½è¨˜éŒ„
   - SQL: `CREATE INDEX idx_position_records_order_id ON position_records(order_id)`

4. **`idx_position_records_api_seq_no`**
   - ç”¨é€”: æŒ‰APIåºè™ŸæŸ¥è©¢éƒ¨ä½è¨˜éŒ„
   - SQL: `CREATE INDEX idx_position_records_api_seq_no ON position_records(api_seq_no)`

5. **`idx_risk_states_position_update`**
   - ç”¨é€”: é¢¨éšªç®¡ç†ç‹€æ…‹æŸ¥è©¢
   - SQL: `CREATE INDEX idx_risk_states_position_update ON risk_management_states(position_id, last_update_time)`

#### ğŸ“ˆ é¡å¤–å„ªåŒ–ç´¢å¼• (6å€‹)

6. **`idx_exit_events_position`** - å‡ºå ´äº‹ä»¶æŸ¥è©¢
7. **`idx_exit_events_time`** - å‡ºå ´äº‹ä»¶æ™‚é–“æŸ¥è©¢
8. **`idx_group_exit_status_date`** - çµ„åˆ¥å‡ºå ´ç‹€æ…‹æŸ¥è©¢
9. **`idx_lot_exit_rules_lookup`** - å£ç´šåˆ¥å‡ºå ´è¦å‰‡æŸ¥è©¢
10. **`idx_position_records_exit_status`** - éƒ¨ä½å‡ºå ´ç‹€æ…‹æŸ¥è©¢
11. **`idx_position_records_trailing`** - ç§»å‹•åœåˆ©ç›¸é—œæŸ¥è©¢

---

## âš¡ æ€§èƒ½é©—è­‰çµæœ

### âœ… æ‰€æœ‰é—œéµæŸ¥è©¢éƒ½ä½¿ç”¨ç´¢å¼•

æ¸¬è©¦äº†4å€‹æ ¸å¿ƒæŸ¥è©¢ï¼Œå…¨éƒ¨éƒ½æ­£ç¢ºä½¿ç”¨äº†ç´¢å¼•ï¼š

1. **ç­–ç•¥çµ„æŸ¥è©¢**: ä½¿ç”¨ `idx_strategy_groups_date_status`
2. **éƒ¨ä½ç‹€æ…‹æŸ¥è©¢**: ä½¿ç”¨ `idx_position_records_exit_status`
3. **è¨‚å–®IDæŸ¥è©¢**: ä½¿ç”¨ `idx_position_records_order_id`
4. **APIåºè™ŸæŸ¥è©¢**: ä½¿ç”¨ `idx_position_records_api_seq_no`

### ğŸ“Š ç´¢å¼•è¦†è“‹çµ±è¨ˆ

| è¡¨å | ç´¢å¼•æ•¸é‡ | è¦†è“‹æƒ…æ³ |
|------|----------|----------|
| `strategy_groups` | 2å€‹ | âœ… å®Œæ•´è¦†è“‹ |
| `position_records` | 5å€‹ | âœ… å®Œæ•´è¦†è“‹ |
| `risk_management_states` | 1å€‹ | âœ… å®Œæ•´è¦†è“‹ |

---

## ğŸ”§ è‡ªå‹•ç´¢å¼•å‰µå»ºæ©Ÿåˆ¶

### ä»£ç¢¼å¯¦ç¾ä½ç½®

åœ¨ `multi_group_database.py` ç¬¬139-143è¡Œï¼š

```python
# å‰µå»ºæ€§èƒ½å„ªåŒ–ç´¢å¼•
cursor.execute('CREATE INDEX IF NOT EXISTS idx_strategy_groups_date_status ON strategy_groups(date, status)')
cursor.execute('CREATE INDEX IF NOT EXISTS idx_position_records_group_status ON position_records(group_id, status)')
cursor.execute('CREATE INDEX IF NOT EXISTS idx_position_records_order_id ON position_records(order_id)')
cursor.execute('CREATE INDEX IF NOT EXISTS idx_position_records_api_seq_no ON position_records(api_seq_no)')
cursor.execute('CREATE INDEX IF NOT EXISTS idx_risk_states_position_update ON risk_management_states(position_id, last_update_time)')
```

### è‡ªå‹•åŒ–å„ªå‹¢

1. âœ… **ç„¡éœ€æ‰‹å‹•æ“ä½œ** - è³‡æ–™åº«åˆå§‹åŒ–æ™‚è‡ªå‹•å‰µå»º
2. âœ… **ç‰ˆæœ¬ä¸€è‡´æ€§** - ç¢ºä¿æ‰€æœ‰ç’°å¢ƒéƒ½æœ‰ç›¸åŒçš„ç´¢å¼•
3. âœ… **é˜²é‡è¤‡å‰µå»º** - ä½¿ç”¨ `IF NOT EXISTS` é¿å…éŒ¯èª¤
4. âœ… **æ€§èƒ½ä¿è­‰** - é—œéµæŸ¥è©¢éƒ½æœ‰å°æ‡‰ç´¢å¼•

---

## ğŸš€ å°å»ºå€‰æ€§èƒ½çš„å½±éŸ¿

### å»ºå€‰æµç¨‹ä¸­çš„ç´¢å¼•ä½¿ç”¨

1. **å‰µå»ºç­–ç•¥çµ„**: ä½¿ç”¨ `idx_strategy_groups_date_status`
2. **å‰µå»ºéƒ¨ä½è¨˜éŒ„**: ä½¿ç”¨ `idx_position_records_group_status`
3. **è¨‚å–®åŒ¹é…**: ä½¿ç”¨ `idx_position_records_order_id`
4. **APIå›å ±è™•ç†**: ä½¿ç”¨ `idx_position_records_api_seq_no`
5. **é¢¨éšªç®¡ç†**: ä½¿ç”¨ `idx_risk_states_position_update`

### æ€§èƒ½é æœŸ

- âœ… **å¿«é€ŸæŸ¥è©¢** - æ‰€æœ‰é—œéµæ“ä½œéƒ½æœ‰ç´¢å¼•æ”¯æŒ
- âœ… **é«˜ä½µç™¼** - ç´¢å¼•æ¸›å°‘é–å®šæ™‚é–“
- âœ… **ä½å»¶é²** - é¿å…å…¨è¡¨æƒæ
- âœ… **ç©©å®šæ€§** - æ€§èƒ½ä¸æœƒéš¨æ•¸æ“šé‡å¢é•·è€Œé¡¯è‘—ä¸‹é™

---

## ğŸ“ ç¸½çµ

### ğŸ¯ é—œéµçµè«–

**æ‚¨ä¸éœ€è¦æ‰‹å‹•å»ºç«‹ä»»ä½•ç´¢å¼•ï¼**

1. âœ… **è‡ªå‹•å‰µå»º** - æ–°è³‡æ–™åº«å·²è‡ªå‹•å‰µå»ºæ‰€æœ‰å¿…è¦ç´¢å¼•
2. âœ… **å®Œæ•´è¦†è“‹** - 11å€‹ç´¢å¼•è¦†è“‹æ‰€æœ‰é—œéµæŸ¥è©¢å ´æ™¯
3. âœ… **æ€§èƒ½å„ªåŒ–** - æ‰€æœ‰æ¸¬è©¦æŸ¥è©¢éƒ½æ­£ç¢ºä½¿ç”¨ç´¢å¼•
4. âœ… **ç³»çµ±å°±ç·’** - è³‡æ–™åº«å·²å®Œå…¨æº–å‚™å¥½é€²è¡Œé«˜æ€§èƒ½äº¤æ˜“

### ğŸš€ ä¸‹ä¸€æ­¥

ç¾åœ¨æ‚¨å¯ä»¥å®‰å¿ƒåœ°ï¼š

1. **é‡å•Ÿäº¤æ˜“ç³»çµ±** - è³‡æ–™åº«çµæ§‹å’Œç´¢å¼•éƒ½å·²å®Œå‚™
2. **åŸ·è¡Œå»ºå€‰æ¸¬è©¦** - æ€§èƒ½å’ŒåŠŸèƒ½éƒ½å·²å„ªåŒ–
3. **ç›£æ§ç³»çµ±è¡¨ç¾** - é æœŸæœƒæœ‰è‰¯å¥½çš„éŸ¿æ‡‰é€Ÿåº¦

### ğŸ’¡ æŠ€è¡“æ´å¯Ÿ

é€™å€‹è‡ªå‹•ç´¢å¼•å‰µå»ºæ©Ÿåˆ¶å±•ç¾äº†è‰¯å¥½çš„ç³»çµ±è¨­è¨ˆï¼š
- **å‰ç»æ€§** - é å…ˆè€ƒæ…®äº†æ€§èƒ½éœ€æ±‚
- **è‡ªå‹•åŒ–** - æ¸›å°‘äººå·¥æ“ä½œéŒ¯èª¤
- **å®Œæ•´æ€§** - è¦†è“‹äº†æ‰€æœ‰é—œéµå ´æ™¯

**çµè«–**: æ‚¨çš„äº¤æ˜“ç³»çµ±è³‡æ–™åº«å·²ç¶“å®Œå…¨æº–å‚™å°±ç·’ï¼Œå…·å‚™äº†ç”Ÿç”¢ç´šåˆ¥çš„æ€§èƒ½å„ªåŒ–ï¼
