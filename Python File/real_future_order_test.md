# 🚀 真實期貨下單API測試指南

## 🎉 **真實API下單功能已實現！**

我已經根據官方案例實現了真實的期貨下單API功能，現在可以進行真實的期貨下單測試！

## 📋 **已實現的功能**

### 1. **真實API下單**
- ✅ 基於官方 `FutureOrder.py` 案例
- ✅ 使用 `SendFutureOrderCLR` API
- ✅ 支援完整的期貨下單參數
- ✅ 非同步下單機制

### 2. **完整參數支援**
- ✅ **帳號**: 期貨交易帳號
- ✅ **商品代碼**: MTX, TX, TE, TF, GTX + 月份
- ✅ **買賣別**: 買進/賣出
- ✅ **委託條件**: ROD/IOC/FOK
- ✅ **當沖與否**: 非當沖/當沖
- ✅ **倉別**: 新倉/平倉/自動
- ✅ **盤別**: 盤中/T盤預約

### 3. **API實現細節**
```python
# 建立FUTUREORDER物件
oOrder = sk.FUTUREORDER()
oOrder.bstrFullAccount = account      # 完整帳號
oOrder.bstrStockNo = stock_no        # 期貨代號 (如MTX202501)
oOrder.sBuySell = buy_sell           # 0:買進, 1:賣出
oOrder.sTradeType = trade_type       # 0:ROD, 1:IOC, 2:FOK
oOrder.sDayTrade = day_trade         # 0:非當沖, 1:當沖
oOrder.bstrPrice = str(price)        # 委託價
oOrder.nQty = quantity               # 委託數量
oOrder.sNewClose = new_close         # 0:新倉, 1:平倉, 2:自動
oOrder.sReserved = reserved          # 0:盤中, 1:T盤預約

# 調用API
nCode = self.m_pSKOrder.SendFutureOrderCLR("", True, oOrder)
```

## 🧪 **測試步驟**

### 步驟1: 啟動程式並登入
```bash
cd "Python File"
python OrderTester.py
```

1. 在「登入」頁籤登入
2. 確認登入成功

### 步驟2: 設定期貨下單參數
切換到「期貨下單」頁籤：

#### 建議的測試參數
- **期貨帳號**: `6363839` (你的帳號)
- **商品代碼**: `MTX (小台指期貨)` (推薦)
- **月份**: `202501` (最近月份)
- **買賣別**: `買進`
- **委託價**: `22000` (接近市價)
- **委託量**: `1` (最小單位)
- **委託條件**: `ROD`
- **當沖與否**: `非當沖`
- **倉別**: `新倉`
- **盤別**: `盤中`

### 步驟3: 啟動回報監控
1. 切換到「下單回報」頁籤
2. 點擊「開始監控」
3. 觀察回報訊息

### 步驟4: 執行真實下單
1. 回到「期貨下單」頁籤
2. 確認所有參數正確
3. 點擊「測試期貨下單」
4. **仔細閱讀風險確認對話框**
5. 確認後執行下單

## 📊 **預期的API回應**

### 成功情況
```
【執行】開始執行期貨下單...
【API】準備調用SendFutureOrderCLR...
【API回應】SK_SUCCESS (代碼: 0)
【成功】期貨下單成功！
【成功】期貨下單指令已送出，請查看回報訊息
```

### 失敗情況
```
【API回應】SK_ERROR_XXXX (代碼: XXXX)
【失敗】期貨下單失敗: 錯誤訊息
```

## 🔍 **可能的回報訊息**

### 1. **委託回報**
- 委託已接受
- 委託序號
- 委託狀態

### 2. **成交回報**
- 成交價格
- 成交數量
- 成交時間

### 3. **錯誤回報**
- 保證金不足
- 商品代碼錯誤
- 帳號問題
- 價格超出漲跌停

## ⚠️ **重要注意事項**

### 1. **這是真實交易**
- ✅ 使用真實的群益期貨API
- ⚠️ 會產生真實的期貨交易
- 💰 需要真實的保證金
- 📋 會產生真實的損益

### 2. **風險控制**
- 🔴 **小台指保證金約 45,000-50,000元/口**
- 🔴 **確保帳戶有足夠保證金**
- 🔴 **建議先用1口測試**
- 🔴 **注意市場波動風險**

### 3. **技術注意事項**
- ✅ 使用非同步下單 (`bAsyncOrder = True`)
- ✅ 完整的錯誤處理
- ✅ 詳細的LOG記錄
- ✅ 回報訊息監控

## 🎯 **測試目標**

### 第一次測試
1. **確認API連接正常**
2. **觀察下單回應代碼**
3. **檢查回報訊息格式**
4. **驗證參數傳遞正確**

### 後續測試
1. **測試不同商品**
2. **測試不同參數組合**
3. **測試錯誤處理**
4. **測試平倉功能**

## 📈 **成功指標**

### API層面
- ✅ `nCode = 0` (成功)
- ✅ 收到委託回報
- ✅ 委託序號產生

### 交易層面
- ✅ 委託進入市場
- ✅ 可能的成交回報
- ✅ 部位變化

## 🚨 **緊急處理**

### 如果下單後想取消
1. 記住委託序號
2. 使用委託減量功能
3. 或聯繫券商處理

### 如果出現錯誤
1. 記錄錯誤代碼
2. 檢查帳戶狀態
3. 確認保證金充足
4. 檢查商品代碼格式

## 🎉 **準備好了嗎？**

現在你有了：
- ✅ **真實的期貨下單API**
- ✅ **完整的參數設定**
- ✅ **詳細的回報監控**
- ✅ **完善的錯誤處理**

**🚀 準備開始你的第一次真實期貨API下單測試！**

記住：**謹慎、小額、學習優先！**

---
*真實期貨下單API測試指南*
*時間: 2025-06-29*
*基於群益證券官方API實現*
