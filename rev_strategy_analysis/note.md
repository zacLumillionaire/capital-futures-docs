任務3：GUI一致性比較測試
============================================================
開始時間: 2025-07-17 17:00:55.585750
🧪 測試 MDD GUI 風格調用
----------------------------------------
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:622] 📅 回測時間區間: 2024-11-04 至 2024-11-04
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:626] 🕐 開盤區間時間: 08:46 至 08:47
🔍 DEBUG: 停損類型查找 - 輸入: StopLossType.RANGE_BOUNDARY, 類型: <enum 'StopLossType'>, 值: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:628] 
📋======= 🔄反轉策略設定摘要 (交易口數: 3) =======📋
  - 交易方向：多空都做
  - 停利目標設定：區間邊緣 (反轉策略：原停損點變停利點)
  --- 濾網設定 ---
  - 區間大小濾網：停用
  - 風險管理濾網：停用
  --- 各口數出場規則 ---
  - [第 1 口單]
    - 停利: 固定停利 (60點)
  - [第 2 口單]
    - 停利: 固定停利 (80點)
    - 保護性停損: 前序累積獲利 * 2.0
  - [第 3 口單]
    - 停利: 固定停利 (100點)
    - 保護性停損: 前序累積獲利 * 2.0
[2025-07-17T17:00:55+0800] INFO [sqlite_connection.init_sqlite_connection:168] 🔌 SQLite連接已初始化: stock_data.sqlite
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:658] 🔍 找到 1 個交易日進行回測。
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:696] 📊 2024-11-04 開盤區間計算詳情:
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:697]    時間範圍: 08:46 - 08:47
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:698]    找到 1 根K棒:
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:700]      K棒1: 08:47:00 | 高:22725 低:22700 收:22724
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:708]    ➡️ 計算結果: 區間高點 22725 | 區間低點 22700 | 區間大小 25 點
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:717] --- 2024-11-04 | 開盤區間: 22700 - 22725 | 區間濾網未啟用 ---
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:297]   📉 SHORT | 反轉進場 3 口 | 時間: 08:48:00, 價格: 22725 | 進場模式: 區間邊緣 (原策略做多點)
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:355]     📊 第1口設定 | 🎯固定停損模式 | 停損點數: 15點 | 停損點位: 22740
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:355]     📊 第2口設定 | 🎯固定停損模式 | 停損點數: 40點 | 停損點位: 22765
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:371]     🛡️ 第2口保護性停損倍數: 2.0
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:355]     📊 第3口設定 | 🎯固定停損模式 | 停損點數: 41點 | 停損點位: 22766
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:371]     🛡️ 第3口保護性停損倍數: 2.0
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:469]   ❌ 第1口初始停損 | 時間: 08:49:00, 出場價: 22740, 損益: -15
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:469]   ❌ 第2口初始停損 | 時間: 08:49:00, 出場價: 22765, 損益: -40
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:469]   ❌ 第3口初始停損 | 時間: 08:49:00, 出場價: 22766, 損益: -41
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:772] ====== 回測結果總結 ======
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:773] 總交易天數: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:774] 總交易次數: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:775] 獲利次數: 0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:776] 虧損次數: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:777] 勝率: 0.00%
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:778] 總損益(3口): -96.00
🔍 DEBUG: 停損類型查找 - 輸入: StopLossType.RANGE_BOUNDARY, 類型: <enum 'StopLossType'>, 值: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:779] 
📋======= 🔄反轉策略設定摘要 (交易口數: 3) =======📋
  - 交易方向：多空都做
  - 停利目標設定：區間邊緣 (反轉策略：原停損點變停利點)
  --- 濾網設定 ---
  - 區間大小濾網：停用
  - 風險管理濾網：停用
  --- 各口數出場規則 ---
  - [第 1 口單]
    - 停利: 固定停利 (60點)
  - [第 2 口單]
    - 停利: 固定停利 (80點)
    - 保護性停損: 前序累積獲利 * 2.0
  - [第 3 口單]
    - 停利: 固定停利 (100點)
    - 保護性停損: 前序累積獲利 * 2.0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:780] ===========================
✅ MDD GUI 風格: PNL=-96.00, MDD=96.00
🧪 測試 Rev Web GUI 風格調用
----------------------------------------
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:622] 📅 回測時間區間: 2024-11-04 至 2024-11-04
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:626] 🕐 開盤區間時間: 08:46 至 08:47
🔍 DEBUG: 停損類型查找 - 輸入: StopLossType.RANGE_BOUNDARY, 類型: <enum 'StopLossType'>, 值: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:628] 
📋======= 🔄反轉策略設定摘要 (交易口數: 3) =======📋
  - 交易方向：多空都做
  - 停利目標設定：區間邊緣 (反轉策略：原停損點變停利點)
  --- 濾網設定 ---
  - 區間大小濾網：停用
  - 風險管理濾網：停用
  --- 各口數出場規則 ---
  - [第 1 口單]
    - 停利: 固定停利 (60點)
  - [第 2 口單]
    - 停利: 固定停利 (80點)
    - 保護性停損: 前序累積獲利 * 2.0
  - [第 3 口單]
    - 停利: 固定停利 (100點)
    - 保護性停損: 前序累積獲利 * 2.0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:658] 🔍 找到 1 個交易日進行回測。
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:696] 📊 2024-11-04 開盤區間計算詳情:
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:697]    時間範圍: 08:46 - 08:47
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:698]    找到 1 根K棒:
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:700]      K棒1: 08:47:00 | 高:22725 低:22700 收:22724
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:708]    ➡️ 計算結果: 區間高點 22725 | 區間低點 22700 | 區間大小 25 點
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:717] --- 2024-11-04 | 開盤區間: 22700 - 22725 | 區間濾網未啟用 ---
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:297]   📉 SHORT | 反轉進場 3 口 | 時間: 08:48:00, 價格: 22725 | 進場模式: 區間邊緣 (原策略做多點)
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:355]     📊 第1口設定 | 🎯固定停損模式 | 停損點數: 15點 | 停損點位: 22740
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:355]     📊 第2口設定 | 🎯固定停損模式 | 停損點數: 40點 | 停損點位: 22765
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:371]     🛡️ 第2口保護性停損倍數: 2.0
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:355]     📊 第3口設定 | 🎯固定停損模式 | 停損點數: 41點 | 停損點位: 22766
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:371]     🛡️ 第3口保護性停損倍數: 2.0
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:469]   ❌ 第1口初始停損 | 時間: 08:49:00, 出場價: 22740, 損益: -15
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:469]   ❌ 第2口初始停損 | 時間: 08:49:00, 出場價: 22765, 損益: -40
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:469]   ❌ 第3口初始停損 | 時間: 08:49:00, 出場價: 22766, 損益: -41
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:772] ====== 回測結果總結 ======
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:773] 總交易天數: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:774] 總交易次數: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:775] 獲利次數: 0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:776] 虧損次數: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:777] 勝率: 0.00%
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:778] 總損益(3口): -96.00
🔍 DEBUG: 停損類型查找 - 輸入: StopLossType.RANGE_BOUNDARY, 類型: <enum 'StopLossType'>, 值: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:779] 
📋======= 🔄反轉策略設定摘要 (交易口數: 3) =======📋
  - 交易方向：多空都做
  - 停利目標設定：區間邊緣 (反轉策略：原停損點變停利點)
  --- 濾網設定 ---
  - 區間大小濾網：停用
  - 風險管理濾網：停用
  --- 各口數出場規則 ---
  - [第 1 口單]
    - 停利: 固定停利 (60點)
  - [第 2 口單]
    - 停利: 固定停利 (80點)
    - 保護性停損: 前序累積獲利 * 2.0
  - [第 3 口單]
    - 停利: 固定停利 (100點)
    - 保護性停損: 前序累積獲利 * 2.0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:780] ===========================
✅ Rev Web GUI 風格: PNL=-96.00, MDD=96.00

📊 結果比較分析
==================================================
指標比較:
------------------------------
✅ total_pnl      :   -96.00 vs   -96.00
✅ long_pnl       :     0.00 vs     0.00
✅ short_pnl      :   -96.00 vs   -96.00
✅ max_drawdown   :    96.00 vs    96.00
✅ peak_pnl       :     0.00 vs     0.00
✅ total_trades   :     1.00 vs     1.00
✅ long_trades    :     0.00 vs     0.00
✅ short_trades   :     1.00 vs     1.00

🎯 整體一致性: ✅ 完全一致

==================================================
多場景一致性測試
==================================================

🧪 場景: 基本場景
------------------------------
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:622] 📅 回測時間區間: 2024-11-04 至 2024-11-04
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:626] 🕐 開盤區間時間: 08:46 至 08:47
🔍 DEBUG: 停損類型查找 - 輸入: StopLossType.RANGE_BOUNDARY, 類型: <enum 'StopLossType'>, 值: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:628] 
📋======= 🔄反轉策略設定摘要 (交易口數: 3) =======📋
  - 交易方向：多空都做
  - 停利目標設定：區間邊緣 (反轉策略：原停損點變停利點)
  --- 濾網設定 ---
  - 區間大小濾網：停用
  - 風險管理濾網：停用
  --- 各口數出場規則 ---
  - [第 1 口單]
    - 停利: 固定停利 (60點)
  - [第 2 口單]
    - 停利: 固定停利 (80點)
    - 保護性停損: 前序累積獲利 * 2.0
  - [第 3 口單]
    - 停利: 固定停利 (100點)
    - 保護性停損: 前序累積獲利 * 2.0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:658] 🔍 找到 1 個交易日進行回測。
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:696] 📊 2024-11-04 開盤區間計算詳情:
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:697]    時間範圍: 08:46 - 08:47
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:698]    找到 1 根K棒:
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:700]      K棒1: 08:47:00 | 高:22725 低:22700 收:22724
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:708]    ➡️ 計算結果: 區間高點 22725 | 區間低點 22700 | 區間大小 25 點
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:717] --- 2024-11-04 | 開盤區間: 22700 - 22725 | 區間濾網未啟用 ---
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:297]   📉 SHORT | 反轉進場 3 口 | 時間: 08:48:00, 價格: 22725 | 進場模式: 區間邊緣 (原策略做多點)
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:355]     📊 第1口設定 | 🎯固定停損模式 | 停損點數: 15點 | 停損點位: 22740
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:355]     📊 第2口設定 | 🎯固定停損模式 | 停損點數: 40點 | 停損點位: 22765
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:371]     🛡️ 第2口保護性停損倍數: 2.0
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:355]     📊 第3口設定 | 🎯固定停損模式 | 停損點數: 41點 | 停損點位: 22766
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:371]     🛡️ 第3口保護性停損倍數: 2.0
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:469]   ❌ 第1口初始停損 | 時間: 08:49:00, 出場價: 22740, 損益: -15
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:469]   ❌ 第2口初始停損 | 時間: 08:49:00, 出場價: 22765, 損益: -40
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:469]   ❌ 第3口初始停損 | 時間: 08:49:00, 出場價: 22766, 損益: -41
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:772] ====== 回測結果總結 ======
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:773] 總交易天數: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:774] 總交易次數: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:775] 獲利次數: 0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:776] 虧損次數: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:777] 勝率: 0.00%
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:778] 總損益(3口): -96.00
🔍 DEBUG: 停損類型查找 - 輸入: StopLossType.RANGE_BOUNDARY, 類型: <enum 'StopLossType'>, 值: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:779] 
📋======= 🔄反轉策略設定摘要 (交易口數: 3) =======📋
  - 交易方向：多空都做
  - 停利目標設定：區間邊緣 (反轉策略：原停損點變停利點)
  --- 濾網設定 ---
  - 區間大小濾網：停用
  - 風險管理濾網：停用
  --- 各口數出場規則 ---
  - [第 1 口單]
    - 停利: 固定停利 (60點)
  - [第 2 口單]
    - 停利: 固定停利 (80點)
    - 保護性停損: 前序累積獲利 * 2.0
  - [第 3 口單]
    - 停利: 固定停利 (100點)
    - 保護性停損: 前序累積獲利 * 2.0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:780] ===========================
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:622] 📅 回測時間區間: 2024-11-04 至 2024-11-04
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:626] 🕐 開盤區間時間: 08:46 至 08:47
🔍 DEBUG: 停損類型查找 - 輸入: StopLossType.RANGE_BOUNDARY, 類型: <enum 'StopLossType'>, 值: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:628] 
📋======= 🔄反轉策略設定摘要 (交易口數: 3) =======📋
  - 交易方向：多空都做
  - 停利目標設定：區間邊緣 (反轉策略：原停損點變停利點)
  --- 濾網設定 ---
  - 區間大小濾網：停用
  - 風險管理濾網：停用
  --- 各口數出場規則 ---
  - [第 1 口單]
    - 停利: 固定停利 (60點)
  - [第 2 口單]
    - 停利: 固定停利 (80點)
    - 保護性停損: 前序累積獲利 * 2.0
  - [第 3 口單]
    - 停利: 固定停利 (100點)
    - 保護性停損: 前序累積獲利 * 2.0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:658] 🔍 找到 1 個交易日進行回測。
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:696] 📊 2024-11-04 開盤區間計算詳情:
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:697]    時間範圍: 08:46 - 08:47
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:698]    找到 1 根K棒:
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:700]      K棒1: 08:47:00 | 高:22725 低:22700 收:22724
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:708]    ➡️ 計算結果: 區間高點 22725 | 區間低點 22700 | 區間大小 25 點
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:717] --- 2024-11-04 | 開盤區間: 22700 - 22725 | 區間濾網未啟用 ---
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:297]   📉 SHORT | 反轉進場 3 口 | 時間: 08:48:00, 價格: 22725 | 進場模式: 區間邊緣 (原策略做多點)
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:355]     📊 第1口設定 | 🎯固定停損模式 | 停損點數: 15點 | 停損點位: 22740
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:355]     📊 第2口設定 | 🎯固定停損模式 | 停損點數: 40點 | 停損點位: 22765
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:371]     🛡️ 第2口保護性停損倍數: 2.0
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:355]     📊 第3口設定 | 🎯固定停損模式 | 停損點數: 41點 | 停損點位: 22766
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:371]     🛡️ 第3口保護性停損倍數: 2.0
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:469]   ❌ 第1口初始停損 | 時間: 08:49:00, 出場價: 22740, 損益: -15
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:469]   ❌ 第2口初始停損 | 時間: 08:49:00, 出場價: 22765, 損益: -40
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:469]   ❌ 第3口初始停損 | 時間: 08:49:00, 出場價: 22766, 損益: -41
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:772] ====== 回測結果總結 ======
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:773] 總交易天數: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:774] 總交易次數: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:775] 獲利次數: 0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:776] 虧損次數: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:777] 勝率: 0.00%
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:778] 總損益(3口): -96.00
🔍 DEBUG: 停損類型查找 - 輸入: StopLossType.RANGE_BOUNDARY, 類型: <enum 'StopLossType'>, 值: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:779] 
📋======= 🔄反轉策略設定摘要 (交易口數: 3) =======📋
  - 交易方向：多空都做
  - 停利目標設定：區間邊緣 (反轉策略：原停損點變停利點)
  --- 濾網設定 ---
  - 區間大小濾網：停用
  - 風險管理濾網：停用
  --- 各口數出場規則 ---
  - [第 1 口單]
    - 停利: 固定停利 (60點)
  - [第 2 口單]
    - 停利: 固定停利 (80點)
    - 保護性停損: 前序累積獲利 * 2.0
  - [第 3 口單]
    - 停利: 固定停利 (100點)
    - 保護性停損: 前序累積獲利 * 2.0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:780] ===========================
✅ 基本場景: 結果一致 (PNL=-96.00)

🧪 場景: 只做多
------------------------------
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:622] 📅 回測時間區間: 2024-11-04 至 2024-11-04
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:626] 🕐 開盤區間時間: 08:46 至 08:47
🔍 DEBUG: 停損類型查找 - 輸入: StopLossType.RANGE_BOUNDARY, 類型: <enum 'StopLossType'>, 值: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:628] 
📋======= 🔄反轉策略設定摘要 (交易口數: 3) =======📋
  - 交易方向：只做多
  - 停利目標設定：區間邊緣 (反轉策略：原停損點變停利點)
  --- 濾網設定 ---
  - 區間大小濾網：停用
  - 風險管理濾網：停用
  --- 各口數出場規則 ---
  - [第 1 口單]
    - 停利: 固定停利 (60點)
  - [第 2 口單]
    - 停利: 固定停利 (80點)
    - 保護性停損: 前序累積獲利 * 2.0
  - [第 3 口單]
    - 停利: 固定停利 (100點)
    - 保護性停損: 前序累積獲利 * 2.0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:658] 🔍 找到 1 個交易日進行回測。
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:696] 📊 2024-11-04 開盤區間計算詳情:
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:697]    時間範圍: 08:46 - 08:47
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:698]    找到 1 根K棒:
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:700]      K棒1: 08:47:00 | 高:22725 低:22700 收:22724
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:708]    ➡️ 計算結果: 區間高點 22725 | 區間低點 22700 | 區間大小 25 點
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:717] --- 2024-11-04 | 開盤區間: 22700 - 22725 | 區間濾網未啟用 ---
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:772] ====== 回測結果總結 ======
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:773] 總交易天數: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:774] 總交易次數: 0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:775] 獲利次數: 0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:776] 虧損次數: 0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:777] 勝率: 0.00%
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:778] 總損益(3口): 0.00
🔍 DEBUG: 停損類型查找 - 輸入: StopLossType.RANGE_BOUNDARY, 類型: <enum 'StopLossType'>, 值: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:779] 
📋======= 🔄反轉策略設定摘要 (交易口數: 3) =======📋
  - 交易方向：只做多
  - 停利目標設定：區間邊緣 (反轉策略：原停損點變停利點)
  --- 濾網設定 ---
  - 區間大小濾網：停用
  - 風險管理濾網：停用
  --- 各口數出場規則 ---
  - [第 1 口單]
    - 停利: 固定停利 (60點)
  - [第 2 口單]
    - 停利: 固定停利 (80點)
    - 保護性停損: 前序累積獲利 * 2.0
  - [第 3 口單]
    - 停利: 固定停利 (100點)
    - 保護性停損: 前序累積獲利 * 2.0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:780] ===========================
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:622] 📅 回測時間區間: 2024-11-04 至 2024-11-04
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:626] 🕐 開盤區間時間: 08:46 至 08:47
🔍 DEBUG: 停損類型查找 - 輸入: StopLossType.RANGE_BOUNDARY, 類型: <enum 'StopLossType'>, 值: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:628] 
📋======= 🔄反轉策略設定摘要 (交易口數: 3) =======📋
  - 交易方向：只做多
  - 停利目標設定：區間邊緣 (反轉策略：原停損點變停利點)
  --- 濾網設定 ---
  - 區間大小濾網：停用
  - 風險管理濾網：停用
  --- 各口數出場規則 ---
  - [第 1 口單]
    - 停利: 固定停利 (60點)
  - [第 2 口單]
    - 停利: 固定停利 (80點)
    - 保護性停損: 前序累積獲利 * 2.0
  - [第 3 口單]
    - 停利: 固定停利 (100點)
    - 保護性停損: 前序累積獲利 * 2.0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:658] 🔍 找到 1 個交易日進行回測。
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:696] 📊 2024-11-04 開盤區間計算詳情:
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:697]    時間範圍: 08:46 - 08:47
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:698]    找到 1 根K棒:
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:700]      K棒1: 08:47:00 | 高:22725 低:22700 收:22724
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:708]    ➡️ 計算結果: 區間高點 22725 | 區間低點 22700 | 區間大小 25 點
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:717] --- 2024-11-04 | 開盤區間: 22700 - 22725 | 區間濾網未啟用 ---
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:772] ====== 回測結果總結 ======
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:773] 總交易天數: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:774] 總交易次數: 0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:775] 獲利次數: 0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:776] 虧損次數: 0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:777] 勝率: 0.00%
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:778] 總損益(3口): 0.00
🔍 DEBUG: 停損類型查找 - 輸入: StopLossType.RANGE_BOUNDARY, 類型: <enum 'StopLossType'>, 值: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:779] 
📋======= 🔄反轉策略設定摘要 (交易口數: 3) =======📋
  - 交易方向：只做多
  - 停利目標設定：區間邊緣 (反轉策略：原停損點變停利點)
  --- 濾網設定 ---
  - 區間大小濾網：停用
  - 風險管理濾網：停用
  --- 各口數出場規則 ---
  - [第 1 口單]
    - 停利: 固定停利 (60點)
  - [第 2 口單]
    - 停利: 固定停利 (80點)
    - 保護性停損: 前序累積獲利 * 2.0
  - [第 3 口單]
    - 停利: 固定停利 (100點)
    - 保護性停損: 前序累積獲利 * 2.0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:780] ===========================
✅ 只做多: 結果一致 (PNL=0.00)

🧪 場景: 只做空
------------------------------
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:622] 📅 回測時間區間: 2024-11-04 至 2024-11-04
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:626] 🕐 開盤區間時間: 08:46 至 08:47
🔍 DEBUG: 停損類型查找 - 輸入: StopLossType.RANGE_BOUNDARY, 類型: <enum 'StopLossType'>, 值: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:628] 
📋======= 🔄反轉策略設定摘要 (交易口數: 3) =======📋
  - 交易方向：只做空
  - 停利目標設定：區間邊緣 (反轉策略：原停損點變停利點)
  --- 濾網設定 ---
  - 區間大小濾網：停用
  - 風險管理濾網：停用
  --- 各口數出場規則 ---
  - [第 1 口單]
    - 停利: 固定停利 (60點)
  - [第 2 口單]
    - 停利: 固定停利 (80點)
    - 保護性停損: 前序累積獲利 * 2.0
  - [第 3 口單]
    - 停利: 固定停利 (100點)
    - 保護性停損: 前序累積獲利 * 2.0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:658] 🔍 找到 1 個交易日進行回測。
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:696] 📊 2024-11-04 開盤區間計算詳情:
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:697]    時間範圍: 08:46 - 08:47
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:698]    找到 1 根K棒:
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:700]      K棒1: 08:47:00 | 高:22725 低:22700 收:22724
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:708]    ➡️ 計算結果: 區間高點 22725 | 區間低點 22700 | 區間大小 25 點
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:717] --- 2024-11-04 | 開盤區間: 22700 - 22725 | 區間濾網未啟用 ---
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:297]   📉 SHORT | 反轉進場 3 口 | 時間: 08:48:00, 價格: 22725 | 進場模式: 區間邊緣 (原策略做多點)
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:355]     📊 第1口設定 | 🎯固定停損模式 | 停損點數: 15點 | 停損點位: 22740
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:355]     📊 第2口設定 | 🎯固定停損模式 | 停損點數: 40點 | 停損點位: 22765
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:371]     🛡️ 第2口保護性停損倍數: 2.0
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:355]     📊 第3口設定 | 🎯固定停損模式 | 停損點數: 41點 | 停損點位: 22766
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:371]     🛡️ 第3口保護性停損倍數: 2.0
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:469]   ❌ 第1口初始停損 | 時間: 08:49:00, 出場價: 22740, 損益: -15
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:469]   ❌ 第2口初始停損 | 時間: 08:49:00, 出場價: 22765, 損益: -40
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:469]   ❌ 第3口初始停損 | 時間: 08:49:00, 出場價: 22766, 損益: -41
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:772] ====== 回測結果總結 ======
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:773] 總交易天數: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:774] 總交易次數: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:775] 獲利次數: 0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:776] 虧損次數: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:777] 勝率: 0.00%
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:778] 總損益(3口): -96.00
🔍 DEBUG: 停損類型查找 - 輸入: StopLossType.RANGE_BOUNDARY, 類型: <enum 'StopLossType'>, 值: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:779] 
📋======= 🔄反轉策略設定摘要 (交易口數: 3) =======📋
  - 交易方向：只做空
  - 停利目標設定：區間邊緣 (反轉策略：原停損點變停利點)
  --- 濾網設定 ---
  - 區間大小濾網：停用
  - 風險管理濾網：停用
  --- 各口數出場規則 ---
  - [第 1 口單]
    - 停利: 固定停利 (60點)
  - [第 2 口單]
    - 停利: 固定停利 (80點)
    - 保護性停損: 前序累積獲利 * 2.0
  - [第 3 口單]
    - 停利: 固定停利 (100點)
    - 保護性停損: 前序累積獲利 * 2.0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:780] ===========================
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:622] 📅 回測時間區間: 2024-11-04 至 2024-11-04
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:626] 🕐 開盤區間時間: 08:46 至 08:47
🔍 DEBUG: 停損類型查找 - 輸入: StopLossType.RANGE_BOUNDARY, 類型: <enum 'StopLossType'>, 值: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:628] 
📋======= 🔄反轉策略設定摘要 (交易口數: 3) =======📋
  - 交易方向：只做空
  - 停利目標設定：區間邊緣 (反轉策略：原停損點變停利點)
  --- 濾網設定 ---
  - 區間大小濾網：停用
  - 風險管理濾網：停用
  --- 各口數出場規則 ---
  - [第 1 口單]
    - 停利: 固定停利 (60點)
  - [第 2 口單]
    - 停利: 固定停利 (80點)
    - 保護性停損: 前序累積獲利 * 2.0
  - [第 3 口單]
    - 停利: 固定停利 (100點)
    - 保護性停損: 前序累積獲利 * 2.0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:658] 🔍 找到 1 個交易日進行回測。
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:696] 📊 2024-11-04 開盤區間計算詳情:
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:697]    時間範圍: 08:46 - 08:47
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:698]    找到 1 根K棒:
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:700]      K棒1: 08:47:00 | 高:22725 低:22700 收:22724
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:708]    ➡️ 計算結果: 區間高點 22725 | 區間低點 22700 | 區間大小 25 點
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:717] --- 2024-11-04 | 開盤區間: 22700 - 22725 | 區間濾網未啟用 ---
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:297]   📉 SHORT | 反轉進場 3 口 | 時間: 08:48:00, 價格: 22725 | 進場模式: 區間邊緣 (原策略做多點)
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:355]     📊 第1口設定 | 🎯固定停損模式 | 停損點數: 15點 | 停損點位: 22740
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:355]     📊 第2口設定 | 🎯固定停損模式 | 停損點數: 40點 | 停損點位: 22765
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:371]     🛡️ 第2口保護性停損倍數: 2.0
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:355]     📊 第3口設定 | 🎯固定停損模式 | 停損點數: 41點 | 停損點位: 22766
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:371]     🛡️ 第3口保護性停損倍數: 2.0
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:469]   ❌ 第1口初始停損 | 時間: 08:49:00, 出場價: 22740, 損益: -15
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:469]   ❌ 第2口初始停損 | 時間: 08:49:00, 出場價: 22765, 損益: -40
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:469]   ❌ 第3口初始停損 | 時間: 08:49:00, 出場價: 22766, 損益: -41
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:772] ====== 回測結果總結 ======
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:773] 總交易天數: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:774] 總交易次數: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:775] 獲利次數: 0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:776] 虧損次數: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:777] 勝率: 0.00%
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:778] 總損益(3口): -96.00
🔍 DEBUG: 停損類型查找 - 輸入: StopLossType.RANGE_BOUNDARY, 類型: <enum 'StopLossType'>, 值: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:779] 
📋======= 🔄反轉策略設定摘要 (交易口數: 3) =======📋
  - 交易方向：只做空
  - 停利目標設定：區間邊緣 (反轉策略：原停損點變停利點)
  --- 濾網設定 ---
  - 區間大小濾網：停用
  - 風險管理濾網：停用
  --- 各口數出場規則 ---
  - [第 1 口單]
    - 停利: 固定停利 (60點)
  - [第 2 口單]
    - 停利: 固定停利 (80點)
    - 保護性停損: 前序累積獲利 * 2.0
  - [第 3 口單]
    - 停利: 固定停利 (100點)
    - 保護性停損: 前序累積獲利 * 2.0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:780] ===========================
✅ 只做空: 結果一致 (PNL=-96.00)

🧪 場景: 低點+5點
------------------------------
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:622] 📅 回測時間區間: 2024-11-04 至 2024-11-04
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:626] 🕐 開盤區間時間: 08:46 至 08:47
🔍 DEBUG: 停損類型查找 - 輸入: StopLossType.RANGE_BOUNDARY, 類型: <enum 'StopLossType'>, 值: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:628] 
📋======= 🔄反轉策略設定摘要 (交易口數: 3) =======📋
  - 交易方向：多空都做
  - 停利目標設定：區間邊緣 (反轉策略：原停損點變停利點)
  --- 濾網設定 ---
  - 區間大小濾網：停用
  - 風險管理濾網：停用
  --- 各口數出場規則 ---
  - [第 1 口單]
    - 停利: 固定停利 (60點)
  - [第 2 口單]
    - 停利: 固定停利 (80點)
    - 保護性停損: 前序累積獲利 * 2.0
  - [第 3 口單]
    - 停利: 固定停利 (100點)
    - 保護性停損: 前序累積獲利 * 2.0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:658] 🔍 找到 1 個交易日進行回測。
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:696] 📊 2024-11-04 開盤區間計算詳情:
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:697]    時間範圍: 08:46 - 08:47
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:698]    找到 1 根K棒:
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:700]      K棒1: 08:47:00 | 高:22725 低:22700 收:22724
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:708]    ➡️ 計算結果: 區間高點 22725 | 區間低點 22700 | 區間大小 25 點
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:717] --- 2024-11-04 | 開盤區間: 22700 - 22725 | 區間濾網未啟用 ---
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:297]   📉 SHORT | 反轉進場 3 口 | 時間: 08:48:00, 價格: 22726 | 進場模式: 最低點+5點 (原策略做多點)
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:355]     📊 第1口設定 | 🎯固定停損模式 | 停損點數: 15點 | 停損點位: 22741
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:355]     📊 第2口設定 | 🎯固定停損模式 | 停損點數: 40點 | 停損點位: 22766
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:371]     🛡️ 第2口保護性停損倍數: 2.0
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:355]     📊 第3口設定 | 🎯固定停損模式 | 停損點數: 41點 | 停損點位: 22767
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:371]     🛡️ 第3口保護性停損倍數: 2.0
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:469]   ❌ 第1口初始停損 | 時間: 08:49:00, 出場價: 22741, 損益: -15
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:469]   ❌ 第2口初始停損 | 時間: 08:49:00, 出場價: 22766, 損益: -40
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:469]   ❌ 第3口初始停損 | 時間: 08:52:00, 出場價: 22767, 損益: -41
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:772] ====== 回測結果總結 ======
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:773] 總交易天數: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:774] 總交易次數: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:775] 獲利次數: 0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:776] 虧損次數: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:777] 勝率: 0.00%
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:778] 總損益(3口): -96.00
🔍 DEBUG: 停損類型查找 - 輸入: StopLossType.RANGE_BOUNDARY, 類型: <enum 'StopLossType'>, 值: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:779] 
📋======= 🔄反轉策略設定摘要 (交易口數: 3) =======📋
  - 交易方向：多空都做
  - 停利目標設定：區間邊緣 (反轉策略：原停損點變停利點)
  --- 濾網設定 ---
  - 區間大小濾網：停用
  - 風險管理濾網：停用
  --- 各口數出場規則 ---
  - [第 1 口單]
    - 停利: 固定停利 (60點)
  - [第 2 口單]
    - 停利: 固定停利 (80點)
    - 保護性停損: 前序累積獲利 * 2.0
  - [第 3 口單]
    - 停利: 固定停利 (100點)
    - 保護性停損: 前序累積獲利 * 2.0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:780] ===========================
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:622] 📅 回測時間區間: 2024-11-04 至 2024-11-04
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:626] 🕐 開盤區間時間: 08:46 至 08:47
🔍 DEBUG: 停損類型查找 - 輸入: StopLossType.RANGE_BOUNDARY, 類型: <enum 'StopLossType'>, 值: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:628] 
📋======= 🔄反轉策略設定摘要 (交易口數: 3) =======📋
  - 交易方向：多空都做
  - 停利目標設定：區間邊緣 (反轉策略：原停損點變停利點)
  --- 濾網設定 ---
  - 區間大小濾網：停用
  - 風險管理濾網：停用
  --- 各口數出場規則 ---
  - [第 1 口單]
    - 停利: 固定停利 (60點)
  - [第 2 口單]
    - 停利: 固定停利 (80點)
    - 保護性停損: 前序累積獲利 * 2.0
  - [第 3 口單]
    - 停利: 固定停利 (100點)
    - 保護性停損: 前序累積獲利 * 2.0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:658] 🔍 找到 1 個交易日進行回測。
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:696] 📊 2024-11-04 開盤區間計算詳情:
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:697]    時間範圍: 08:46 - 08:47
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:698]    找到 1 根K棒:
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:700]      K棒1: 08:47:00 | 高:22725 低:22700 收:22724
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:708]    ➡️ 計算結果: 區間高點 22725 | 區間低點 22700 | 區間大小 25 點
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:717] --- 2024-11-04 | 開盤區間: 22700 - 22725 | 區間濾網未啟用 ---
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:297]   📉 SHORT | 反轉進場 3 口 | 時間: 08:48:00, 價格: 22726 | 進場模式: 最低點+5點 (原策略做多點)
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:355]     📊 第1口設定 | 🎯固定停損模式 | 停損點數: 15點 | 停損點位: 22741
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:355]     📊 第2口設定 | 🎯固定停損模式 | 停損點數: 40點 | 停損點位: 22766
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:371]     🛡️ 第2口保護性停損倍數: 2.0
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:355]     📊 第3口設定 | 🎯固定停損模式 | 停損點數: 41點 | 停損點位: 22767
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:371]     🛡️ 第3口保護性停損倍數: 2.0
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:469]   ❌ 第1口初始停損 | 時間: 08:49:00, 出場價: 22741, 損益: -15
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:469]   ❌ 第2口初始停損 | 時間: 08:49:00, 出場價: 22766, 損益: -40
[2025-07-17T17:00:55+0800] INFO [engine._run_multi_lot_logic:469]   ❌ 第3口初始停損 | 時間: 08:52:00, 出場價: 22767, 損益: -41
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:772] ====== 回測結果總結 ======
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:773] 總交易天數: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:774] 總交易次數: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:775] 獲利次數: 0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:776] 虧損次數: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:777] 勝率: 0.00%
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:778] 總損益(3口): -96.00
🔍 DEBUG: 停損類型查找 - 輸入: StopLossType.RANGE_BOUNDARY, 類型: <enum 'StopLossType'>, 值: 1
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:779] 
📋======= 🔄反轉策略設定摘要 (交易口數: 3) =======📋
  - 交易方向：多空都做
  - 停利目標設定：區間邊緣 (反轉策略：原停損點變停利點)
  --- 濾網設定 ---
  - 區間大小濾網：停用
  - 風險管理濾網：停用
  --- 各口數出場規則 ---
  - [第 1 口單]
    - 停利: 固定停利 (60點)
  - [第 2 口單]
    - 停利: 固定停利 (80點)
    - 保護性停損: 前序累積獲利 * 2.0
  - [第 3 口單]
    - 停利: 固定停利 (100點)
    - 保護性停損: 前序累積獲利 * 2.0
[2025-07-17T17:00:55+0800] INFO [engine.run_backtest:780] ===========================
✅ 低點+5點: 結果一致 (PNL=-96.00)

📊 測試報告已保存到: 任務3_GUI一致性比較報告.json

🎯 測試總結:
  - 基本一致性: ✅ 通過
  - 多場景一致性: ✅ 通過
  - 整體結果: 🎉 修復成功！