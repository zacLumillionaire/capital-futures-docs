# 批次實驗GUI表格修改說明

## 🚀 修改內容

### 1. 最高總損益前10名表格 ✅
**修改內容**：
- 新增「交易方向」欄位，顯示實驗的交易方向（只做多、只做空、多空都做）
- 使用不同顏色區分交易方向：
  - 只做多：綠色 (#2e7d32)
  - 只做空：紅色 (#d32f2f)  
  - 多空都做：藍色 (#1976d2)

### 2. 最高多頭損益前10名表格 ✅
**修改內容**：
- 標題改為「最高多頭損益前10名（只做多實驗）」
- 新增「交易方向」欄位
- **重要**：只顯示 `trading_direction = 'LONG_ONLY'` 的實驗結果
- 交易方向欄位統一顯示為綠色「只做多」

### 3. 最高空頭損益前10名表格 ✅
**修改內容**：
- 標題改為「最高空頭損益前10名（只做空實驗）」
- 新增「交易方向」欄位
- **重要**：只顯示 `trading_direction = 'SHORT_ONLY'` 的實驗結果
- 交易方向欄位統一顯示為紅色「只做空」

### 4. 最低回撤前10名表格 ✅
**修改內容**：
- 新增「交易方向」欄位，顯示實驗的交易方向
- 使用不同顏色區分交易方向（同最高總損益表格）

### 5. 各時段MDD最低前三名表格 ✅
**修改內容**：
- 新增「交易方向」欄位，顯示實驗的交易方向
- 使用不同顏色區分交易方向（同最高總損益表格）

## 🔧 技術實現

### 後端修改：
1. **新增方法**：`ResultDatabase.get_best_results_with_direction_filter()`
   - 支持按交易方向過濾實驗結果
   - 使用 SQLite 的 `json_extract()` 函數過濾 `trading_direction` 參數

2. **修改端點**：`/get_best_results`
   - 新增 `trading_direction` 查詢參數
   - 根據參數決定是否使用方向過濾

### 前端修改：
1. **API調用修改**：
   - 最高多頭損益：添加 `&trading_direction=LONG_ONLY` 參數
   - 最高空頭損益：添加 `&trading_direction=SHORT_ONLY` 參數

2. **表格顯示修改**：
   - 所有表格都新增「交易方向」欄位
   - 統一的交易方向顯示邏輯和顏色配置

## 📊 顯示效果

### 交易方向顯示：
- `LONG_ONLY` → 「只做多」（綠色）
- `SHORT_ONLY` → 「只做空」（紅色）
- `BOTH` → 「多空都做」（藍色）

### 表格結構（以最高總損益為例）：
| 排名 | 實驗ID | 交易方向 | 時間區間 | 總損益 | MDD | 勝率 | 參數 |
|------|--------|----------|----------|--------|-----|------|------|
| 1    | 123    | 只做多   | 08:46-08:47 | 1500.0 | -200.0 | 65.5% | 15(10%)/40(10%)/41(20%) |

## ✅ 驗證要點

1. **多頭損益表格**：確認只顯示 `LONG_ONLY` 實驗
2. **空頭損益表格**：確認只顯示 `SHORT_ONLY` 實驗  
3. **交易方向欄位**：確認所有表格都正確顯示交易方向
4. **顏色配置**：確認不同交易方向使用正確的顏色
5. **數據準確性**：確認過濾後的結果符合預期

## 🎯 使用場景

這些修改讓用戶能夠：
1. 清楚識別每個實驗的交易方向
2. 專注分析純做多或純做空策略的表現
3. 比較不同交易方向的策略效果
4. 更好地理解實驗結果的來源和特性
