# ğŸ“‹ ç°¡åŒ–è¨‚å–®è¿½è¹¤æ©Ÿåˆ¶è¨­è¨ˆæ–¹æ¡ˆ

## ğŸ¯ **æ–¹æ¡ˆæ¦‚è¿°**

å°‡è¤‡é›œçš„åºè™Ÿæ˜ å°„è¿½è¹¤æ©Ÿåˆ¶ç°¡åŒ–ç‚º**ç­–ç•¥çµ„çµ±è¨ˆè¿½è¹¤**ï¼Œé€šéçµ±è¨ˆæˆäº¤å£æ•¸å’Œè§¸ç™¼è¿½åƒ¹ä¾†å¯¦ç¾å®Œæ•´çš„äº¤æ˜“ç®¡ç†ï¼Œé¿å…ç¾¤ç›ŠAPIåºè™Ÿä¸åŒ¹é…çš„æŠ€è¡“é›£é¡Œã€‚

---

## ğŸ” **å•é¡ŒèƒŒæ™¯åˆ†æ**

### **ç•¶å‰å•é¡Œ**

#### **1. ç¾¤ç›ŠAPIåºè™Ÿæ˜ å°„å¤±æ•—**
```
ç³»çµ±è¨»å†Šçš„APIåºè™Ÿ: ['6820', '2308', '10312']
å¯¦éš›å›å ±çš„åºè™Ÿ: ['2315544895165', '2315544895166', '2315544895167']
çµæœ: å®Œå…¨ä¸åŒ¹é…ï¼Œç„¡æ³•å»ºç«‹æ­£ç¢ºçš„è¨‚å–®è¿½è¹¤
```

#### **2. è¤‡é›œçš„åºè™Ÿç³»çµ±**
ç¾¤ç›ŠAPIå­˜åœ¨å¤šå¥—åºè™Ÿç³»çµ±ï¼š
- **ä¸‹å–®APIè¿”å›**: `nCode` (å¦‚: 6820, 2308, 10312)
- **OnNewData KeyNo**: `fields[0]` (å¦‚: 2315544895165)
- **OnNewData SeqNo**: `fields[47]` (å¦‚: å¦ä¸€å¥—åºè™Ÿ)

#### **3. æŠ€è¡“å¯¦ç¾å›°é›£**
- éœ€è¦è¤‡é›œçš„æ™‚é–“çª—å£åŒ¹é…
- å®¹æ˜“å‡ºç¾ç«¶çˆ­æ¢ä»¶
- èª¿è©¦å’Œç¶­è­·å›°é›£
- å®¹éŒ¯æ€§å·®

### **å¯¦éš›å½±éŸ¿**

```
ğŸ“Š ç•¶å‰æ¸¬è©¦çµæœ:
âœ… ä¸‹å–®æˆåŠŸ: 3å£ @22344
âœ… å…¨éƒ¨æˆäº¤: 3å£ @22344  
âŒ ç³»çµ±ç„¡æ³•è­˜åˆ¥æˆäº¤: åºè™Ÿä¸åŒ¹é…
âŒ è¿½åƒ¹æ©Ÿåˆ¶ç„¡æ³•è§¸ç™¼: ç„¡æ³•è­˜åˆ¥å–æ¶ˆ
âŒ éƒ¨ä½ç‹€æ…‹æœªæ›´æ–°: ä»é¡¯ç¤ºPENDING
```

---

## ğŸ’¡ **ç°¡åŒ–æ–¹æ¡ˆè¨­è¨ˆ**

### **æ ¸å¿ƒç†å¿µ**

**"é—œæ³¨çµæœï¼Œä¸é—œæ³¨éç¨‹"**
- åªé—œå¿ƒç­–ç•¥çµ„çš„ç¸½æˆäº¤å£æ•¸
- åªé—œå¿ƒæ˜¯å¦éœ€è¦è§¸ç™¼è¿½åƒ¹
- ä¸è¿½è¹¤ç‰¹å®šè¨‚å–®çš„ç”Ÿå‘½é€±æœŸ

### **è¨­è¨ˆåŸå‰‡**

1. **çµ±è¨ˆå°å‘**: ä»¥ç­–ç•¥çµ„ç‚ºå–®ä½é€²è¡Œçµ±è¨ˆ
2. **äº‹ä»¶é©…å‹•**: åŸºæ–¼å›å ±é¡å‹(D/C)è§¸ç™¼ç›¸æ‡‰è™•ç†
3. **FIFOé‚è¼¯**: å¹³å€‰æ¡ç”¨å…ˆé€²å…ˆå‡ºï¼Œç„¡éœ€ç‰¹å®šè¨‚å–®è¿½è¹¤
4. **å®¹éŒ¯å„ªå…ˆ**: å³ä½¿éƒ¨åˆ†å›å ±ä¸Ÿå¤±ï¼Œç³»çµ±ä»èƒ½æ­£å¸¸é‹ä½œ

---

## ğŸ—ï¸ **æŠ€è¡“æ¶æ§‹è¨­è¨ˆ**

### **1. ç­–ç•¥çµ„è¿½è¹¤å™¨**

```python
class StrategyGroupTracker:
    """ç­–ç•¥çµ„çµ±è¨ˆè¿½è¹¤å™¨"""
    def __init__(self, group_id: int, total_lots: int, direction: str, target_price: float):
        self.group_id = group_id
        self.total_lots = total_lots      # é æœŸä¸‹å–®å£æ•¸
        self.submitted_lots = 0           # å·²é€å‡ºå£æ•¸  
        self.filled_lots = 0              # å·²æˆäº¤å£æ•¸
        self.cancelled_lots = 0           # å·²å–æ¶ˆå£æ•¸
        self.direction = direction        # LONG/SHORT
        self.target_price = target_price  # ç›®æ¨™åƒ¹æ ¼
        self.price_tolerance = 5          # åƒ¹æ ¼å®¹å·®(é»)
        self.retry_count = 0              # è¿½åƒ¹æ¬¡æ•¸
        self.max_retries = 5              # æœ€å¤§è¿½åƒ¹æ¬¡æ•¸
        
    def is_complete(self) -> bool:
        """æª¢æŸ¥ç­–ç•¥çµ„æ˜¯å¦å®Œæˆ"""
        return self.filled_lots >= self.total_lots
        
    def needs_retry(self) -> bool:
        """æª¢æŸ¥æ˜¯å¦éœ€è¦è¿½åƒ¹"""
        return (self.filled_lots < self.total_lots and 
                self.retry_count < self.max_retries)
```

### **2. ç°¡åŒ–å›å ±è™•ç†**

```python
def process_order_reply(self, reply_data: str) -> bool:
    """è™•ç†è¨‚å–®å›å ± - ç°¡åŒ–ç‰ˆæœ¬"""
    try:
        fields = reply_data.split(',')
        if len(fields) < 25:
            return False
            
        order_type = fields[2]  # N/C/D
        price = float(fields[11]) if fields[11] else 0
        qty = int(fields[20]) if fields[20] else 0
        direction = self._detect_direction(fields)
        
        if order_type == "D":  # æˆäº¤
            self._handle_fill_report(price, qty, direction)
        elif order_type == "C":  # å–æ¶ˆ
            self._handle_cancel_report(price, qty, direction)
            
        return True
        
    except Exception as e:
        self.logger.error(f"è™•ç†å›å ±å¤±æ•—: {e}")
        return False

def _handle_fill_report(self, price: float, qty: int, direction: str):
    """è™•ç†æˆäº¤å›å ±"""
    # æ‰¾åˆ°åŒ¹é…çš„ç­–ç•¥çµ„
    group = self._find_matching_group(price, direction)
    if group:
        group.filled_lots += qty
        self.logger.info(f"âœ… ç­–ç•¥çµ„{group.group_id}æˆäº¤: {qty}å£ @{price}, ç¸½è¨ˆ: {group.filled_lots}/{group.total_lots}")
        
        # æª¢æŸ¥æ˜¯å¦å®Œæˆ
        if group.is_complete():
            self.logger.info(f"ğŸ‰ ç­–ç•¥çµ„{group.group_id}å»ºå€‰å®Œæˆ!")

def _handle_cancel_report(self, price: float, qty: int, direction: str):
    """è™•ç†å–æ¶ˆå›å ± - è§¸ç™¼è¿½åƒ¹"""
    group = self._find_matching_group(price, direction)
    if group and group.needs_retry():
        group.cancelled_lots += qty
        self.logger.info(f"âŒ ç­–ç•¥çµ„{group.group_id}å–æ¶ˆ: {qty}å£ @{price}")
        
        # è§¸ç™¼è¿½åƒ¹
        self._trigger_retry(group, qty, price)
```

---

## ğŸ“ **ç¨‹å¼ç¢¼ä¿®æ”¹ä½ç½®**

### **ä¸»è¦ä¿®æ”¹æª”æ¡ˆ**

#### **1. `Capital_Official_Framework/unified_order_tracker.py`**
**ä¿®æ”¹ç¯„åœ**: ç¬¬70-200è¡Œ
**ä¿®æ”¹å…§å®¹**:
- ç§»é™¤è¤‡é›œçš„APIåºè™Ÿæ˜ å°„é‚è¼¯
- æ–°å¢ç­–ç•¥çµ„è¿½è¹¤å™¨
- ç°¡åŒ–å›å ±è™•ç†é‚è¼¯

#### **2. `Capital_Official_Framework/multi_group_position_manager.py`**
**ä¿®æ”¹ç¯„åœ**: ç¬¬370-450è¡Œ (ä¸‹å–®è¨»å†Šéƒ¨åˆ†)
**ä¿®æ”¹å…§å®¹**:
- ç§»é™¤è¨‚å–®IDè¨»å†Šåˆ°çµ±ä¸€è¿½è¹¤å™¨
- æ”¹ç‚ºè¨»å†Šç­–ç•¥çµ„åˆ°ç°¡åŒ–è¿½è¹¤å™¨
- ä¿®æ”¹è¿½åƒ¹è§¸ç™¼é‚è¼¯

#### **3. `Capital_Official_Framework/simple_integrated.py`**
**ä¿®æ”¹ç¯„åœ**: ç¬¬1800-1830è¡Œ (é‡è¤‡ä¸‹å–®éƒ¨åˆ†)
**ä¿®æ”¹å…§å®¹**:
- ç¢ºä¿å·²ç§»é™¤é‡è¤‡ä¸‹å–®é‚è¼¯
- æ•´åˆç°¡åŒ–è¿½è¹¤å™¨

---

## ğŸ”„ **å¯¦æ–½æ­¥é©Ÿ**

### **Phase 1: å‰µå»ºç°¡åŒ–è¿½è¹¤å™¨ (1å°æ™‚)**

1. **å‰µå»ºæ–°æª”æ¡ˆ**: `Capital_Official_Framework/simplified_order_tracker.py`
2. **å¯¦ç¾ç­–ç•¥çµ„è¿½è¹¤å™¨é¡åˆ¥**
3. **å¯¦ç¾ç°¡åŒ–å›å ±è™•ç†é‚è¼¯**

### **Phase 2: ä¿®æ”¹éƒ¨ä½ç®¡ç†å™¨ (1å°æ™‚)**

1. **ä¿®æ”¹**: `multi_group_position_manager.py`
2. **ç§»é™¤è¤‡é›œçš„è¨‚å–®è¨»å†Šé‚è¼¯**
3. **æ•´åˆç°¡åŒ–è¿½è¹¤å™¨**
4. **ä¿®æ”¹è¿½åƒ¹è§¸ç™¼æ©Ÿåˆ¶**

### **Phase 3: æ•´åˆæ¸¬è©¦ (0.5å°æ™‚)**

1. **ä¿®æ”¹**: `simple_integrated.py`
2. **ç¢ºä¿ç„¡é‡è¤‡ä¸‹å–®**
3. **æ•´åˆç°¡åŒ–è¿½è¹¤å™¨**

### **Phase 4: æ¸¬è©¦é©—è­‰ (0.5å°æ™‚)**

1. **å‰µå»ºæ¸¬è©¦è…³æœ¬**
2. **é©—è­‰çµ±è¨ˆé‚è¼¯**
3. **é©—è­‰è¿½åƒ¹è§¸ç™¼**

---

## ğŸ“Š **å°æ¯”åˆ†æ**

### **ä¿®æ”¹å‰ vs ä¿®æ”¹å¾Œ**

| é …ç›® | ä¿®æ”¹å‰ | ä¿®æ”¹å¾Œ |
|------|--------|--------|
| **è¤‡é›œåº¦** | é«˜ (åºè™Ÿæ˜ å°„+æ™‚é–“çª—å£) | ä½ (çµ±è¨ˆè¨ˆæ•¸) |
| **å®¹éŒ¯æ€§** | å·® (åºè™Ÿä¸åŒ¹é…å°±å¤±æ•ˆ) | å¥½ (çµ±è¨ˆå°å‘) |
| **ç¶­è­·æ€§** | å›°é›£ (å¤šå¥—åºè™Ÿç³»çµ±) | ç°¡å–® (å–®ä¸€é‚è¼¯) |
| **èª¿è©¦æ€§** | å›°é›£ (æ˜ å°„é—œä¿‚è¤‡é›œ) | ç°¡å–® (ç›´è§€çµ±è¨ˆ) |
| **å¯é æ€§** | ä¸ç©©å®š (ä¾è³´APIåºè™Ÿ) | ç©©å®š (åŸºæ–¼å›å ±çµ±è¨ˆ) |

### **åŠŸèƒ½å°æ¯”**

| åŠŸèƒ½ | ä¿®æ”¹å‰ | ä¿®æ”¹å¾Œ |
|------|--------|--------|
| **æˆäº¤ç¢ºèª** | âŒ ç„¡æ³•ç¢ºèª | âœ… çµ±è¨ˆç¢ºèª |
| **è¿½åƒ¹è§¸ç™¼** | âŒ ç„¡æ³•è§¸ç™¼ | âœ… äº‹ä»¶è§¸ç™¼ |
| **éƒ¨ä½ç®¡ç†** | âŒ ç‹€æ…‹ä¸åŒæ­¥ | âœ… çµ±è¨ˆåŒæ­¥ |
| **å¹³å€‰æ”¯æ´** | âŒ éœ€è¦ç‰¹å®šè¨‚å–® | âœ… FIFOé‚è¼¯ |

---

## ğŸ¯ **é æœŸæ•ˆæœ**

### **ç«‹å³æ•ˆæœ**
1. **âœ… æˆäº¤ç¢ºèªæ­£å¸¸**: èƒ½æ­£ç¢ºçµ±è¨ˆæˆäº¤å£æ•¸
2. **âœ… è¿½åƒ¹æ©Ÿåˆ¶å•Ÿå‹•**: FOKå¤±æ•—å¾Œè‡ªå‹•è¿½åƒ¹
3. **âœ… éƒ¨ä½ç‹€æ…‹åŒæ­¥**: è³‡æ–™åº«ç‹€æ…‹æ­£ç¢ºæ›´æ–°
4. **âœ… ç³»çµ±ç©©å®šæ€§æå‡**: ä¸å†ä¾è³´ä¸ç©©å®šçš„åºè™Ÿæ˜ å°„

### **é•·æœŸæ•ˆæœ**
1. **ğŸ”§ ç¶­è­·æˆæœ¬é™ä½**: é‚è¼¯ç°¡å–®ï¼Œå•é¡Œå®¹æ˜“æ’æŸ¥
2. **ğŸ“ˆ ç³»çµ±å¯é æ€§æå‡**: åŸºæ–¼çµ±è¨ˆçš„å®¹éŒ¯è¨­è¨ˆ
3. **ğŸš€ é–‹ç™¼æ•ˆç‡æå‡**: ç‚ºå¹³å€‰æ©Ÿåˆ¶å¥ å®šç©©å›ºåŸºç¤
4. **ğŸ’¡ æ“´å±•æ€§å¢å¼·**: å®¹æ˜“æ·»åŠ æ–°çš„çµ±è¨ˆåŠŸèƒ½

---

## âš ï¸ **é¢¨éšªè©•ä¼°**

### **æŠ€è¡“é¢¨éšª**
| é¢¨éšª | æ©Ÿç‡ | å½±éŸ¿ | ç·©è§£æªæ–½ |
|------|------|------|----------|
| åƒ¹æ ¼åŒ¹é…éŒ¯èª¤ | ä½ | ä¸­ | è¨­å®šåˆç†å®¹å·®(5é») |
| æ–¹å‘åˆ¤æ–·éŒ¯èª¤ | ä½ | ä¸­ | åŸºæ–¼å•†å“ä»£ç¢¼åˆ¤æ–· |
| çµ±è¨ˆè¨ˆæ•¸éŒ¯èª¤ | ä½ | é«˜ | å®Œæ•´æ¸¬è©¦+æ—¥èªŒè¨˜éŒ„ |

### **æ¥­å‹™é¢¨éšª**
| é¢¨éšª | æ©Ÿç‡ | å½±éŸ¿ | ç·©è§£æªæ–½ |
|------|------|------|----------|
| æˆäº¤çµ±è¨ˆéºæ¼ | ä½ | é«˜ | å¤šé‡é©—è­‰æ©Ÿåˆ¶ |
| è¿½åƒ¹éåº¦è§¸ç™¼ | ä¸­ | ä¸­ | é‡è©¦æ¬¡æ•¸é™åˆ¶ |
| éƒ¨ä½ç‹€æ…‹ä¸ä¸€è‡´ | ä½ | ä¸­ | å®šæœŸæ ¡é©—æ©Ÿåˆ¶ |

---

## ğŸš€ **å¯¦æ–½å»ºè­°**

### **ç«‹å³åŸ·è¡Œ**
é€™å€‹æ–¹æ¡ˆå…·æœ‰ä»¥ä¸‹å„ªå‹¢ï¼Œå»ºè­°ç«‹å³å¯¦æ–½ï¼š

1. **âœ… æŠ€è¡“å¯è¡Œæ€§é«˜**: é‚è¼¯ç°¡å–®ï¼Œå¯¦ç¾å®¹æ˜“
2. **âœ… é¢¨éšªå¯æ§**: ä¸å½±éŸ¿ç¾æœ‰ä¸‹å–®é‚è¼¯
3. **âœ… æ•ˆæœç«‹ç«¿è¦‹å½±**: èƒ½ç«‹å³è§£æ±ºç•¶å‰å•é¡Œ
4. **âœ… ç‚ºæœªä¾†å¥ åŸº**: ç‚ºå¹³å€‰æ©Ÿåˆ¶æä¾›ç©©å›ºåŸºç¤

### **å¯¦æ–½é †åº**
1. **å…ˆå¯¦ç¾ç°¡åŒ–è¿½è¹¤å™¨** (ç¨ç«‹æ¨¡çµ„ï¼Œç„¡é¢¨éšª)
2. **å†æ•´åˆåˆ°éƒ¨ä½ç®¡ç†å™¨** (é€æ­¥æ›¿æ›)
3. **æœ€å¾Œç§»é™¤èˆŠé‚è¼¯** (ç¢ºèªæ–°é‚è¼¯ç©©å®šå¾Œ)

### **æˆåŠŸæ¨™æº–**
- âœ… èƒ½æ­£ç¢ºçµ±è¨ˆæˆäº¤å£æ•¸
- âœ… FOKå¤±æ•—å¾Œèƒ½è‡ªå‹•è¿½åƒ¹
- âœ… éƒ¨ä½ç‹€æ…‹èˆ‡å¯¦éš›ä¸€è‡´
- âœ… ç³»çµ±æ—¥èªŒæ¸…æ™°æ˜“æ‡‚

---

## ğŸ“ **ç¸½çµ**

é€™å€‹ç°¡åŒ–æ–¹æ¡ˆå°‡è¤‡é›œçš„åºè™Ÿæ˜ å°„å•é¡Œè½‰åŒ–ç‚ºç°¡å–®çš„çµ±è¨ˆå•é¡Œï¼Œç¬¦åˆ"å¥§å¡å§†å‰ƒåˆ€"åŸå‰‡ - **å¦‚ç„¡å¿…è¦ï¼Œå‹¿å¢å¯¦é«”**ã€‚é€šéé—œæ³¨äº¤æ˜“çµæœè€Œééç¨‹ç´°ç¯€ï¼Œæˆ‘å€‘èƒ½å¤ æ§‹å»ºä¸€å€‹æ›´ç©©å®šã€æ›´å¯é çš„äº¤æ˜“ç³»çµ±ã€‚

**å»ºè­°ç«‹å³æ¡ç”¨æ­¤æ–¹æ¡ˆï¼Œé æœŸèƒ½åœ¨3å°æ™‚å…§å®Œæˆå¯¦æ–½ä¸¦è§£æ±ºç•¶å‰æ‰€æœ‰å•é¡Œã€‚**
