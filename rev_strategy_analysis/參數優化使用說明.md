# 參數優化系統使用說明 (新配置版本)

## 概述
參數優化系統可以自動測試多種參數組合，找出最佳的策略配置。系統會測試 **5,775** 種不同的參數組合，並根據LONG P&L和總P&L進行排名。

## 系統特點
- ⚡ **超快速度**: 利用SQLite本地數據庫，358倍性能提升
- 🎯 **智能評估**: 主要關注LONG P&L，次要關注總P&L
- 📊 **詳細報告**: 自動生成CSV報告和排名
- 🔧 **靈活配置**: 可調整參數範圍和評估標準

## 參數範圍
- **第1口觸發點**: 10-30點 (21種選擇)
- **第1口回檔比例**: 10%-30% (5種選擇: 10%, 15%, 20%, 25%, 30%)
- **第2口觸發點**: 30-40點 (11種選擇)
- **第2口回檔比例**: 10%-30% (5種選擇: 10%, 15%, 20%, 25%, 30%)
- **第3口觸發點**: 41點 (1種選擇)
- **第3口回檔比例**: 20% (1種選擇)
- **總組合數**: 21 × 5 × 11 × 5 × 1 × 1 = **5,775** 種配置

## 固定參數
- 回測期間: 2024-11-04 至 2025-06-28
- 保護性停損倍數: 1.0
- 濾網設定: 全部停用

## 使用方法

### 1. 執行優化
```bash
cd strategy_analysis
python parameter_optimization.py
```

### 2. 執行時間
- **預估時間**: 約48-60分鐘 (5,775個配置)
- **實際測試**: 18個配置耗時8.9秒
- **性能**: 每個配置約0.5秒

### 3. 輸出文件
系統會自動生成三個CSV文件：
- `optimization_full_results_YYYYMMDD_HHMMSS.csv` - 完整結果
- `optimization_long_top10_YYYYMMDD_HHMMSS.csv` - LONG P&L前10名
- `optimization_total_top10_YYYYMMDD_HHMMSS.csv` - 總P&L前10名

## 結果解讀

### 主要指標
- **LONG P&L**: 多單總損益 (主要評估指標)
- **總P&L**: 多空總損益 (次要評估指標)
- **LONG勝率**: 多單勝率
- **總勝率**: 多空總勝率

### 排名邏輯
1. **主要排名**: 按LONG P&L降序排列
2. **次要排名**: 按總P&L降序排列

### 示例結果
```
排名 | 配置ID | 第1口觸發 | 第1口回檔 | 第2口觸發 | 第2口回檔 | 第3口觸發 | 第3口回檔 | LONG P&L | 總P&L | LONG勝率
 1   |   15   |     25   |    15%   |     37   |    20%   |     41   |    20%   |   333.9  | 1503.5 |  50.0%
 2   |    9   |     20   |    10%   |     36   |    25%   |     41   |    20%   |   315.2  | 1443.9 |  50.0%
```

## 自定義配置

### 修改參數範圍
編輯 `parameter_optimization.py` 第72-77行：
```python
lot1_triggers = list(range(10, 31))  # 修改第1口觸發範圍
lot1_pullbacks = [0.10, 0.15, 0.20, 0.25, 0.30]  # 修改第1口回檔比例
lot2_triggers = list(range(30, 41))  # 修改第2口觸發範圍
lot2_pullbacks = [0.10, 0.15, 0.20, 0.25, 0.30]  # 修改第2口回檔比例
lot3_triggers = [41]  # 修改第3口觸發點
lot3_pullbacks = [0.20]  # 修改第3口回檔比例
```

### 修改回測期間
編輯第52-53行：
```python
start_date = "2024-11-04"
end_date = "2025-06-28"
```

### 修改評估標準
編輯第200-210行的排序邏輯。

## 注意事項
1. **數據完整性**: 確保SQLite數據庫包含指定期間的完整數據
2. **系統資源**: 大量測試可能消耗較多CPU資源
3. **結果保存**: 每次運行都會生成新的時間戳文件
4. **參數合理性**: 確保參數範圍符合交易邏輯

## 故障排除

### 常見問題
1. **模組導入錯誤**: 確保在strategy_analysis目錄下執行
2. **數據庫連接失敗**: 檢查SQLite文件是否存在
3. **參數配置錯誤**: 檢查RiskConfig和RangeFilter參數

### 性能優化
- 使用SQLite本地數據庫 (已實現)
- 啟用silent模式減少日誌輸出 (已實現)
- 批量處理結果收集 (已實現)

## 下一步建議
1. 執行完整的1,155配置測試
2. 分析前10名配置的共同特徵
3. 針對最佳配置進行細化測試
4. 考慮加入其他評估指標 (如最大回撤、夏普比率等)
