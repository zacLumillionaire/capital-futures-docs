# 📡 實盤監控功能使用指南

## 🎯 **功能概述**

**實盤監控功能** 讓您可以在test_ui_improvements.py中一鍵啟動群益API報價，無需額外啟動OrderTester.py。

### ✨ **主要特色**
- 🚀 **一鍵啟動** - 點擊按鈕即可開始實盤監控
- 🔒 **穩定可靠** - 直接API調用，避免GIL錯誤
- 🎮 **簡單易用** - 如OrderTester般的用戶體驗
- 🔄 **智能管理** - 自動狀態監控和錯誤恢復

---

## 🚀 **快速開始**

### **步驟1: 啟動程式**
```bash
cd "Python File"
python test_ui_improvements.py
```

### **步驟2: 開始實盤監控**
1. 在報價控制區域找到 **「📡 開始實盤監控」** 按鈕
2. 點擊按鈕
3. 等待狀態顯示 **「📡 實盤監控中...」**
4. 開始使用策略功能

### **步驟3: 停止監控 (可選)**
1. 點擊 **「🛑 停止監控」** 按鈕
2. 系統自動回到模擬模式

---

## 📋 **詳細操作說明**

### **🔍 界面位置**
實盤監控按鈕位於主界面的 **報價控制區域**：
```
報價源: [模擬報價] [🎮 模擬報價] [🌉 橋接模式] [🚀 TCP模式] [📡 開始實盤監控] [🛑 停止監控]
```

### **🎯 按鈕狀態說明**

#### **📡 開始實盤監控**
- **正常狀態** - 可以點擊啟動
- **監控中...** - 已啟動，顯示為灰色
- **禁用狀態** - 其他模式運行中

#### **🛑 停止監控**
- **正常狀態** - 監控中時可點擊停止
- **禁用狀態** - 未監控時為灰色

### **📊 狀態指示器**

#### **報價源顯示**
- 🔵 **模擬報價** - 模擬模式
- 🔴 **實盤監控** - 實盤監控模式

#### **系統狀態顯示**
- 🔴 **系統就緒** - 初始狀態
- 📡 **實盤監控中...** - 正常運行
- ⚠️ **實盤連接異常** - 需要重新連接
- ❌ **監控異常** - 檢查API安裝

---

## 🔧 **功能詳解**

### **自動初始化流程**
點擊「開始實盤監控」後，系統會自動執行：

1. **🔐 API初始化**
   - 檢查群益API模組
   - 創建API物件

2. **🔑 自動登入**
   - 使用預設帳號登入
   - 讀取憑證

3. **📡 啟動報價**
   - 連接報價伺服器
   - 訂閱MTX00報價

4. **✅ 完成設定**
   - 更新界面狀態
   - 開始接收實盤報價

### **智能狀態監控**
系統會自動監控連接狀態：
- **每10秒檢查** API連接狀態
- **自動重連** 當連接中斷時
- **狀態提示** 實時更新連接狀況

### **安全停止機制**
點擊「停止監控」時：
- **停止報價訂閱** - 調用API停止函數
- **清理資源** - 釋放API物件
- **重置狀態** - 回到模擬模式
- **更新界面** - 恢復按鈕狀態

---

## ⚠️ **注意事項**

### **系統需求**
- ✅ **群益API** - 需要正確安裝群益證券API
- ✅ **Python環境** - 需要comtypes模組
- ✅ **網路連接** - 需要連接到群益伺服器

### **帳號設定**
- 📋 **預設帳號**: E123354882
- 🔑 **預設密碼**: kkd5ysUCC
- 💡 如需修改，請編輯DirectSKCOMManager類別

### **使用限制**
- 🕐 **交易時間** - 建議在交易時間內使用
- 📊 **商品限制** - 目前只支援MTX00期貨
- 🔄 **單一模式** - 同時只能運行一種報價模式

---

## 🐛 **常見問題**

### **Q1: 點擊按鈕沒有反應？**
**A:** 檢查以下項目：
- 確認群益API已正確安裝
- 檢查網路連接
- 查看日誌訊息了解具體錯誤

### **Q2: 顯示「API初始化失敗」？**
**A:** 可能原因：
- 群益API未安裝或版本不相容
- comtypes模組缺失
- 系統權限不足

### **Q3: 連接後沒有收到報價？**
**A:** 檢查項目：
- 確認在交易時間內
- 檢查網路連接穩定性
- 確認帳號有報價權限

### **Q4: 如何切換回模擬模式？**
**A:** 兩種方式：
- 點擊「🛑 停止監控」按鈕
- 點擊「🎮 模擬報價」按鈕

---

## 🔄 **與其他功能的整合**

### **策略交易**
- ✅ **完全相容** - 策略邏輯無需修改
- ✅ **自動切換** - 實盤報價自動用於策略
- ✅ **狀態同步** - 策略狀態實時更新

### **其他報價源**
- 🌉 **橋接模式** - 仍可使用OrderTester橋接
- 🚀 **TCP模式** - 仍可使用TCP連接
- 🎮 **模擬模式** - 隨時可切換回模擬

### **日誌記錄**
- 📝 **詳細日誌** - 所有操作都有日誌記錄
- 🔍 **錯誤追蹤** - 錯誤訊息詳細記錄
- 📊 **狀態變化** - 連接狀態變化記錄

---

## 🎉 **總結**

實盤監控功能提供了：
- **🚀 簡化操作** - 一鍵啟動，無需多程式
- **🔒 穩定可靠** - 直接API調用，避免GIL問題
- **🎮 用戶友好** - 清晰的狀態指示和錯誤提示
- **🔄 完全整合** - 與現有功能無縫配合

現在您可以享受更簡單、更穩定的實盤交易體驗！

---

📚 **使用指南**  
📅 **建立日期**: 2025-01-01  
🔄 **版本**: 1.0  

*如有問題或建議，請參考開發記錄文件或聯絡技術支援。*
