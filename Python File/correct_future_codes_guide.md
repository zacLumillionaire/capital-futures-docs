# 🎯 正確的期貨商品代碼格式指南

## 🔍 **發現的正確格式**

根據群益API官方文件和案例，我找到了正確的期貨商品代碼格式：

### ✅ **群益API官方格式**
```
MTX00 - 小台指期貨近月合約
TX00  - 台指期貨近月合約
TE00  - 電子期貨近月合約
TF00  - 金融期貨近月合約
```

### 📋 **來源證實**
- **群益API開發教學**: `MTX00` 被明確標示為「小台指期近月」
- **臺灣期貨交易所**: 小型臺指期貨英文代碼為 `MTX`
- **群益官方案例**: 使用 `00` 後綴表示近月合約

## 🔧 **已修改的功能**

### 1. **移除中文轉英文邏輯**
- ❌ 不再自動轉換「小台近」→「MXFR1」
- ✅ 支援直接使用正確的API格式

### 2. **更新商品代碼配置**
```python
FUTURE_PRODUCTS = {
    'MTX00': {  # 推薦使用
        'name': '小台指期貨(近月)',
        'code': 'MTX00'
    },
    'TX00': {
        'name': '台指期貨(近月)', 
        'code': 'TX00'
    }
}
```

### 3. **智能代碼識別**
手動輸入以下格式時，不會組合月份：
- ✅ **MTX00, TX00, TE00, TF00** (近月格式)
- ✅ **MXFR1, TXFR1** (R1格式)
- ✅ **小台近, 大台近** (中文格式)
- ✅ **任何6位以上代碼** (完整合約代碼)

## 🧪 **測試步驟**

### 方法1: 使用下拉選單 (推薦)
1. **期貨下單頁籤**
2. **商品代碼下拉選單** → 選擇 `MTX00 (小台指期貨(近月))`
3. **系統自動設為預設選擇**

### 方法2: 手動輸入MTX00
1. **期貨下單頁籤**
2. **「或直接輸入」欄位** → 輸入 `MTX00`
3. **點擊「使用此代碼」**

### 方法3: 測試其他格式
嘗試以下代碼看哪個有效：
- `MTX00` (推薦)
- `MXFR1` (R1格式)
- `小台近` (中文格式)
- `MXF202501` (具體月份)

## 📊 **預期測試結果**

### 使用MTX00的預期結果
```
【商品代碼】使用完整代碼: MTX00
【下單準備】帳號:F0200006363839, 商品:MTX00
【Token】使用登入ID作為Token參數: E123354882
【API調用】SendFutureOrderCLR(Token: E123354882, 非同步: True)
【API返回】訊息: 14254
【API回應】SK_SUCCESS (代碼: 0)
【成功】期貨下單成功！
【委託回報】委託編號:14254,帳號:F0200006363839,商品:MTX00,狀態:已委託
```

### 不應該看到的錯誤
- ❌ `Code: 400, Message: 無法轉換商品ID`
- ❌ 亂碼問題
- ❌ 中文轉英文訊息

## 🎯 **推薦的測試順序**

### 1. 先測試MTX00 (最推薦)
```
商品代碼: MTX00
原因: 群益API官方格式
成功率: 最高
```

### 2. 如果MTX00不行，測試MXFR1
```
商品代碼: MXFR1
原因: R1格式
成功率: 高
```

### 3. 如果都不行，測試中文格式
```
商品代碼: 小台近
原因: API查詢結果
成功率: 中等 (可能有編碼問題)
```

### 4. 最後測試具體月份
```
商品代碼: MXF202501
原因: 具體合約月份
成功率: 低 (月份可能不正確)
```

## 🔧 **技術實現**

### 智能代碼處理邏輯
```python
# 檢查是否為完整商品代碼
manual_input_patterns = [
    "MTX00", "TX00", "TE00", "TF00",        # 近月格式 ⭐ 推薦
    "MXFR1", "TXFR1", "TXER1",             # R1格式
    "小台近", "大台近", "電子近", "金融近",    # 中文格式
]

if any(pattern in product_code for pattern in manual_input_patterns):
    # 直接使用，不組合月份
    full_product_code = product_code
else:
    # 組合月份
    full_product_code = f"{product_code}{month}"
```

### 預設選擇更新
- **新預設**: `MTX00 (小台指期貨(近月))`
- **自動選擇**: 程式啟動時自動選擇MTX00
- **用戶友好**: 最推薦的格式作為預設

## 🎉 **優勢特色**

### 1. **使用官方格式**
- ✅ **MTX00** - 群益API官方文件確認的格式
- ✅ **相容性最佳** - 避免編碼和轉換問題
- ✅ **標準化** - 符合期貨交易所規範

### 2. **靈活性**
- ✅ **多格式支援** - 支援MTX00, MXFR1, 小台近等
- ✅ **智能識別** - 自動判斷是否需要組合月份
- ✅ **向下相容** - 保持對舊格式的支援

### 3. **用戶體驗**
- ✅ **預設最佳** - MTX00作為預設選擇
- ✅ **手動輸入** - 支援直接輸入測試
- ✅ **透明處理** - 清楚顯示使用的代碼

## 🚀 **立即測試**

### 現在可以測試正確的格式：

1. **重新啟動程式**
   ```bash
   cd "Python File"
   python OrderTester.py
   ```

2. **登入並啟動回報監控**

3. **測試MTX00格式**
   - 期貨下單頁籤
   - 確認預設選擇為 `MTX00`
   - 或手動輸入 `MTX00`

4. **完成下單測試**
   - 設定帳號: 6363839
   - 設定價格: 22000
   - 設定數量: 1
   - 送出下單

## 📋 **測試檢查清單**

### 格式測試
- [ ] 下拉選單預設顯示 MTX00
- [ ] 手動輸入 MTX00 成功
- [ ] 系統顯示「使用完整代碼: MTX00」
- [ ] 不組合月份

### 下單測試
- [ ] 設定所有參數
- [ ] 啟動回報監控
- [ ] 送出下單
- [ ] 檢查委託回報

### 成功指標
- [ ] 看到「商品:MTX00」
- [ ] 委託編號正常產生
- [ ] 委託回報顯示 MTX00
- [ ] 沒有400錯誤

## 💡 **重要發現**

### 群益API期貨商品代碼規則
1. **近月合約**: 使用 `00` 後綴 (MTX00, TX00)
2. **R1格式**: 使用 `R1` 後綴 (MXFR1, TXFR1)
3. **具體月份**: 使用年月格式 (MTX202501)
4. **中文代碼**: 可能有編碼問題，建議使用英文

### 推薦使用順序
1. **MTX00** - 最推薦，官方格式
2. **MXFR1** - 次選，R1格式
3. **小台近** - 備選，可能有編碼問題

**🎯 目標：使用正確的 MTX00 格式成功下單！**

---
*正確的期貨商品代碼格式指南*
*時間: 2025-06-29*
*狀態: 使用群益API官方格式 MTX00*
